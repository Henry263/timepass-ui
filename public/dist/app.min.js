var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__async=(e,t,n)=>new Promise((a,i)=>{var s=e=>{try{r(n.next(e))}catch(t){i(t)}},o=e=>{try{r(n.throw(e))}catch(t){i(t)}},r=e=>e.done?a(e.value):Promise.resolve(e.value).then(s,o);r((n=n.apply(e,t)).next())});!function(){"use strict";const e=function(e,t,n){let a=Promise.resolve();function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})};function t(e){const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        bottom: 2rem;\n        right: 2rem;\n        background: #28a745;\n        color: white;\n        padding: 1rem 1.5rem;\n        border-radius: 10px;\n        z-index: 1001;\n        font-weight: 600;\n        box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);\n        animation: slideInUp 0.3s ease;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOutDown 0.3s ease forwards",setTimeout(()=>t.remove(),300)},3e3)}function n(e){const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        bottom: 2rem;\n        right: 2rem;\n        background: #dc3545;\n        color: white;\n        padding: 1rem 1.5rem;\n        border-radius: 10px;\n        z-index: 1001;\n        font-weight: 600;\n        box-shadow: 0 10px 25px rgba(220, 53, 69, 0.3);\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>t.remove(),4e3)}function a(e,t,n=5e3){const a=document.getElementById("criticalError");a&&a.remove();const i=document.createElement("div");i.id="criticalError",i.style.cssText="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: white;\n        color: #333;\n        padding: 2rem;\n        border-radius: 15px;\n        z-index: 10001;\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n        max-width: 400px;\n        width: 90%;\n        text-align: center;\n        animation: slideIn 0.3s ease;\n    ",i.innerHTML=`\n        <div style="\n            width: 60px;\n            height: 60px;\n            background: #dc3545;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            margin: 0 auto 1.5rem;\n            font-size: 2rem;\n        ">\n            ‚ö†Ô∏è\n        </div>\n        <h3 style="\n            margin: 0 0 1rem;\n            font-size: 1.5rem;\n            color: #dc3545;\n            font-weight: 700;\n        ">${e}</h3>\n        <p style="\n            margin: 0 0 1.5rem;\n            font-size: 1rem;\n            color: #666;\n            line-height: 1.5;\n        ">${t}</p>\n        <div style="\n            font-size: 0.875rem;\n            color: #999;\n        ">This message will close automatically...</div>\n    `;const s=document.createElement("div");s.id="criticalErrorBackdrop",s.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.5);\n        z-index: 10000;\n        animation: fadeIn 0.3s ease;\n    ";const o=document.createElement("style");o.textContent="\n        @keyframes slideIn {\n            from {\n                transform: translate(-50%, -60%);\n                opacity: 0;\n            }\n            to {\n                transform: translate(-50%, -50%);\n                opacity: 1;\n            }\n        }\n        @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n        }\n        @keyframes fadeOut {\n            from { opacity: 1; }\n            to { opacity: 0; }\n        }\n    ",document.head.appendChild(o),document.body.appendChild(s),document.body.appendChild(i),setTimeout(()=>{i.style.animation="fadeOut 0.3s ease forwards",s.style.animation="fadeOut 0.3s ease forwards",setTimeout(()=>{i.remove(),s.remove(),o.remove()},300)},n)}function i(e,t){const n=document.getElementById(e);n.style.borderColor="#ee8b46",n.style.backgroundColor="#fff5f5";if(["instagram","facebook","twitter","linkedin","calendly","zoom","snapchat","tiktok","youtube","whatsapp","telegram","reddit","pinterest"].includes(e)){const e=n.closest(".social-item").querySelector(".input-error");e&&(e.innerHTML=`\n                <div class="error-message" style="\n                    color: #ee8b46;\n                    font-size: 0.875rem;\n                    margin-top: 0.5rem;\n                    font-weight: 500;\n                    display: block;\n                    width: 100%;\n                ">${t}</div>\n            `)}else{const e=n.closest(".form-group").querySelector(".error-message");e&&e.remove();const a=document.createElement("div");a.className="error-message",a.style.cssText="\n            color: #ee8b46;\n            font-size: 0.875rem;\n            margin-top: 0.5rem;\n            font-weight: 500;\n            display: block;\n            width: 100%;\n        ",a.textContent=t,n.parentNode.insertBefore(a,n.nextSibling)}}function s(){document.querySelectorAll("#profileForm input, #profileForm textarea").forEach(e=>{e.style.borderColor="",e.style.backgroundColor=""});document.querySelectorAll(".input-error").forEach(e=>{e.innerHTML=""});document.querySelectorAll(".error-message").forEach(e=>e.remove())}function o(){const e=document.querySelectorAll(".error-message"),t=document.querySelectorAll(".input-error:not(:empty)");let n=null;if(e.length>0){const t=e[0];n=t.previousElementSibling||t.parentElement.querySelector("input, textarea, select")}if(!n&&t.length>0){const e=t[0].closest(".social-item");n=e?e.querySelector("input"):null}n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{n.focus(),n.style.animation="shake 0.5s",setTimeout(()=>{n.style.animation=""},500)},300))}const r=Object.freeze(Object.defineProperty({__proto__:null,clearAllErrors:s,scrollToFirstError:o,showCriticalError:a,showError:i,showErrorMessage:n,showSuccessMessage:t},Symbol.toStringTag,{value:"Module"})),l=window.location.origin,c=5242880,d=60,u=60,p={instagram:{baseUrl:"https://instagram.com/",domains:["instagram.com"],handlePattern:/^@?[\w](?!.*?\.{2})[\w.]{0,28}[\w]$/},facebook:{baseUrl:"https://facebook.com/",domains:["facebook.com","fb.com"],handlePattern:/^@?[a-zA-Z0-9.]{3,}$/},twitter:{baseUrl:"https://twitter.com/",domains:["twitter.com","x.com"],handlePattern:/^@?[a-zA-Z0-9_]{1,15}$/},linkedin:{baseUrl:"https://linkedin.com/in/",domains:["linkedin.com"],handlePattern:/^[a-zA-Z0-9-]{3,100}$/},youtube:{baseUrl:"https://youtube.com/@",domains:["youtube.com","youtu.be"],handlePattern:/^@?[a-zA-Z0-9_-]{3,30}$/},tiktok:{baseUrl:"https://tiktok.com/@",domains:["tiktok.com"],handlePattern:/^@?[a-zA-Z0-9_.]{2,24}$/},snapchat:{baseUrl:"https://snapchat.com/add/",domains:["snapchat.com"],handlePattern:/^[a-zA-Z][a-zA-Z0-9._-]{1,15}$/},whatsapp:{baseUrl:"https://wa.me/",domains:["wa.me","whatsapp.com"],handlePattern:/^\+?[1-9]\d{1,14}$/},calendly:{baseUrl:"https://calendly.com/",domains:["calendly.com"],handlePattern:/^[a-zA-Z0-9-_]{3,30}$/},telegram:{baseUrl:"https://t.me/",domains:["t.me","telegram.com","telegram.me"],handlePattern:/^@?[a-zA-Z0-9_]{5,32}$/},reddit:{baseUrl:"https://reddit.com/u/",domains:["reddit.com"],handlePattern:/^(u\/)?[a-zA-Z0-9_-]{3,20}$/},pinterest:{baseUrl:"https://pinterest.com/",domains:["pinterest.com"],handlePattern:/^[a-zA-Z0-9_]{3,30}$/},zoom:{baseUrl:"",domains:["zoom.us","zoom.com"],handlePattern:null}},m=["com","org","net","edu","gov","co","io","ai","app","dev","uk","us","ca","au","de","fr","in","me","info","biz","ly","it","es","ru","jp","cn","br","mx","id","ph","vn","tv","cc","ws","mobi","online","site","tech","store","xyz"],h=["instagram","facebook","twitter","linkedin","calendly","zoom","snapchat","tiktok","youtube","whatsapp","telegram","reddit","pinterest"];!function(){__async(this,null,function*(){yield function(){return __async(this,null,function*(){try{const e=yield fetch("/api/card/get-client-ip"),t=yield e.json();return t.success?t.ip:null}catch(e){return null}})}()})}();class y{constructor(e=l){this.baseURL=e,this.token=this.getToken()}getUserWithProfile(){return __async(this,null,function*(){return this.apiRequest("/auth/user-profile")})}getToken(){return localStorage.getItem("authToken")||null}setToken(e){this.token=e,localStorage.setItem("authToken",e)}clearToken(){this.token=null,localStorage.removeItem("authToken")}apiRequest(e){return __async(this,arguments,function*(e,t={}){const n=`${this.baseURL}${e}`,a=__spreadValues({headers:__spreadValues({"Content-Type":"application/json"},t.headers),credentials:"include"},t);try{const e=yield fetch(n,a);if(!e.ok){let t="API request failed";try{t=(yield e.json()).message||t}catch(i){t=e.statusText||t}if(401===e.status)throw yield this.handleUnauthorized(),new Error("Session expired. Please log in again.");if(503===e.status||502===e.status)throw yield this.handleServerError("Service temporarily unavailable. Please try again later."),new Error("Service temporarily unavailable");throw new Error(t)}return yield e.json()}catch(s){if(s instanceof TypeError&&s.message.includes("fetch"))throw yield this.handleConnectionError(),new Error("Unable to connect to server. Please check your connection.");if(s.message&&(s.message.includes("ECONNREFUSED")||s.message.includes("NetworkError")||s.message.includes("Failed to fetch")||s.message.includes("Network request failed")))throw yield this.handleConnectionError(),new Error("Unable to connect to server. Please check your connection.");throw s}})}downloadFile(e){return __async(this,arguments,function*(e,t={}){const n=`${this.baseURL}${e}`;try{const e=yield fetch(n,{method:"POST",body:JSON.stringify(t),credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok){let t="Download failed";try{t=(yield e.json()).message||t}catch(a){}throw new Error(t)}return yield e.blob()}catch(i){throw i}})}handleConnectionError(){return __async(this,null,function*(){this.clearToken(),localStorage.clear(),sessionStorage.clear();const{showCriticalError:t}=yield e(()=>__async(this,null,function*(){const{showCriticalError:e}=yield Promise.resolve().then(()=>r);return{showCriticalError:e}})),{showPage:n}=yield e(()=>__async(this,null,function*(){const{showPage:e}=yield Promise.resolve().then(()=>Ne);return{showPage:e}}));t("Connection Lost","Unable to connect to the server. You have been logged out for security reasons. Please check your internet connection and try logging in again.",6e3),setTimeout(()=>{n("login"),window.verticalNav&&window.verticalNav.checkAuth&&window.verticalNav.checkAuth()},2e3)})}handleUnauthorized(){return __async(this,null,function*(){this.clearToken(),localStorage.clear(),sessionStorage.clear();const{showCriticalError:t}=yield e(()=>__async(this,null,function*(){const{showCriticalError:e}=yield Promise.resolve().then(()=>r);return{showCriticalError:e}})),{showPage:n}=yield e(()=>__async(this,null,function*(){const{showPage:e}=yield Promise.resolve().then(()=>Ne);return{showPage:e}}));setTimeout(()=>{n("home"),window.verticalNav&&window.verticalNav.checkAuth&&window.verticalNav.checkAuth()},1500)})}handleServerError(t){return __async(this,null,function*(){const{showErrorMessage:n}=yield e(()=>__async(this,null,function*(){const{showErrorMessage:e}=yield Promise.resolve().then(()=>r);return{showErrorMessage:e}}));n(t||"‚ö†Ô∏è Server is experiencing issues. Please try again later.")})}checkAuthStatus(){return __async(this,null,function*(){try{return(yield this.apiRequest("/auth/status")).authenticated}catch(e){return!1}})}getCurrentUser(){return __async(this,null,function*(){try{return this.apiRequest("/auth/user-profile")}catch(e){return{success:!1,error:e.message}}})}logout(){return __async(this,null,function*(){try{return yield this.apiRequest("/auth/logout",{method:"POST"}),this.clearToken(),!0}catch(e){return this.clearToken(),!1}})}getProfile(){return __async(this,null,function*(){try{return yield this.apiRequest("/api/profile")}catch(e){return{success:!1,error:e.message}}})}saveProfile(e){return __async(this,null,function*(){return this.apiRequest("/api/profile",{method:"POST",body:JSON.stringify(e)})})}uploadQRCode(e){return __async(this,null,function*(){const t=new FormData;return t.append("qrCode",e),this.apiRequest("/api/profile/upload-qr",{method:"POST",headers:{},body:t})})}updatesuggestions(e){return __async(this,null,function*(){return this.apiRequest("/api/suggestions",{method:"POST",body:JSON.stringify(e)})})}updatecontactinfo(e){return __async(this,null,function*(){return this.apiRequest("/api/contact",{method:"POST",body:JSON.stringify(e)})})}deleteProfile(){return __async(this,null,function*(){return this.apiRequest("/api/profile",{method:"DELETE"})})}getAnalytics(){return __async(this,null,function*(){return this.apiRequest("/api/profile/analytics")})}getQRAnalytics(){return __async(this,null,function*(){return this.apiRequest("/api/profile/custom-qr-analytics")})}getPublicCard(e){return __async(this,null,function*(){return this.apiRequest(`/api/card/${e}`)})}getCardhtmlData(e){return __async(this,null,function*(){return this.apiRequest(`/api/card/card-html/${e}`)})}getCustomCardData(e){return __async(this,null,function*(){return this.apiRequest(`/api/qr-designer/list/${e}`)})}downloadCustomQRCode(e,t){return __async(this,null,function*(){return yield this.downloadFile("/api/qr-designer/downloadcustomqr",{qrCodeId:e,size:t})})}editCustomCardData(e){return __async(this,null,function*(){return this.apiRequest(`/api/qr-designer/edit/${e}`)})}downloadVCard(e){return __async(this,null,function*(){const t=`${this.baseURL}/api/card/${e}/vcard`;window.open(t,"_blank")})}downloadWalletPass(e){return __async(this,null,function*(){const t=`${this.baseURL}/api/card/${e}/wallet-pass`;window.open(t,"_blank")})}getQRCode(e,t=300){return __async(this,null,function*(){return`${this.baseURL}/api/card/${e}/qr?size=${t}`})}getstyledQRCode(e,t=400){return __async(this,null,function*(){return`${this.baseURL}/api/card/${e}/download-styled-qr`})}trackSocialClick(e,t){return __async(this,null,function*(){return this.apiRequest(`/api/card/${e}/track/${t}`,{method:"POST"})})}trackContactClick(e,t){return __async(this,null,function*(){return this.apiRequest(`/api/card/${e}/track/contact/${t}`,{method:"POST"})})}searchCards(e,t=10){return __async(this,null,function*(){return this.apiRequest(`/api/card/search/${encodeURIComponent(e)}?limit=${t}`)})}saveBranding(e,t){return __async(this,null,function*(){return this.apiRequest("/api/card-branding/save",{method:"POST",body:JSON.stringify(t)})})}saveBrandingforForm(e,t){return __async(this,null,function*(){return this.apiRequest("/api/forms/branding",{method:"POST",body:JSON.stringify(t)})})}getBranding(){return __async(this,null,function*(){return this.apiRequest("/api/card-branding/readbranding",{method:"GET"})})}resetBranding(){return __async(this,null,function*(){return this.apiRequest("/api/card-branding/resetbranding",{method:"DELETE"})})}}const g=new y,f=Object.freeze(Object.defineProperty({__proto__:null,QrProfileAppAPI:y,api:g},Symbol.toStringTag,{value:"Module"})),v={CLIENT_SALT:"qrmypro-secure-salt-2025",ITERATIONS:1e4,KEY_SIZE:256,hashPassword(e){return __async(this,null,function*(){if(!e)throw new Error("Password cannot be empty");try{if("undefined"!=typeof CryptoJS){return CryptoJS.PBKDF2(e,this.CLIENT_SALT,{keySize:this.KEY_SIZE/32,iterations:this.ITERATIONS,hasher:CryptoJS.algo.SHA256}).toString(CryptoJS.enc.Hex)}const t=new TextEncoder,n=t.encode(e),a=t.encode(this.CLIENT_SALT),i=yield crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits"]),s=yield crypto.subtle.deriveBits({name:"PBKDF2",salt:a,iterations:this.ITERATIONS,hash:"SHA-256"},i,this.KEY_SIZE),o=Array.from(new Uint8Array(s));return o.map(e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error("Failed to hash password on client side")}})},validatePasswordStrength(e){const t={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)},n=Object.values(t).filter(e=>e).length;let a="weak";return n>=5?a="strong":n>=3&&(a="medium"),{isValid:5===n,requirements:t,strength:a,validCount:n}},generateSecureToken(e=32){try{const t=new Uint8Array(e);return crypto.getRandomValues(t),Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error("Failed to generate secure token")}},checkAvailability:()=>({cryptoJS:"undefined"!=typeof CryptoJS,webCrypto:"undefined"!=typeof crypto&&void 0!==crypto.subtle,available:"undefined"!=typeof CryptoJS||"undefined"!=typeof crypto&&void 0!==crypto.subtle}),initialize(){return __async(this,null,function*(){try{if(!this.checkAvailability().available)return!1;yield this.hashPassword("test");return!0}catch(e){return!1}})}};function b(){return"QRP-"+Date.now()+"-"+Math.random().toString(36).substr(2,9)}function w(){return"auth-"+Math.random().toString(36).substr(2,15)}function C(){const e=document.getElementById("wallet-loader");e&&e.remove()}function S(e){const t=document.getElementById("loadingMessage");t&&t.remove();const n=document.createElement("div");n.id="loadingMessage",n.style.cssText="\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        background: rgba(102, 126, 234, 0.95);\n        color: white;\n        padding: 2rem 3rem;\n        border-radius: 15px;\n        z-index: 2000;\n        font-weight: 600;\n        text-align: center;\n        backdrop-filter: blur(10px);\n        box-shadow: 0 20px 40px rgba(0,0,0,0.3);\n    ",n.innerHTML=`\n        <div style="margin-bottom: 1rem;">‚è≥</div>\n        <div>${e}</div>\n    `,document.body.appendChild(n)}function E(){const e=document.getElementById("loadingMessage");e&&e.remove()}function x(){return __async(this,null,function*(){const t=document.querySelector(".copy-url-btn"),n=$(t).data("personal-card-url");try{navigator.clipboard&&window.isSecureContext?yield navigator.clipboard.writeText(n):(urlInput.select(),document.execCommand("copy"));const a=t.textContent;t.textContent="Copied!",t.style.background="#28a745",setTimeout(()=>{t.textContent=a,t.style.background="#667eea"},2e3);const{showSuccessMessage:i}=yield e(()=>__async(this,null,function*(){const{showSuccessMessage:e}=yield Promise.resolve().then(()=>r);return{showSuccessMessage:e}}));i("Card URL copied to clipboard!")}catch(a){const{showErrorMessage:t}=yield e(()=>__async(this,null,function*(){const{showErrorMessage:e}=yield Promise.resolve().then(()=>r);return{showErrorMessage:e}}));t("Failed to copy URL. Please copy manually.")}})}"undefined"!=typeof window&&(window.CryptoHelper=v);const k=function(){let e=null,t=null,n=null,a=null;const i={type:"info",title:"",closable:!0,closeOnOverlay:!0,autoHide:0,buttons:null,icon:null,onShow:null,onHide:null,className:""},s={success:"fas fa-check-circle",error:"fas fa-times-circle",warning:"fas fa-exclamation-triangle",info:"fas fa-info-circle",confirm:"fas fa-question-circle"},o={success:"Success",error:"Error",warning:"Warning",info:"Information",confirm:"Confirm Action"};function r(){"true"===t.dataset.closeOnOverlay&&c(!1)}function l(l,d={}){return e||(e=document.createElement("div"),e.className="message-box-overlay",e.innerHTML='\n            <div class="message-box">\n                <div class="message-box-header">\n                    <div class="message-box-icon">\n                        <i></i>\n                    </div>\n                    <h3 class="message-box-title"></h3>\n                    <button class="message-box-close" aria-label="Close">\n                        <i class="fas fa-times"></i>\n                    </button>\n                </div>\n                <div class="message-box-body">\n                    <div class="message-box-content"></div>\n                </div>\n                <div class="message-box-footer"></div>\n            </div>\n        ',document.body.appendChild(e),t=e.querySelector(".message-box"),e.addEventListener("click",r),e.querySelector(".message-box-close").addEventListener("click",()=>c(!1)),t.addEventListener("click",e=>e.stopPropagation())),new Promise(r=>{n=r;const u=__spreadValues(__spreadValues({},i),d),p=u.type,m=u.title||o[p]||"Message",h=u.icon||s[p]||s.info;t.className="message-box",u.className&&t.classList.add(u.className);const y=e.querySelector(".message-box-icon");y.className=`message-box-icon ${p}`,y.querySelector("i").className=h,e.querySelector(".message-box-title").textContent=m;const g=e.querySelector(".message-box-content");"string"==typeof l?g.innerHTML=`<p>${l}</p>`:(g.innerHTML="",g.appendChild(l));e.querySelector(".message-box-close").style.display=u.closable?"flex":"none",t.dataset.closeOnOverlay=u.closeOnOverlay,function(t){const n=e.querySelector(".message-box-footer");n.innerHTML="";let a=t.buttons;a||(a="confirm"===t.type?[{text:"Cancel",style:"secondary",value:!1},{text:"OK",style:"primary",value:!0}]:[{text:"OK",style:"primary",value:!0}]);a.forEach(e=>{const t=document.createElement("button");if(t.className=`message-box-btn message-box-btn-${e.style||"primary"}`,t.textContent=e.text,e.icon){const n=document.createElement("i");n.className=e.icon,t.insertBefore(n,t.firstChild)}t.addEventListener("click",()=>__async(this,null,function*(){if("function"==typeof e.onClick){if(!1===(yield e.onClick()))return}c(void 0===e.value||e.value)})),n.appendChild(t)})}(u),document.body.classList.add("message-box-open"),e.classList.add("active"),"function"==typeof u.onShow&&u.onShow(),u.autoHide>0&&(clearTimeout(a),a=setTimeout(()=>{c(null)},u.autoHide))})}function c(i){clearTimeout(a),e.classList.remove("active"),document.body.classList.remove("message-box-open");const s=t.dataset;"function"==typeof s.onHide&&s.onHide(),n&&(n(i),n=null)}return{show:l,hide:c,success:function(e,t=null){return l(e,{type:"success",title:t||"Success"})},error:function(e,t=null){return l(e,{type:"error",title:t||"Error"})},warning:function(e,t=null){return l(e,{type:"warning",title:t||"Warning"})},info:function(e,t=null){return l(e,{type:"info",title:t||"Information"})},confirm:function(e,t="Confirm Action",n={}){return l(e,__spreadValues({type:"confirm",title:t,closable:!0,closeOnOverlay:!1,buttons:n.buttons||[{text:n.cancelText||"Cancel",style:"secondary",value:!1},{text:n.confirmText||"OK",style:n.confirmStyle||"primary",value:!0}]},n))},prompt:function(e,n="Enter Value",a={}){const i="message-box-input-"+Date.now(),s=a.placeholder||"",o=a.defaultValue||"",r=`\n            <p>${e}</p>\n            <div class="message-box-input-wrapper">\n                <input \n                    type="${a.inputType||"text"}" \n                    id="${i}" \n                    class="message-box-input" \n                    placeholder="${s}"\n                    value="${o}"\n                >\n            </div>\n        `;return new Promise(e=>{l(r,__spreadValues({type:"info",title:n,closable:!0,closeOnOverlay:!1,buttons:[{text:"Cancel",style:"secondary",onClick:()=>(e(null),!0)},{text:"OK",style:"primary",onClick:()=>{const n=document.getElementById(i),s=n?n.value.trim():"";return a.required&&!s?(n.focus(),t.classList.add("shake"),setTimeout(()=>t.classList.remove("shake"),500),!1):(e(s),!0)}}],onShow:()=>{setTimeout(()=>{const e=document.getElementById(i);e&&(e.focus(),e.select())},100)}},a))})},loading:function(t="Please wait...",n="Loading"){return l(`\n            <div style="text-align: center;">\n                <div class="message-box-loading" style="margin: 0 auto 1rem;"></div>\n                <p>${t}</p>\n            </div>\n        `,{type:"info",title:n,closable:!1,closeOnOverlay:!1,buttons:[]}),{hide:()=>c(null),updateMessage:t=>{const n=e.querySelector(".message-box-content p");n&&(n.textContent=t)}}},isVisible:function(){return e&&e.classList.contains("active")},destroy:function(){e&&(c(null),document.body.removeChild(e),e=null,t=null)}}}();let q=class{constructor(){this.currentConfig=null,this.activeFields=[],this.ctaButtons=[],this.isDirty=!1,this.customQuestions=[],this.maxCustomQuestions=5,this.questionsBank={},this.currentIndustry="",this.behaviorSettings={allowMultipleShows:!0,resetAfterClose:!0,blockAfterSubmit:!0},this.behaviorPresets={recommended:{allowMultipleShows:!0,resetAfterClose:!0,blockAfterSubmit:!0},once:{allowMultipleShows:!1,resetAfterClose:!1,blockAfterSubmit:!0},persistent:{allowMultipleShows:!0,resetAfterClose:!0,blockAfterSubmit:!1},retriggerable:{allowMultipleShows:!1,resetAfterClose:!0,blockAfterSubmit:!0}},this.behaviorPreviewTexts={"true-true-true":"‚úÖ Form shows multiple times until visitor submits. After submission, all clicks work normally. (Recommended)","false-false-true":"üìå Form shows ONCE per page visit and never again. Very non-intrusive.","true-true-false":"‚ö†Ô∏è Form shows EVERY time a trigger fires, even after submission. (Aggressive - may annoy users)","false-true-true":"üîÑ Form shows once, but can appear again if visitor closes it and triggers another action.","true-false-true":"üîÅ Form shows on every trigger, but closing permanently hides it.","false-false-false":"üîí Form shows once and is permanently blocked afterward.","true-false-false":"‚ôæÔ∏è Form keeps showing continuously without reset.","false-true-false":"üîÉ Form shows once per cycle, allowing retriggering after close."}}init(){this.attachEventListeners(),this.initBehaviorSettings(),this.loadFormConfiguration(),this.initCustomQuestions();$("#notificationEmail").on("keydown paste drop",function(e){e.preventDefault()})}attachEventListeners(){$("#saveFormConfigBtn").off("click").on("click",()=>this.saveConfiguration()),$("#formActiveToggle").off("change").on("change",e=>this.toggleFormStatus(e.target.checked)),$("#useBrandingColors").off("click").on("click",()=>this.applyBrandingColors()),$("#formPrimaryColor").off("input").on("input",e=>{$("#formPrimaryColorHex").val(e.target.value),this.updatePreview()}),$("#formSecondaryColor").off("input").on("input",e=>{$("#formSecondaryColorHex").val(e.target.value),this.updatePreview()}),$("#formTitle, #formSubtitle, #formDescription").off("input").on("input",()=>{this.updatePreview(),this.updatePreview()}),$("#industrySelect").off("change").on("change",e=>this.handleIndustryChange(e.target.value)),$("#addCustomQuestionBtn").off("click").on("click",()=>this.addCustomQuestion());const e=$(".form-builder-container");e.off("input.customQuestions click.customQuestions"),e.on("input.customQuestions",".question-input",e=>{this.handleQuestionInput(e)}),e.on("click.customQuestions",".suggestion-item",e=>{this.selectSuggestion(e)}),e.on("click.customQuestions",".btn-delete-question",e=>{e.preventDefault(),e.stopPropagation(),this.deleteCustomQuestion(e)}),e.on("click.customQuestions",".answer-type-option",e=>{this.selectAnswerType(e)}),e.on("click.customQuestions",".btn-add-option",e=>{this.addAnswerOption(e)}),e.on("click.customQuestions",".btn-remove-option",e=>{this.removeAnswerOption(e)}),e.on("input.customQuestions",".option-input",e=>{const t=$(e.target).data("question-id"),n=$(e.target).data("option-index"),a=$(e.target).val(),i=this.customQuestions.find(e=>e.id===t);i&&i.options&&(i.options[n]=a)}),$("#formTitle, #formSubtitle, #formDescription").off("input").on("input",()=>{this.isDirty=!0,this.updatePreview()}),$("#formDescription").off("input").on("input",e=>{$("#descCharCount").text(e.target.value.length)}),$("#triggerOnLoad").off("change").on("change",e=>{$("#onLoadConfig").toggle(e.target.checked)}),$("#triggerOnScroll").off("change").on("change",e=>{$("#onScrollConfig").toggle(e.target.checked)}),$("#scrollPercentage").off("input").on("input",e=>{$("#scrollPercentageValue").text(e.target.value+"%")}),$("#addFieldBtn").off("click").on("click",()=>this.showFieldLibrary()),$(".field-card").off("click").on("click",e=>{const t=$(e.currentTarget).data("field-type");this.addField(t)}),$("#addCTAButton").off("click").on("click",()=>this.showCTAModal()),$("#saveCTAButton").off("click").on("click",()=>this.saveCTAButton()),$("#cancelCTAButton, #closeCTAModal").off("click").on("click",()=>this.closeCTAModal()),$("#saveFieldConfig").off("click").on("click",()=>this.saveFieldConfiguration()),$("#cancelFieldConfig, #closeFieldConfigModal").off("click").on("click",()=>this.closeFieldConfigModal()),$("#previewFormBtn").off("click").on("click",()=>this.showFullPreview()),$("#exportSubmissionsBtn").off("click").on("click",()=>this.exportSubmissions()),$(".device-btn").off("click").on("click",e=>{$(".device-btn").removeClass("active"),$(e.currentTarget).addClass("active");const t=$(e.currentTarget).data("device");this.switchPreviewDevice(t)}),$("#closeSubmissionDetailsBtn, #closeSubmissionModal").off("click").on("click",()=>{$("#submissionDetailsModal").hide()})}initBehaviorSettings(){this.behaviorElements={allowMultiple:document.getElementById("allowMultipleShows"),resetAfter:document.getElementById("resetAfterClose"),blockAfter:document.getElementById("blockAfterSubmit"),preset:document.getElementById("behaviorPreset"),preview:document.getElementById("behaviorPreviewText")},this.behaviorElements.allowMultiple&&(this.loadBehaviorSettings(),this.attachBehaviorListeners(),this.updateBehaviorPreview())}attachBehaviorListeners(){this.behaviorElements.allowMultiple&&$(this.behaviorElements.allowMultiple).off("change").on("change",e=>{this.behaviorSettings.allowMultipleShows=e.target.checked,this.handleBehaviorChange()}),this.behaviorElements.resetAfter&&$(this.behaviorElements.resetAfter).off("change").on("change",e=>{this.behaviorSettings.resetAfterClose=e.target.checked,this.handleBehaviorChange()}),this.behaviorElements.blockAfter&&$(this.behaviorElements.blockAfter).off("change").on("change",e=>{this.behaviorSettings.blockAfterSubmit=e.target.checked,this.handleBehaviorChange()}),this.behaviorElements.preset&&$(this.behaviorElements.preset).off("change").on("change",e=>{this.applyBehaviorPreset(e.target.value)})}handleBehaviorChange(){this.updateBehaviorPreview(),this.detectBehaviorPreset(),this.saveBehaviorSettings(),this.isDirty=!0}applyBehaviorPreset(e){if("custom"===e)return;const t=this.behaviorPresets[e];t&&(this.behaviorSettings=__spreadValues({},t),this.updateBehaviorCheckboxes(),this.updateBehaviorPreview(),this.saveBehaviorSettings(),this.isDirty=!0)}detectBehaviorPreset(){const e=`${this.behaviorSettings.allowMultipleShows}-${this.behaviorSettings.resetAfterClose}-${this.behaviorSettings.blockAfterSubmit}`;for(const[t,n]of Object.entries(this.behaviorPresets)){if(e===`${n.allowMultipleShows}-${n.resetAfterClose}-${n.blockAfterSubmit}`)return void(this.behaviorElements.preset&&$(this.behaviorElements.preset).val(t))}this.behaviorElements.preset&&$(this.behaviorElements.preset).val("custom")}updateBehaviorCheckboxes(){this.behaviorElements.allowMultiple&&(this.behaviorElements.allowMultiple.checked=this.behaviorSettings.allowMultipleShows),this.behaviorElements.resetAfter&&(this.behaviorElements.resetAfter.checked=this.behaviorSettings.resetAfterClose),this.behaviorElements.blockAfter&&(this.behaviorElements.blockAfter.checked=this.behaviorSettings.blockAfterSubmit)}updateBehaviorPreview(){if(!this.behaviorElements.preview)return;const e=`${this.behaviorSettings.allowMultipleShows}-${this.behaviorSettings.resetAfterClose}-${this.behaviorSettings.blockAfterSubmit}`,t=this.behaviorPreviewTexts[e]||"‚öôÔ∏è Custom configuration active.";$(this.behaviorElements.preview).text(t)}saveBehaviorSettings(){try{localStorage.setItem("formBehaviorSettings",JSON.stringify(this.behaviorSettings))}catch(e){}}loadBehaviorSettings(){try{const e=localStorage.getItem("formBehaviorSettings");if(e){const t=JSON.parse(e);this.behaviorSettings=__spreadValues(__spreadValues({},this.behaviorSettings),t),this.updateBehaviorCheckboxes()}}catch(e){}}getBehaviorSettings(){return __spreadValues({},this.behaviorSettings)}loadBehaviorFromConfig(e){if(!e||!e.settings)return;const{allowMultipleShows:t,resetAfterClose:n,blockAfterSubmit:a}=e.settings;void 0!==t&&(this.behaviorSettings.allowMultipleShows=t),void 0!==n&&(this.behaviorSettings.resetAfterClose=n),void 0!==a&&(this.behaviorSettings.blockAfterSubmit=a),this.updateBehaviorCheckboxes(),this.updateBehaviorPreview(),this.detectBehaviorPreset()}resetBehaviorSettings(){this.behaviorSettings={allowMultipleShows:!0,resetAfterClose:!0,blockAfterSubmit:!0},this.updateBehaviorCheckboxes(),this.updateBehaviorPreview(),this.detectBehaviorPreset(),this.saveBehaviorSettings()}loadFormConfiguration(){return __async(this,null,function*(){try{const e=yield fetch("/api/forms/config",{method:"GET",credentials:"include"}),t=yield e.json();t.success&&(this.currentConfig=t.formConfig,this.populateFormBuilder(t.formConfig),this.loadBehaviorFromConfig(t.formConfig),this.updateformid(t.formConfig),this.setupCopyFormIDButton())}catch(e){n("Failed to load form configuration")}})}populateFormBuilder(e){var t,n,a,i,s,o,r,l,c,d,u,p,m,h;$("#formTitle").val(e.formTitle||"Get In Touch"),$("#formSubtitle").val(e.formSubtitle||""),$("#formDescription").val(e.formDescription||""),$("#descCharCount").text((e.formDescription||"").length),$("#formPrimaryColor").val((null==(t=e.branding)?void 0:t.primaryColor)||"#1e7133"),$("#formPrimaryColorHex").val((null==(n=e.branding)?void 0:n.primaryColor)||"#1e7133"),$("#formSecondaryColor").val((null==(a=e.branding)?void 0:a.secondaryColor)||"#808b2d"),$("#formSecondaryColorHex").val((null==(i=e.branding)?void 0:i.secondaryColor)||"#808b2d"),this.activeFields=e.fields||[],this.renderActiveFields(),this.ctaButtons=e.ctaButtons||[],this.renderCTAButtons(),e.triggers&&($("#triggerOnLoad").prop("checked",(null==(s=e.triggers.showOnLoad)?void 0:s.enabled)||!1),$("#onLoadDelay").val((null==(o=e.triggers.showOnLoad)?void 0:o.delaySeconds)||3),$("#onLoadConfig").toggle((null==(r=e.triggers.showOnLoad)?void 0:r.enabled)||!1),$("#triggerOnClick").prop("checked",(null==(l=e.triggers.showOnClick)?void 0:l.enabled)||!1),(null==(c=e.triggers.showOnClick)?void 0:c.targetElements)&&($('#onClickConfig input[type="checkbox"]').prop("checked",!1),e.triggers.showOnClick.targetElements.forEach(e=>{$(`#onClickConfig input[type="checkbox"][value="${e}"]`).prop("checked",!0)})),$("#triggerOnExit").prop("checked",(null==(d=e.triggers.showOnExit)?void 0:d.enabled)||!1),$("#triggerOnScroll").prop("checked",(null==(u=e.triggers.showOnScroll)?void 0:u.enabled)||!1),$("#scrollPercentage").val((null==(p=e.triggers.showOnScroll)?void 0:p.scrollPercentage)||50),$("#scrollPercentageValue").text(((null==(m=e.triggers.showOnScroll)?void 0:m.scrollPercentage)||50)+"%"),$("#onScrollConfig").toggle((null==(h=e.triggers.showOnScroll)?void 0:h.enabled)||!1)),e.settings&&($("#submitButtonText").val(e.settings.submitButtonText||"Submit"),$("#successMessage").val(e.settings.successMessage||"Thank you for your submission!"),$("#enableAutoClose").prop("checked",!1!==e.settings.enableAutoClose),$("#autoCloseDelay").val(e.settings.autoCloseDelaySeconds||3),$("#allowMultipleSubmissions").prop("checked",e.settings.allowMultipleSubmissions||!1),$("#enableNotifications").prop("checked",e.settings.enableNotifications||!1),$("#notificationEmail").val(e.settings.notificationEmail||"")),$("#formActiveToggle").prop("checked",!1!==e.isActive),$("#formStatusText").text(!1!==e.isActive?"Form is currently active":"Form is currently inactive"),e.customQuestions&&(this.customQuestions=[...e.customQuestions],this.renderCustomQuestions()),e.selectedIndustry&&(this.currentIndustry=e.selectedIndustry,$("#industrySelect").val(e.selectedIndustry)),this.updateCustomQuestionsCount(),this.toggleAddQuestionButton(),this.updatePreview(),this.updateFieldCardStates()}saveConfiguration(){return __async(this,null,function*(){try{const e=this.buildConfigObject(),a=yield fetch("/api/forms/config",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)}),i=yield a.json();i.success?(t("Form configuration saved successfully!"),this.currentConfig=i.formConfig,this.isDirty=!1):n(i.message||"Failed to save configuration")}catch(e){n("Failed to save form configuration")}})}buildConfigObject(){const e={showOnLoad:{enabled:$("#triggerOnLoad").is(":checked"),delaySeconds:parseInt($("#onLoadDelay").val())||3},showOnClick:{enabled:$("#triggerOnClick").is(":checked"),targetElements:[]},showOnExit:{enabled:$("#triggerOnExit").is(":checked")},showOnScroll:{enabled:$("#triggerOnScroll").is(":checked"),scrollPercentage:parseInt($("#scrollPercentage").val())||50}};return $('#onClickConfig input[type="checkbox"]:checked').each(function(){e.showOnClick.targetElements.push($(this).val())}),{formTitle:$("#formTitle").val(),formSubtitle:$("#formSubtitle").val(),formDescription:$("#formDescription").val(),branding:{primaryColor:$("#formPrimaryColor").val(),secondaryColor:$("#formSecondaryColor").val()},fields:this.activeFields,ctaButtons:this.ctaButtons,triggers:e,settings:__spreadValues({submitButtonText:$("#submitButtonText").val(),successMessage:$("#successMessage").val(),enableAutoClose:$("#enableAutoClose").is(":checked"),autoCloseDelaySeconds:parseInt($("#autoCloseDelay").val())||3,allowMultipleSubmissions:$("#allowMultipleSubmissions").is(":checked"),enableNotifications:$("#enableNotifications").is(":checked"),notificationEmail:$("#notificationEmail").val()},this.getBehaviorSettings()),customQuestions:this.customQuestions||[],selectedIndustry:this.currentIndustry||""}}toggleFormStatus(e){return __async(this,null,function*(){try{const e=yield fetch("/api/forms/config/toggle",{method:"PUT",credentials:"include"}),n=yield e.json();n.success&&($("#formStatusText").text(n.isActive?"Form is currently active":"Form is currently inactive"),t(`Form ${n.isActive?"activated":"deactivated"} successfully`))}catch(e){n("Failed to toggle form status")}})}addField(e){const a={name:{icon:"fa-user",label:"Full Name",placeholder:"Enter your name"},email:{icon:"fa-envelope",label:"Email Address",placeholder:"your@email.com"},phone:{icon:"fa-phone",label:"Phone Number",placeholder:"+1 (555) 123-4567"},company:{icon:"fa-building",label:"Company",placeholder:"Company name"},job_title:{icon:"fa-briefcase",label:"Job Title",placeholder:"Your position"},website:{icon:"fa-globe",label:"Website",placeholder:"https://example.com"},notes:{icon:"fa-sticky-note",label:"Message",placeholder:"Your message..."},feedback:{icon:"fa-comment",label:"Feedback",placeholder:"Share your feedback"},review_rating:{icon:"fa-star",label:"Rating",placeholder:"Rate your experience"},question:{icon:"fa-question-circle",label:"Question",placeholder:"Ask a question"},calendly_link:{icon:"fa-calendar-alt",label:"Schedule Meeting",placeholder:"Calendly URL"}}[e];if(this.activeFields.find(t=>t.fieldType===e))return void n(`${a.label} field already exists in the form. You can only add one ${a.label} field.`);const i={fieldType:e,label:a.label,placeholder:a.placeholder,isRequired:!1,isEnabled:!0,order:this.activeFields.length};this.activeFields.push(i),this.renderActiveFields(),this.updatePreview(),this.updateFieldCardStates(),this.isDirty=!0,t(`${a.label} field added`)}renderActiveFields(){const e=$("#fieldsDropzone");if(0===this.activeFields.length)return e.html('\n                <div class="empty-state">\n                    <i class="fas fa-mouse-pointer"></i>\n                    <p>Click on a field above to add it to your form</p>\n                </div>\n            '),void $("#activeFieldCount").text("(0 fields)");const t={name:"fa-user",email:"fa-envelope",phone:"fa-phone",company:"fa-building",job_title:"fa-briefcase",website:"fa-globe",notes:"fa-sticky-note",feedback:"fa-comment",review_rating:"fa-star",question:"fa-question-circle",calendly_link:"fa-calendar-alt"};let n="";this.activeFields.forEach((e,a)=>{n+=`\n                <div class="active-field-item" data-index="${a}">\n                    <div class="field-item-left">\n                        <i class="fas fa-grip-vertical field-drag-handle"></i>\n                        <i class="fas ${t[e.fieldType]} field-item-icon"></i>\n                        <div class="field-item-info">\n                            <div class="field-item-label">${e.label}</div>\n                            <div class="field-item-type">${e.fieldType.replace("_"," ")}</div>\n                        </div>\n                    </div>\n                    <div class="field-item-badges">\n                        <span class="field-badge ${e.isRequired?"required":"optional"}">\n                            ${e.isRequired?"Required":"Optional"}\n                        </span>\n                    </div>\n                    <div class="field-item-actions">\n                        <button class="field-action-btn edit-field" data-index="${a}">\n                            <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="field-action-btn delete delete-field" data-index="${a}">\n                            <i class="fas fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n            `}),e.html(n),$("#activeFieldCount").text(`(${this.activeFields.length} fields)`),$(".edit-field").off("click").on("click",e=>{const t=$(e.currentTarget).data("index");this.editField(t)}),$(".delete-field").off("click").on("click",e=>{const t=$(e.currentTarget).data("index");this.deleteField(t)})}editField(e){const t=this.activeFields[e];$("#configFieldType").val(t.fieldType),$("#configFieldLabel").val(t.label),$("#configFieldPlaceholder").val(t.placeholder||""),$("#configFieldRequired").prop("checked",t.isRequired),$("#configFieldEnabled").prop("checked",t.isEnabled),$("#fieldConfigModal").data("edit-index",e),$("#fieldConfigModal").show()}saveFieldConfiguration(){const e=$("#fieldConfigModal").data("edit-index");void 0!==e&&this.activeFields[e]&&(this.activeFields[e].label=$("#configFieldLabel").val(),this.activeFields[e].placeholder=$("#configFieldPlaceholder").val(),this.activeFields[e].isRequired=$("#configFieldRequired").is(":checked"),this.activeFields[e].isEnabled=$("#configFieldEnabled").is(":checked"),this.renderActiveFields(),this.updatePreview(),this.isDirty=!0,t("Field updated successfully")),this.closeFieldConfigModal()}closeFieldConfigModal(){$("#fieldConfigModal").hide(),$("#fieldConfigModal").removeData("edit-index")}deleteField(e){confirm("Are you sure you want to remove this field?")&&(this.activeFields.splice(e,1),this.renderActiveFields(),this.updatePreview(),this.updateFieldCardStates(),this.isDirty=!0,t("Field removed"),k.show("Field removed"))}updateFieldCardStates(){$(".field-card").removeClass("added"),this.activeFields.forEach(e=>{$(`.field-card[data-field-type="${e.fieldType}"]`).addClass("added")})}showCTAModal(){$("#ctaButtonModal").show(),$("#ctaButtonText").val(""),$("#ctaButtonUrl").val(""),$("#ctaButtonStyle").val("primary"),$("#ctaButtonModal").removeData("edit-index")}closeCTAModal(){$("#ctaButtonModal").hide()}saveCTAButton(){try{const e=$("#ctaButtonText").val(),a=$("#ctaButtonUrl").val(),i=$("#ctaButtonStyle").val();if(!e||!a)return n("Please fill in all CTA button fields"),this.closeCTAModal(),void k.show("Please fill in all CTA button fields");const s=$("#ctaButtonModal").data("edit-index");void 0!==s?this.ctaButtons[s]={text:e,link:a,style:i}:this.ctaButtons.push({text:e,link:a,style:i}),this.renderCTAButtons(),this.updatePreview(),this.isDirty=!0,this.closeCTAModal(),t("CTA button saved"),k.show("CTA button saved"),$("#saveFormConfigBtn").trigger("click")}catch(e){k.error("We are solving this. Error while Adding button:","Hang Tight")}}renderCTAButtons(){const e=$("#ctaButtonsList");if(0===this.ctaButtons.length)return void e.html('<p class="empty-cta-text">No CTA buttons added yet</p>');let t="";this.ctaButtons.forEach((e,n)=>{t+=`\n                <div class="cta-button-item">\n                    <div class="cta-button-preview ${e.style}">\n                        ${e.text}\n                    </div>\n                    <div class="cta-button-actions">\n                        <button class="field-action-btn edit-cta" data-index="${n}">\n                            <i class="fas fa-edit"></i>\n                        </button>\n                        <button class="field-action-btn delete delete-cta" data-index="${n}">\n                            <i class="fas fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n            `}),e.html(t),$(".edit-cta").off("click").on("click",e=>{const t=$(e.currentTarget).data("index");this.editCTAButton(t)}),$(".delete-cta").off("click").on("click",e=>{const t=$(e.currentTarget).data("index");this.deleteCTAButton(t)})}editCTAButton(e){const t=this.ctaButtons[e];$("#ctaButtonText").val(t.text),$("#ctaButtonUrl").val(t.url),$("#ctaButtonStyle").val(t.style),$("#ctaButtonModal").data("edit-index",e),$("#ctaButtonModal").show()}deleteCTAButton(e){return __async(this,null,function*(){try{const n=yield k.show("<p>Are you sure you want to remove this CTA button?.</p>",{type:"warning",title:"Deleting CTA Button",closable:!0,closeOnOverlay:!1,buttons:[{text:"Cancel",style:"secondary",value:!1},{text:"Delete Button",style:"primary",value:!0,icon:"fas fa-trash-can"}]});!1===n||!0===n&&(this.ctaButtons.splice(e,1),this.renderCTAButtons(),this.updatePreview(),this.isDirty=!0,t("CTA button removed"),k.success("CTA Button Removed.","CTA Removal Update"),$("#saveFormConfigBtn").trigger("click"))}catch(n){k.error("Error While removing the CTA.","Error")}})}updatePreview(){const e=$("#formPrimaryColor").val(),t=$("#formSecondaryColor").val(),n=$("#formTitle").val()||"Get In Touch",a=$("#formSubtitle").val();let i=`\n            <div class="form-preview-header" style="margin-bottom: 20px;">\n                <h2 style="color: ${e}; margin: 0 0 8px 0; font-size: 1.8rem;">${n}</h2>\n                ${a?`<p style="color: #718096; margin: 0;">${a}</p>`:""}\n            </div>\n            <div class="form-preview-fields">\n        `;this.activeFields.forEach(e=>{e.isEnabled&&(i+=`\n                    <div class="preview-field-group" style="margin-bottom: 15px;">\n                        <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #2d3748;">\n                            ${e.label}\n                            ${e.isRequired?'<span style="color: #e53e3e;">*</span>':""}\n                        </label>\n                        ${"notes"===e.fieldType||"feedback"===e.fieldType?`<textarea style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;" placeholder="${e.placeholder||""}" rows="3"></textarea>`:"review_rating"===e.fieldType?'<div class="preview-rating-stars" data-rating="0">\n                                <span class="preview-star" data-rating="1" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="2" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="3" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="4" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="5" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <div style="margin-top: 8px; font-size: 14px; color: #718096;">\n                                    <span class="rating-text">Click to rate</span>\n                                </div>\n                            </div>':`<input type="text" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;" placeholder="${e.placeholder||""}">`}\n                    </div>\n                `)}),this.customQuestions&&this.customQuestions.length>0&&(i+=`\n                <div class="preview-custom-questions-divider" style="margin: 25px 0 20px 0; border-top: 1px solid #e2e8f0; padding-top: 20px;">\n                    <h4 style="color: ${e}; margin: 0 0 15px 0; font-size: 1.1rem; font-weight: 600;">Additional Questions</h4>\n                </div>\n            `,this.customQuestions.forEach((e,t)=>{if(e.question&&""!==e.question.trim()){let t="";switch(e.answerType){case"text":default:t='<input type="text" style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;" placeholder="Enter your answer...">';break;case"textarea":t='<textarea style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px;" placeholder="Enter detailed response..." rows="3"></textarea>';break;case"radio":t='<div class="preview-radio-options" style="margin-top: 8px;">',(e.options||["Option 1","Option 2"]).forEach((n,a)=>{t+=`\n                                    <label style="display: block; margin-bottom: 8px; cursor: pointer; color: #4a5568;">\n                                        <input type="radio" name="custom_${e.id}" value="${n}" style="margin-right: 8px;">\n                                        ${n}\n                                    </label>\n                                `}),t+="</div>";break;case"checkbox":t='<div class="preview-checkbox-options" style="margin-top: 8px;">',(e.options||["Option 1","Option 2"]).forEach((n,a)=>{t+=`\n                                    <label style="display: block; margin-bottom: 8px; cursor: pointer; color: #4a5568;">\n                                        <input type="checkbox" name="custom_${e.id}" value="${n}" style="margin-right: 8px;">\n                                        ${n}\n                                    </label>\n                                `}),t+="</div>";break;case"select":t='<select style="width: 100%; padding: 10px; border: 2px solid #e2e8f0; border-radius: 6px; color: #4a5568;">',t+='<option value="">Select an option...</option>',(e.options||["Option 1","Option 2"]).forEach((e,n)=>{t+=`<option value="${e}">${e}</option>`}),t+="</select>";break;case"rating":t='<div class="preview-rating-stars" data-rating="0">\n                                <span class="preview-star" data-rating="1" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="2" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="3" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="4" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <span class="preview-star" data-rating="5" style="font-size: 28px; color: #e2e8f0; cursor: pointer; transition: color 0.2s ease;">‚òÖ</span>\n                                <div style="margin-top: 8px; font-size: 14px; color: #718096;">\n                                    <span class="rating-text">Click to rate</span>\n                                </div>\n                            </div>'}i+=`\n                        <div class="preview-field-group preview-custom-question" style="margin-bottom: 15px;">\n                            <label style="display: block; font-weight: 600; margin-bottom: 5px; color: #2d3748;">\n                                ${e.question}\n                                ${e.isRequired?'<span style="color: #e53e3e;">*</span>':""}\n                                <span style="font-size: 12px; color: #718096; font-weight: normal; margin-left: 8px;">(Custom Question)</span>\n                            </label>\n                            ${t}\n                        </div>\n                    `}})),i+="</div>",this.ctaButtons.length>0&&(i+='<div class="preview-cta-buttons" style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">',this.ctaButtons.forEach(n=>{const a="primary"===n.style?`background: ${e}; color: white; border: none;`:"secondary"===n.style?`background: ${t}; color: white; border: none;`:`background: white; color: ${e}; border: 2px solid ${e};`;i+=`\n                    <button style="${a} padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer;">\n                        ${n.text}\n                    </button>\n                `}),i+="</div>");const s=$("#submitButtonText").val()||"Submit";i+=`\n            <button style="width: 100%; margin-top: 20px; background: ${e}; color: white; padding: 12px; border: none; border-radius: 6px; font-weight: 600; font-size: 1rem; cursor: pointer;">\n                ${s}\n            </button>\n        `,$("#formPreviewContainer").html(i)}showFullPreview(){this.updatePreview();const e=$("#formPreviewContainer").html();if(this.customQuestions&&this.customQuestions.length>0&&this.customQuestions.forEach((e,t)=>{}),0===$("#fullPreviewModal").length){const e='\n                <div id="fullPreviewModal" class="modal" style="display: none;">\n                    <div class="modal-content modal-preview-fullscreen">\n                        <div class="modal-header">\n                            <h3>\n                                <i class="fas fa-eye"></i>\n                                Form Preview\n                            </h3>\n                            <button class="modal-close" id="closeFullPreviewModal">\n                                <i class="fas fa-times"></i>\n                            </button>\n                        </div>\n                        <div class="modal-body modal-preview-body">\n                            <div class="preview-device-selector">\n                                <button class="device-btn preview-device-toggle active" data-preview-device="desktop">\n                                    <i class="fas fa-desktop"></i> Desktop\n                                </button>\n                                <button class="device-btn preview-device-toggle" data-preview-device="mobile">\n                                    <i class="fas fa-mobile-alt"></i> Mobile\n                                </button>\n                            </div>\n                            <div id="fullPreviewContent" class="full-preview-wrapper">\n                                \x3c!-- Preview content will be rendered here --\x3e\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button class="btn-secondary" id="closeFullPreview">\n                                <i class="fas fa-arrow-left"></i> Back to Editor\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            ';$("body").append(e)}$("#fullPreviewContent").html(`\n            <div class="preview-container desktop-preview">\n                ${e}\n            </div>\n        `),$("#fullPreviewModal").show(),$(".preview-device-toggle").off("click").on("click",e=>{$(".preview-device-toggle").removeClass("active"),$(e.currentTarget).addClass("active");"mobile"===$(e.currentTarget).data("preview-device")?$(".preview-container").removeClass("desktop-preview").addClass("mobile-preview"):$(".preview-container").removeClass("mobile-preview").addClass("desktop-preview")}),$("#closeFullPreviewModal, #closeFullPreview").off("click").on("click",()=>{$("#fullPreviewModal").hide()}),this.initPreviewRatingStars()}initPreviewRatingStars(){$(document).off("mouseenter.previewRating").on("mouseenter.previewRating",".preview-star",function(){const e=parseInt($(this).data("rating"));$(this).closest(".preview-rating-stars").find(".preview-star").each(function(t){t<e?$(this).css("color","#fbbf24"):$(this).css("color","#e2e8f0")})}),$(document).off("mouseleave.previewRating").on("mouseleave.previewRating",".preview-rating-stars",function(){const e=parseInt($(this).data("rating"));$(this).find(".preview-star").each(function(t){t<e?$(this).css("color","#fbbf24"):$(this).css("color","#e2e8f0")})}),$(document).off("click.previewRating").on("click.previewRating",".preview-star",function(){const e=parseInt($(this).data("rating")),t=$(this).closest(".preview-rating-stars");t.data("rating",e),t.attr("data-rating",e),t.find(".preview-star").each(function(t){t<e?$(this).css("color","#fbbf24"):$(this).css("color","#e2e8f0")});t.find(".rating-text").text({1:"‚≠ê Poor",2:"‚≠ê‚≠ê Fair",3:"‚≠ê‚≠ê‚≠ê Good",4:"‚≠ê‚≠ê‚≠ê‚≠ê Very Good",5:"‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent"}[e]||"Click to rate")})}switchPreviewDevice(e){"mobile"===e?$(".preview-container").removeClass("desktop-preview").addClass("mobile-preview"):$(".preview-container").removeClass("mobile-preview").addClass("desktop-preview")}applyBrandingColorsFromData(e){try{const{gradientStart:n,gradientEnd:a}=e;$("#formPrimaryColor").val(n||"#667eea"),$("#formPrimaryColorHex").val(n||"#667eea"),$("#formSecondaryColor").val(a||"#764ba2"),$("#formSecondaryColorHex").val(a||"#764ba2"),this.updatePreview(),this.isDirty=!0,t("‚ú® Branding colors auto-applied from saved preferences")}catch(n){}}applyBrandingColors(){return __async(this,null,function*(){try{const{api:n}=yield e(()=>__async(this,null,function*(){const{api:e}=yield Promise.resolve().then(()=>f);return{api:e}})),a=yield n.getBranding();if(a.success&&a.data){const{gradientStart:e,gradientEnd:n}=a.data;$("#formPrimaryColor").val(e||"#667eea"),$("#formPrimaryColorHex").val(e||"#667eea"),$("#formSecondaryColor").val(n||"#764ba2"),$("#formSecondaryColorHex").val(n||"#764ba2"),this.updatePreview(),this.isDirty=!0,t("Branding colors applied successfully")}else $("#formPrimaryColor").val("#667eea"),$("#formPrimaryColorHex").val("#667eea"),$("#formSecondaryColor").val("#764ba2"),$("#formSecondaryColorHex").val("#764ba2"),this.updatePreview(),t("Default colors applied")}catch(a){n("Failed to load branding colors. Using defaults."),$("#formPrimaryColor").val("#667eea"),$("#formPrimaryColorHex").val("#667eea"),$("#formSecondaryColor").val("#764ba2"),$("#formSecondaryColorHex").val("#764ba2"),this.updatePreview()}t("Branding colors applied")})}renderSubmissionsTable(e){const t=$("#submissionsTableContainer");if(!e||0===e.length)return void t.html('<p class="empty-state-text">No submissions yet</p>');let n='\n            <table class="submissions-table">\n                <thead>\n                    <tr>\n                        <th>Date</th>\n                        <th>Name</th>\n                        <th>Email</th>\n                        <th>Status</th>\n                        <th>Actions</th>\n                    </tr>\n                </thead>\n                <tbody>\n        ';e.forEach(e=>{const t=e.submittedData||{},a=t.get?t.get("name"):t.name||"N/A",i=t.get?t.get("email"):t.email||"N/A",s=new Date(e.submittedAt).toLocaleDateString();n+=`\n                <tr>\n                    <td>${s}</td>\n                    <td>${a}</td>\n                    <td>${i}</td>\n                    <td><span class="submission-status-badge ${e.status}">${e.status}</span></td>\n                    <td><button class="field-action-btn view-submission" data-id="${e._id}"><i class="fas fa-eye"></i></button></td>\n                </tr>\n            `}),n+="</tbody></table>",t.html(n)}showSubmissionDetails(e){var t,n;const a=e.submittedData||{};let i=`\n            <div class="submission-details">\n                <div class="submission-meta">\n                    <p><strong>Submitted:</strong> ${new Date(e.submittedAt).toLocaleString()}</p>\n                    <p><strong>Status:</strong> <span class="submission-status-badge ${e.status}">${e.status}</span></p>\n                    ${(null==(t=e.visitorInfo)?void 0:t.location)?`<p><strong>Location:</strong> ${e.visitorInfo.location.city}, ${e.visitorInfo.location.country}</p>`:""}\n                    ${(null==(n=e.visitorInfo)?void 0:n.device)?`<p><strong>Device:</strong> ${e.visitorInfo.device}</p>`:""}\n                </div>\n                <div class="submission-data">\n                    <h4>Submitted Information</h4>\n        `;for(const[s,o]of Object.entries(a))"function"!=typeof o&&(i+=`<p><strong>${s}:</strong> ${o}</p>`);i+="</div></div>",$("#submissionDetailsContent").html(i),$("#submissionDetailsModal").show()}exportSubmissions(){return __async(this,null,function*(){try{const e=yield fetch("/api/forms/submissions?status=all",{method:"GET",credentials:"include"}),t=yield e.json();if(!t.success||!t.submissions||0===t.submissions.length)return void n("No submissions to export");let a="Date,Name,Email,Phone,Status,Location\n";t.submissions.forEach(e=>{var t,n;const i=e.submittedData||{},s=[new Date(e.submittedAt).toLocaleDateString(),i.get?i.get("name"):i.name||"",i.get?i.get("email"):i.email||"",i.get?i.get("phone"):i.phone||"",e.status,(null==(n=null==(t=e.visitorInfo)?void 0:t.location)?void 0:n.city)||""];a+=s.map(e=>`"${e}"`).join(",")+"\n"});const i=new Blob([a],{type:"text/csv"}),s=window.URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=`form-submissions-${Date.now()}.csv`,o.click(),window.URL.revokeObjectURL(s)}catch(e){n("Failed to export submissions")}})}updateformid(e){e&&$(".leadform-id-div").length>0&&($(".leadform-id-div").empty(),$(".leadform-id-div").append(`<span class="leadform-page-idtitle">Lead Form ID: </span>\n                <span class="lead_formid">${e._id}</span>\n                <span class="copy-form-id" id="copy-form-id"><i class="fas fa-copy"></i></span>`))}setupCopyFormIDButton(){document.querySelectorAll('[id^="copy-form-id"]').forEach(e=>{e.replaceWith(e.cloneNode(!0))});document.querySelectorAll('[id^="copy-form-id"]').forEach(e=>{e.addEventListener("click",()=>__async(this,null,function*(){try{const n=e.closest(".leadform-id-div"),a=null==n?void 0:n.querySelector(".lead_formid");if(!a)return;const i=a.textContent.trim();yield navigator.clipboard.writeText(i);const s=e.querySelector("i"),o=s.className;s.className="fas fa-check",e.style.color="#28a745",t("Lead Form ID copied!"),setTimeout(()=>{s.className=o,e.style.color=""},1500)}catch(n){}}))})}initCustomQuestions(){this.loadQuestionsBank(),this.customQuestions||(this.customQuestions=[]),this.updateCustomQuestionsCount(),this.toggleAddQuestionButton(),this.loadExistingCustomQuestions();$("#customQuestionsSection"),$("#industrySelect"),$("#addCustomQuestionBtn")}loadQuestionsBank(){window.QUESTIONS_BANK?this.questionsBank=window.QUESTIONS_BANK:this.questionsBank={}}loadExistingCustomQuestions(){this.customQuestions&&0!==this.customQuestions.length||!this.currentConfig||!this.currentConfig.customQuestions||(this.customQuestions=[...this.currentConfig.customQuestions],this.renderCustomQuestions(),this.currentConfig.selectedIndustry&&(this.currentIndustry=this.currentConfig.selectedIndustry,$("#industrySelect").val(this.currentConfig.selectedIndustry)))}handleIndustryChange(e){if(this.currentIndustry=e,this.isDirty=!0,$(".question-suggestions").hide(),e&&this.questionsBank[e]){this.questionsBank[e].length}}addCustomQuestion(){if(this.customQuestions.length>=this.maxCustomQuestions)return void n(`Maximum ${this.maxCustomQuestions} custom questions allowed`);const e=`custom_${Date.now()}`,t={id:e,question:"",answerType:"text",options:[],isRequired:!1};this.customQuestions.push(t),this.renderCustomQuestions(),this.updateCustomQuestionsCount(),this.toggleAddQuestionButton(),setTimeout(()=>{$(`#question-input-${e}`).focus()},100)}renderCustomQuestions(){const e=$("#customQuestionsList");e.empty(),this.customQuestions.forEach((t,n)=>{const a=this.generateCustomQuestionHtml(t,n);e.append(a)}),this.updatePreview()}generateCustomQuestionHtml(e,t){const n=window.ANSWER_FIELD_TYPES||{text:{label:"Short Text",icon:"fas fa-font"},textarea:{label:"Long Text",icon:"fas fa-align-left"},radio:{label:"Multiple Choice",icon:"fas fa-dot-circle"},checkbox:{label:"Checkboxes",icon:"fas fa-check-square"},select:{label:"Dropdown",icon:"fas fa-chevron-down"}};return`\n            <div class="custom-question-item new-question" data-question-id="${e.id}">\n                <div class="question-header">\n                    <div class="question-number">${t+1}</div>\n                    <div class="question-actions">\n                        <button class="btn-question-action btn-delete-question" title="Delete Question">\n                            <i class="fas fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n\n                <div class="question-input-group">\n                    <div class="question-input-container">\n                        <textarea \n                            class="question-input" \n                            id="question-input-${e.id}"\n                            placeholder="Type your question or start typing for suggestions..."\n                            rows="2"\n                        >${e.question}</textarea>\n                        <div class="question-suggestions" id="suggestions-${e.id}" style="display: none;">\n                            \x3c!-- Suggestions will be populated here --\x3e\n                        </div>\n                    </div>\n                </div>\n\n                <div class="answer-type-group">\n                    <label class="answer-type-label">Answer Type:</label>\n                    <div class="answer-type-grid">\n                        ${Object.entries(n).map(([t,n])=>`\n                            <div class="answer-type-option ${e.answerType===t?"selected":""}" \n                                 data-type="${t}" data-question-id="${e.id}">\n                                <i class="${n.icon}"></i>\n                                <span>${n.label}</span>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n\n                ${this.generateOptionsConfig(e)}\n            </div>\n        `}generateOptionsConfig(e){if(!["radio","checkbox","select"].includes(e.answerType))return"";const t=e.options||["Option 1","Option 2"];return`\n            <div class="options-config">\n                <label class="answer-type-label">Options:</label>\n                <div class="options-list" id="options-${e.id}">\n                    ${t.map((n,a)=>`\n                        <div class="option-item">\n                            <input type="text" class="option-input" value="${n}" \n                                   data-option-index="${a}" data-question-id="${e.id}">\n                            ${t.length>2?`\n                                <button class="btn-remove-option" data-option-index="${a}" data-question-id="${e.id}">\n                                    <i class="fas fa-times"></i>\n                                </button>\n                            `:""}\n                        </div>\n                    `).join("")}\n                </div>\n                <button class="btn-add-option" data-question-id="${e.id}">\n                    <i class="fas fa-plus"></i> Add Option\n                </button>\n            </div>\n        `}handleQuestionInput(e){const t=$(e.target),n=t.attr("id").replace("question-input-",""),a=t.val(),i=this.customQuestions.find(e=>e.id===n);i&&(i.question=a,this.isDirty=!0,this.updatePreview()),a.length>=2&&this.currentIndustry?this.showQuestionSuggestions(n,a):this.hideSuggestions(n)}debugCustomQuestions(){$(".answer-type-option").first().trigger("click")}showQuestionSuggestions(e,t){const n=$(`#suggestions-${e}`),a=this.questionsBank[this.currentIndustry]||[];if(0===a.length)return void this.hideSuggestions(e);const i=a.filter(e=>e.toLowerCase().includes(t.toLowerCase()));if(0===i.length)return void this.hideSuggestions(e);const s=i.slice(0,8).map(n=>{const a=this.highlightMatch(n,t);return`<div class="suggestion-item" data-question-id="${e}" data-question="${n}">${a}</div>`}).join("");n.html(s).show()}highlightMatch(e,t){const n=new RegExp(`(${t})`,"gi");return e.replace(n,'<span class="suggestion-highlight">$1</span>')}hideSuggestions(e){$(`#suggestions-${e}`).hide()}selectSuggestion(e){const t=$(e.target).closest(".suggestion-item"),n=t.data("question-id"),a=t.data("question");$(`#question-input-${n}`).val(a);const i=this.customQuestions.find(e=>e.id===n);i&&(i.question=a),this.hideSuggestions(n)}selectAnswerType(e){const t=$(e.target).closest(".answer-type-option"),n=t.data("type"),a=t.data("question-id");t.siblings(".answer-type-option").removeClass("selected"),t.addClass("selected");const i=this.customQuestions.find(e=>e.id===a);i&&(i.answerType=n,!["radio","checkbox","select"].includes(n)||i.options&&0!==i.options.length||(i.options=["Option 1","Option 2"]),this.isDirty=!0),this.renderCustomQuestions()}addAnswerOption(e){const t=$(e.target).closest(".btn-add-option").data("question-id"),n=this.customQuestions.find(e=>e.id===t);n&&n.options&&(n.options.push(`Option ${n.options.length+1}`),this.renderCustomQuestions())}removeAnswerOption(e){const t=$(e.target).closest(".btn-remove-option"),n=t.data("question-id"),a=t.data("option-index"),i=this.customQuestions.find(e=>e.id===n);i&&i.options&&i.options.length>2&&(i.options.splice(a,1),this.renderCustomQuestions())}deleteCustomQuestion(e){const t=$(e.target).closest(".btn-delete-question").closest(".custom-question-item"),n=t.data("question-id");this.customQuestions=this.customQuestions.filter(e=>e.id!==n),t.fadeOut(300,()=>{t.remove(),this.renderCustomQuestions()}),this.updateCustomQuestionsCount(),this.toggleAddQuestionButton(),this.updatePreview()}updateCustomQuestionsCount(){$("#customQuestionsCount").text(`(${this.customQuestions.length}/${this.maxCustomQuestions})`)}toggleAddQuestionButton(){const e=$("#addCustomQuestionBtn");this.customQuestions.length>=this.maxCustomQuestions?e.prop("disabled",!0).text(`Maximum ${this.maxCustomQuestions} questions reached`):e.prop("disabled",!1).html('<i class="fas fa-plus"></i> Add Custom Question')}testCustomQuestionsEvents(){const e=$(".question-input").first(),t=$(".answer-type-option").first();$(".btn-delete-question").first();e.length&&e.val("test").trigger("input"),t.length&&t.trigger("click")}getFormConfiguration(){return{customQuestions:this.customQuestions}}},I=null;const P=document.getElementById("card-view-tabs-buttons"),L=document.getElementById("displayPage");function T(){if(document.getElementById("displayPage").classList.contains("active")){const e=L.getBoundingClientRect();P.style.left=e.left+"px",P.style.width=e.width+"px",$("#card-view-tabs-buttons").show()}}const B=function(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...a)},t)}}(function(){T()},150);document.addEventListener("DOMContentLoaded",function(){return __async(this,null,function*(){setTimeout(()=>{T()},1e3)})}),$(document).ready(function(){setTimeout(()=>{T()},500)}),$(window).on("orientationchange resize",B),window.addEventListener("scroll",T,{passive:!0}),window.addEventListener("resize",T),"scrollRestoration"in history&&(history.scrollRestoration="manual"),$(document).ready(function(){if(/Android|webOS|iPhone|iPad|iPod/i.test(navigator.userAgent)){const e=e=>{let t=0;e.addEventListener("touchend",function(e){const n=(new Date).getTime(),a=n-t;a<500&&a>0&&e.preventDefault(),t=n},{passive:!1})};document.querySelectorAll(".card-tab, .btn, button").forEach(e)}}),window.addEventListener("load",function(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)});const A=new class{constructor(){this.currentIndex=0,this.allCards=["default-card","digital-card","design-card","lead-form"],this.cards=[...this.allCards],this.initialized=!1,this.isMobileDevice=this.detectMobileDevice(),this.isTabletOrDesktop=this.detectTabletOrDesktop()}init(){this.initialized||(this.setupResponsiveTabs(),this.setupEventListeners(),this.setupOrientationDetection(),this.showCard(0),this.initialized=!0)}detectMobileDevice(){const e=navigator.userAgent||navigator.vendor||window.opera,t=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),n=/iPad/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,a=window.screen.width<=768||window.screen.height<=768;return(t||a)&&!n}detectTabletOrDesktop(){const e=window.screen.width,t=window.innerWidth,n=e>=900||t>=900;return!this.isMobileDevice&&n}setupResponsiveTabs(){this.isMobileDevice||!this.isTabletOrDesktop?(this.cards=this.allCards.filter(e=>"lead-form"!==e),this.hideLeadFormTab(),this.showMobileLeadFormMessage()):(this.cards=[...this.allCards],this.showLeadFormTab(),this.hideMobileLeadFormMessage())}hideLeadFormTab(){const e=document.querySelector('[data-card="lead-form"]');e&&(e.style.display="none",e.classList.remove("active"))}showLeadFormTab(){const e=document.querySelector('[data-card="lead-form"]');e&&(e.style.display="")}showMobileLeadFormMessage(){let e=document.getElementById("mobile-leadform-message");if(!e){e=document.createElement("div"),e.id="mobile-leadform-message",e.className="mobile-leadform-notice",e.innerHTML=`\n                <div class="mobile-notice-content">\n                    <div class="notice-icon">\n                        <i class="fas fa-tablet-alt"></i>\n                    </div>\n                    <h3>Lead Form Builder</h3>\n                    <p>The Lead Form feature is available on tablets and desktop browsers with screen width greater than 900px for optimal experience.</p>\n                    <div class="notice-details">\n                        <div class="detail-item">\n                            <i class="fas fa-desktop"></i>\n                            <span>Desktop Browsers</span>\n                        </div>\n                        <div class="detail-item">\n                            <i class="fas fa-tablet-alt"></i>\n                            <span>Tablet Devices</span>\n                        </div>\n                        <div class="detail-item">\n                            <i class="fas fa-ruler-horizontal"></i>\n                            <span>Min. Width: 900px</span>\n                        </div>\n                    </div>\n                    <div class="current-device-info">\n                        <small>Current screen: ${window.innerWidth}px √ó ${window.innerHeight}px</small>\n                    </div>\n                </div>\n            `;const t=document.querySelector(".card-view-tabs");t&&t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)}e.style.display="block"}hideMobileLeadFormMessage(){const e=document.getElementById("mobile-leadform-message");e&&(e.style.display="none")}supportsLeadForm(){return this.isTabletOrDesktop&&!this.isMobileDevice}setupEventListeners(){$(document).on("click",'[data-action="close-leadform-modal"]',e=>{e.preventDefault(),$(".lead-form-unsupported-modal").remove()}),$(document).on("click",".lead-form-unsupported-modal .modal-backdrop",e=>{$(".lead-form-unsupported-modal").remove()}),$(document).on("keydown",e=>{"Escape"===e.key&&document.querySelector(".lead-form-unsupported-modal")&&$(".lead-form-unsupported-modal").remove()});document.querySelectorAll(".card-tab").forEach((e,t)=>{e.addEventListener("click",()=>{const t=e.dataset.card;if("lead-form"===t&&!this.supportsLeadForm())return void this.showLeadFormUnsupportedMessage();const n=this.cards.indexOf(t);-1!==n&&this.showCard(n)})});const e=document.querySelector(".carousel-nav-left"),t=document.querySelector(".carousel-nav-right");e&&e.addEventListener("click",()=>{this.navigateLeft()}),t&&t.addEventListener("click",()=>{this.navigateRight()}),document.addEventListener("keydown",e=>{document.getElementById("displayPage").classList.contains("active")&&("ArrowLeft"===e.key?this.navigateLeft():"ArrowRight"===e.key&&this.navigateRight())}),this.setupTouchSwipe(),window.addEventListener("resize",this.debounce(()=>{this.handleWindowResize()},250))}handleWindowResize(){const e=this.isTabletOrDesktop;this.isTabletOrDesktop=this.detectTabletOrDesktop(),e!==this.isTabletOrDesktop&&(this.setupResponsiveTabs(),"lead-form"!==this.getCurrentCard()||this.supportsLeadForm()||this.showCard(0))}showLeadFormUnsupportedMessage(){document.querySelectorAll(".lead-form-unsupported-modal").forEach(e=>e.remove());document.body.insertAdjacentHTML("beforeend",'\n            <div class="lead-form-unsupported-modal" data-modal="leadform-unsupported">\n                <div class="modal-backdrop"></div>\n                <div class="modal-content">\n                    <div class="modal-icon">üì±‚û°Ô∏èüíª</div>\n                    <h3>Desktop/Tablet Required</h3>\n                    <p>Lead Form Builder requires a desktop browser or tablet with minimum width of 900px for optimal experience.</p>\n                    <div class="modal-actions">\n                        <button class="btn-primary close-modal" data-action="close-leadform-modal">\n                            Got it\n                        </button>\n                    </div>\n                </div>\n            </div>\n        ')}setupTouchSwipe(){const e=document.querySelector(".card-carousel-wrapper");if(!e)return;let t=0,n=0,a=null;e.addEventListener("touchstart",e=>{t=e.changedTouches[0].screenX,a=e.target},{passive:!0}),e.addEventListener("touchend",e=>{n=e.changedTouches[0].screenX;a&&[".slider-area",'input[type="range"]',".qr-opacity-slider","#sizeSlider"].some(e=>a.closest(e)||a.matches(e))||this.handleSwipe(t,n)},{passive:!0})}handleSwipe(e,t){const n=e-t;Math.abs(n)>50&&(n>0?this.navigateRight():this.navigateLeft())}showCard(e){if(e<0||e>=this.cards.length)return;this.currentIndex=e;const t=this.cards[e];document.querySelectorAll(".card-tab").forEach(e=>{const n=e.dataset.card;n===t&&this.cards.includes(n)?e.classList.add("active"):e.classList.remove("active")});if(document.querySelectorAll(".carousel-card").forEach(e=>{e.id.replace("-view","")===t?e.classList.add("active"):e.classList.remove("active")}),"online-profile"===t&&this.checkOrientation(),"lead-form"===t&&this.supportsLeadForm())try{I||(I=new q,I.applyBrandingColorsFromDataSilent,window.debugFormBuilder=()=>{I&&I.debugCustomQuestions&&I.debugCustomQuestions()}),I.init()}catch(n){}this.updateNavigationButtons()}navigateLeft(){this.currentIndex>0?this.showCard(this.currentIndex-1):this.showCard(this.cards.length-1)}navigateRight(){this.currentIndex<this.cards.length-1?this.showCard(this.currentIndex+1):this.showCard(0)}updateNavigationButtons(){const e=document.querySelector(".carousel-nav-left"),t=document.querySelector(".carousel-nav-right");e&&(e.style.opacity="1"),t&&(t.style.opacity="1")}goToCard(e){if(!this.cards.includes(e))return"lead-form"===e&&this.showLeadFormUnsupportedMessage(),!1;const t=this.cards.indexOf(e);return-1!==t&&(this.showCard(t),!0)}getCurrentCard(){return this.cards[this.currentIndex]}getDeviceInfo(){return{isMobile:this.isMobileDevice,isTabletOrDesktop:this.isTabletOrDesktop,supportsLeadForm:this.supportsLeadForm(),screenSize:`${window.screen.width}x${window.screen.height}`,windowSize:`${window.innerWidth}x${window.innerHeight}`,userAgent:navigator.userAgent,availableCards:this.cards,currentCard:this.getCurrentCard()}}setupOrientationDetection(){this.checkOrientation(),window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.checkOrientation()},100)}),window.addEventListener("resize",()=>{this.checkOrientation()})}checkOrientation(){if(!(Math.min(window.innerWidth,window.innerHeight)<=768))return void this.hideOrientationWarning();const e=document.getElementById("online-profile-view");if(!e||!e.classList.contains("active"))return;window.innerWidth>window.innerHeight?this.showOrientationWarning():this.hideOrientationWarning()}showOrientationWarning(){const e=document.getElementById("landscapeWarning"),t=document.getElementById("user-facing-dc-card"),n=document.querySelector("#online-profile-view .carousel-card-title");e&&(e.style.display="flex"),t&&(t.style.display="none"),n&&(n.style.display="none")}hideOrientationWarning(){const e=document.getElementById("landscapeWarning"),t=document.getElementById("user-facing-dc-card"),n=document.querySelector("#online-profile-view .carousel-card-title");e&&(e.style.display="none"),t&&(t.style.display=""),n&&(n.style.display="")}debounce(e,t){let n;return function(...a){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...a)},t)}}};function _(){return __async(this,null,function*(){var e,t,a;try{const n=yield g.getUserWithProfile();if(n.success&&n.profile){const i=n.profile;ue(i),document.getElementById("email").value=n.profile.email,void 0!==i.showPhoneNumber&&(document.getElementById("showPhoneNumber").checked=i.showPhoneNumber);const s=document.getElementById("profileForm");if(s){s.querySelectorAll("input, textarea").forEach(e=>{const t=e.name;"country"!==t&&"state"!==t&&"city"!==t&&(t&&void 0!==i[t]?e.value=i[t]:t&&i.socialMedia&&void 0!==i.socialMedia[t]&&(e.value=i.socialMedia[t]))})}if((null==(e=i.country)?void 0:e.name)&&(document.getElementById("country").value=i.country.name,document.getElementById("countryCode").value=i.country.code||"",window.locationAutocomplete)){const e=window.locationAutocomplete.countries.find(e=>e.code===i.country.code);e&&window.locationAutocomplete.selectCountry(e)}if((null==(t=i.state)?void 0:t.name)&&setTimeout(()=>{if(document.getElementById("state").value=i.state.name,document.getElementById("stateId").value=i.state.id||"",document.getElementById("stateCode").value=i.state.code||"",window.locationAutocomplete&&window.locationAutocomplete.selectedCountry){const e=window.locationAutocomplete.currentStates.find(e=>e.id===i.state.id);e&&window.locationAutocomplete.selectState(e)}},500),(null==(a=i.city)?void 0:a.name)&&setTimeout(()=>{document.getElementById("city").value=i.city.name,document.getElementById("cityId").value=i.city.id||""},1e3),i.uploadedQR&&i.uploadedQR.url){const e=document.getElementById("qrPreview"),t=document.getElementById("qrUploadText");e&&t&&(e.src=g.baseURL+i.uploadedQR.url,e.classList.remove("hidden"),t.innerHTML="QR Code uploaded <br><small>Click to change</small>")}!function(e){__async(this,null,function*(){const t=$("#avatarDisplay"),n=$("#avatarInitials"),a=$("#profilePhotoImg"),i=$("#deletePhotoBtn");if(window.location.origin,e.cardId,e.hasProfilePhoto){t.hide(),a.hide();const s=yield function(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/profile/photo/c/${e}`,{headers:{Authorization:"Bearer "+localStorage.getItem("authToken")},cache:"no-store"});if(!t.ok)throw new Error("Failed to fetch photo");const n=yield t.blob();return new Promise((e,t)=>{const a=new FileReader;a.onloadend=()=>e(a.result),a.onerror=t,a.readAsDataURL(n)})}catch(t){return null}})}(e.cardId);if(s){const e=a.parent(),t=a.attr("class")||"",n=a.attr("id");a.remove();const o=$(`<img id="${n}" class="${t}" alt="Profile Photo">`);o.attr("src",s),e.append(o),o.show(),i.show()}else n.text(e.initials),t.show(),i.hide()}else n.text(e.initials),t.show(),a.hide(),i.hide()})}(i)}else if(n.success&&!n.profile){ue(null);const e=yield g.getCurrentUser();1==e.success&&(document.getElementById("email").value=e.user.email)}else Re("login")}catch(i){i.message.includes("retrieving profile")?n("Unable to load your profile. Please try refreshing the page."):n("Profile loading error: "+i.message)}})}function D(){const e=document.getElementById("profilePage"),t=document.querySelector(".profile-header-edit-div");if(!e||!t)return;let n;e.addEventListener("scroll",()=>{clearTimeout(n),n=setTimeout(()=>{e.scrollTop>50?t.classList.add("scrolled"):t.classList.remove("scrolled")},10)}),window.addEventListener("scroll",()=>{if(document.getElementById("profilePage").classList.contains("active")){(window.pageYOffset||document.documentElement.scrollTop)>50?t.classList.add("scrolled"):t.classList.remove("scrolled")}})}window.cardCarousel=A,window.cardCarouselInfo=()=>A.getDeviceInfo(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",D):D();(new Date).getTime();function R(){return __async(this,null,function*(){const e=yield k.show("<p>Are you sure you want to remove your profile photo?.</p>",{type:"warning",title:"Delete Profile Photo",closable:!0,closeOnOverlay:!1,buttons:[{text:"Cancel",style:"secondary",value:!1},{text:"Delete",style:"primary",value:!0,icon:"fas fa-trash"}]});if(!1===e);else if(!0===e)try{(yield $.ajax({url:"/api/profile/delete-profile-photo",method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("token")}})).success&&(t("Profile photo removed successfully!"),$("#profilePhotoImg").hide(),$("#avatarDisplay").show(),$("#deletePhotoBtn").hide(),$("#profilePhotoInput").val(""),Re("display"),Me("display"),Ue("display"))}catch(a){n("Error removing photo")}})}function O(){$("#uploadPhotoBtn").on("click",function(){$("#profilePhotoInput").click()}),$("#profilePhotoInput").on("change",function(e){return __async(this,null,function*(){const a=e.target.files[0];if(!a)return;if(a.size>c)return n("File size must be less than 5MB"),void $(this).val("");const i=a.name.toLowerCase(),s=i.endsWith(".heic")||i.endsWith(".heif");if(!a.type.startsWith("image/")&&!s)return n("Please select an image file (JPG, PNG, GIF, HEIC)"),void $(this).val("");if(s)$("#avatarDisplay").show(),$("#profilePhotoImg").hide();else{const e=new FileReader;e.onload=function(e){$("#profilePhotoImg").attr("src",e.target.result).show(),$("#avatarDisplay").hide()},e.readAsDataURL(a)}yield function(e){return __async(this,null,function*(){var a;const i=new FormData;i.append("profilePhoto",e);const s=e.name.toLowerCase().endsWith(".heic")||e.name.toLowerCase().endsWith(".heif"),o=$("#uploadPhotoBtn"),r=o.html();o.prop("disabled",!0).text(s?"Converting & Uploading...":"Uploading...");try{(yield $.ajax({url:"/api/profile/upload-profile-photo",method:"POST",data:i,processData:!1,contentType:!1,headers:{Authorization:"Bearer "+localStorage.getItem("token")}})).success&&(t("Profile photo uploaded successfully!"),$("#deletePhotoBtn").show(),o.prop("disabled",!1).html(r),Re("display"),Me("display"),Ue("display"))}catch(l){n((null==(a=l.responseJSON)?void 0:a.message)||"Error uploading photo"),$("#profilePhotoImg").hide(),$("#avatarDisplay").show(),$("#profilePhotoInput").val(""),o.prop("disabled",!1).html(r)}})}(a)})}),$("#deletePhotoBtn").on("click",R)}const M={"purple-blue":{start:"#667eea",end:"#764ba2",name:"Purple Blue"},ocean:{start:"#2E3192",end:"#1BFFFF",name:"Ocean"},sunset:{start:"#ff6b6b",end:"#feca57",name:"Sunset"},forest:{start:"#134E5E",end:"#71B280",name:"Forest"},royal:{start:"#141E30",end:"#243B55",name:"Royal"},rose:{start:"#f857a6",end:"#ff5858",name:"Rose"},mint:{start:"#00b09b",end:"#96c93d",name:"Mint"},lavender:{start:"#8E2DE2",end:"#4A00E0",name:"Lavender"},peach:{start:"#ED4264",end:"#FFEDBC",name:"Peach"},cosmic:{start:"#C33764",end:"#1D2671",name:"Cosmic"},emerald:{start:"#11998e",end:"#38ef7d",name:"Emerald"},fire:{start:"#f12711",end:"#f5af19",name:"Fire"},blush:{start:"#eb3349",end:"#f45c43",name:"Blush"},midnight:{start:"#2c3e50",end:"#3498db",name:"Midnight"},aqua:{start:"#00d2ff",end:"#3a7bd5",name:"Aqua"}};let U={start:"#667eea",end:"#764ba2"},N=!1;function F(){return __async(this,null,function*(){N||(yield function(){return __async(this,null,function*(){try{const e=yield g.getBranding();if(e.success&&e.data){U.start=(e.data.gradientStart||"#667eea").toLowerCase(),U.end=(e.data.gradientEnd||"#764ba2").toLowerCase();let t=!1;for(const[e,n]of Object.entries(M))if(n.start.toLowerCase()===U.start.toLowerCase()&&n.end.toLowerCase()===U.end.toLowerCase()){$(".gradient-preset").removeClass("active"),$(`.gradient-preset[data-gradient="${e}"]`).addClass("active"),$("#use-custom-colors").prop("checked",!1),$("#color-pickers-section").hide(),t=!0;break}t||($("#use-custom-colors").prop("checked",!0),$("#color-pickers-section").show(),$(".gradient-preset").removeClass("active")),z(U.start,U.end),j(U.start,U.end)}}catch(e){j(U.start,U.end)}})}(),$(document).off("click",".gradient-preset").on("click",".gradient-preset",function(){const e=$(this).data("gradient");if(!e||!M[e])return;$(".gradient-preset").removeClass("active"),$(this).addClass("active");const t=M[e];U={start:t.start,end:t.end},z(t.start,t.end),j(t.start,t.end),$("#use-custom-colors").prop("checked",!1),$("#color-pickers-section").hide()}),$(document).off("change","#use-custom-colors").on("change","#use-custom-colors",function(){$(this).is(":checked")?($("#color-pickers-section").slideDown(300),$(".gradient-preset").removeClass("active")):($("#color-pickers-section").slideUp(300),j(U.start,U.end))}),$(document).off("input","#card-color-start").on("input","#card-color-start",function(){const e=$(this).val();$("#card-color-start-text").val(e.toUpperCase())}),$(document).off("input","#card-color-end").on("input","#card-color-end",function(){const e=$(this).val();$("#card-color-end-text").val(e.toUpperCase())}),$(document).off("input","#card-color-start-text").on("input","#card-color-start-text",function(){let e=$(this).val();e.startsWith("#")||(e="#"+e),H(e)&&$("#card-color-start").val(e)}),$(document).off("input","#card-color-end-text").on("input","#card-color-end-text",function(){let e=$(this).val();e.startsWith("#")||(e="#"+e),H(e)&&$("#card-color-end").val(e)}),$(document).off("click","#apply-custom-colors").on("click","#apply-custom-colors",function(){const e=$("#card-color-start").val(),t=$("#card-color-end").val();U={start:e,end:t},j(e,t);const n=$(this),a=n.html();n.html('<i class="fas fa-check"></i> Applied!'),setTimeout(()=>{n.html(a)},2e3)}),$(document).off("click","#save-branding-btn").on("click","#save-branding-btn",function(){return __async(this,null,function*(){const e=$(this),t=e.html();e.prop("disabled",!0),e.html('<i class="fas fa-spinner fa-spin"></i> Saving...');try{yield Q(U),e.html('<i class="fas fa-check"></i> Saved!'),setTimeout(()=>{e.html(t),e.prop("disabled",!1)},2e3)}catch(n){e.html('<i class="fas fa-times"></i> Failed'),setTimeout(()=>{e.html(t),e.prop("disabled",!1)},2e3)}})}),N=!0)})}function Q(e){return __async(this,null,function*(){try{const t={gradientStart:e.start,gradientEnd:e.end},a=yield g.saveBranding(null,t);yield g.saveBrandingforForm(null,t);a.success?k.success("Branding preferences saved successfully"):n("Failed to save branding preferences: "+(a.message||"Unknown error"))}catch(t){n("Error saving preferences")}})}function z(e,t){$("#card-color-start").val(e),$("#card-color-start-text").val(e.toUpperCase()),$("#card-color-end").val(t),$("#card-color-end-text").val(t.toUpperCase())}function j(e,t){const n=`linear-gradient(135deg, ${e} 0%, ${t} 100%)`,a=()=>{const e=$(".wallet-card-header-section"),t=$(".userprofile-dynamic-html").find(".profile-header"),a=$(".userprofile-dynamic-html").find(".contact-icon"),i=$(".userprofile-dynamic-html").find("a.card-icon-design");e.length>0&&e.css("background",n),t.length>0&&t.css("background",n),a.length>0&&a.css("background",n),i.length>0&&i.css("background",n)};a(),setTimeout(a,100),setTimeout(a,500)}function H(e){return/^#[0-9A-F]{6}$/i.test(e)}function W(){let e="";for(const[t,n]of Object.entries(M)){const a=`background: linear-gradient(135deg, ${n.start} 0%, ${n.end} 100%);`;e+=`\n            <div class="gradient-preset ${U.start.toLowerCase()===n.start.toLowerCase()&&U.end.toLowerCase()===n.end.toLowerCase()?"active":""}" \n                 data-gradient="${t}"\n                 style="${a}"\n                 title="${n.name}">\n            </div>\n        `}return`\n        <div class="digital-card-customization">\n            <div class="customization-section">\n                <h3 class="customization-title">\n                    <i class="fas fa-palette"></i>\n                    Card Branding Colors\n                </h3>\n                \n                \x3c!-- Gradient Presets --\x3e\n                <div class="gradient-presets">\n                    <label class="preset-label">Choose a color scheme:</label>\n                    <div class="gradient-options">\n                        ${e}\n                    </div>\n                </div>\n               \n               \n                \x3c!-- Custom Colors Section --\x3e\n                <div class="custom-color-section">\n                    <label class="custom-color-label">\n                        <input type="checkbox" id="use-custom-colors" class="custom-color-checkbox">\n                        <span>Use custom colors</span>\n                    </label>\n                    \n                    <div id="color-pickers-section" class="color-pickers" style="display: none;">\n                        <div class="color-picker-group">\n                            <span class="brand-label-color">Start Color</span>\n                            <div class="color-input-wrapper">\n                                <input type="color" id="card-color-start" class="card-color-input" value="${U.start}">\n                                <input type="text" id="card-color-start-text" class="color-text-input" value="${U.start.toUpperCase()}" placeholder="#667EEA">\n                            </div>\n                        </div>\n                        \n                        <div class="color-picker-group">\n                            <span class="brand-label-color">End Color</span>\n                            <div class="color-input-wrapper">\n                                <input type="color" id="card-color-end" class="card-color-input" value="${U.end}">\n                                <input type="text" id="card-color-end-text" class="color-text-input" value="${U.end.toUpperCase()}" placeholder="#764BA2">\n                            </div>\n                        </div>\n                        \n                        <button id="apply-custom-colors" class="btn-apply-colors">\n                            <i class="fas fa-check"></i>\n                            Apply Custom Colors\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class="save-branding-btn-div">\n                <button class="profile-card-buttons" id="save-branding-btn">\n                    <i class="fa-regular fa-save"></i>\n                    Save Branding\n                </button>\n            </div>\n        </div>\n    `}const V={init:F,getCurrentGradient:function(){return U},resetToDefault:function(){return __async(this,null,function*(){try{U={start:"#667eea",end:"#764ba2"},z(U.start,U.end),j(U.start,U.end),$(".gradient-preset").removeClass("active"),$('.gradient-preset[data-gradient="purple-blue"]').addClass("active"),$("#use-custom-colors").prop("checked",!1),$("#color-pickers-section").hide();const e=yield g.resetBranding();e.success?k.success("Branding reset successfully"):n("Failed to reset branding: "+(e.message||"Unknown error"))}catch(e){n("Error resetting branding")}})},applyGradientToCard:j,applyToLoadedCard:function(){j(U.start,U.end)},generateBrandingUI:W,insertBrandingUI:function(e){return __async(this,null,function*(){const t=$(e);if(0===t.length)return!1;const n=W();return t.html(n),N||(yield F()),!0})},savePreferences:Q};let J={data:null,identifier:null,timestamp:0,cacheDuration:5e3};function G(e){return __async(this,null,function*(){const t=Date.now();if(J.identifier===e&&J.data&&J.data.success&&t-J.timestamp<J.cacheDuration)return J.data;try{let n=yield g.getCustomCardData(e);const a=yield n;if(a.success&&a.qrCodes&&a.qrCodes.length>0){const n=a.qrCodes.map(e=>{if(e.data&&e.data.data&&Array.isArray(e.data.data)){const t=new Uint8Array(e.data.data),n=new Blob([t],{type:e.data.contentType||"image/png"}),a=URL.createObjectURL(n);e.imageUrl=a}if(e.settings&&e.settings.avatarFile&&e.settings.avatarFile.data){const t=new Uint8Array(e.settings.avatarFile.data),n=new Blob([t],{type:e.settings.avatarFile.contentType||"image/png"}),a=URL.createObjectURL(n);e.settings.avatarUrl=a}return e}),i={data:__spreadProps(__spreadValues({},a),{qrCodes:n}),success:!0};return J={data:i,identifier:e,timestamp:t,cacheDuration:5e3},i}return k.info("Create your own custom QR code in Personalized QR section. Choose your own branding with colors and logo.","Try New Feature !!"),{data:a,success:!1}}catch(a){return n("Failed to load the card."),k.show("Failed to load the card."+a.message),{data:a.message,success:!1}}})}function K(e,t,n,a,i,s){let o="copyUrlIcon",r="cardUrlTextarea",l=n.trim().replace(/\s+/g,"-");n&&(o="copyUrlIcon-"+l,r="cardUrlTextarea-"+l);let c=`<div class="profile-qrcode-div">\n                <div class="profile-qrcode-image-div" data-qrcodeid="${a}">\n                    <img src="${e}" alt="QR Code" data-qrcodeid="${a}" class="qr-preview" style="border-radius: 10px;">\n                    \n                </div>\n                <div class="Download-qrcode-buttons">\n                    \n                    \n                    \n                    \x3c!-- URL Copy Section --\x3e\n                   \n                    ${`<div class="qr-action-buttons" style="display: flex; gap: 10px;">\n\n  \n        <button class="profile-card-buttons control-btn edit-qr-btn" data-qrcodeid="${a}" data-user-slug=${i} style="flex: 1;">\n            <i class="fas fa-edit"></i>\n          \n        </button>\n        <button class="profile-card-buttons  control-btn download-qr-btn download-custom-qr-code" id="" data-qrcodeid="${a}" data-user-slug=${i} style="flex: 1;">\n        <i class="fa-solid fa-download"></i>\n          \n        </button>\n        <button class="profile-card-buttons  control-btn delete-qr-btn" data-qrcodeid="${a}" data-user-slug=${i} style="flex: 1; ">\n            <i class="fas fa-trash-alt"></i>\n           \n        </button>\n        <div class="slider-wrapper">\n          \n\n            \x3c!-- Overlay --\x3e\n            <div  class="overlay hidden"></div>\n\n            \x3c!-- Popup Modal --\x3e\n            <div  class="popup hidden">\n                <h3 class="popup-title">Choose Image Size for download.</h3>\n                <h5 class="popup-sub-title">( Default size is 300Px )</h5>\n                <div class="slider-area">\n                    <input type="input" class="sizeSlider qrsize-input" max="2400" step="100" value="50">\n                    <span class="sliderValue">= px</span>\n                </div>\n                <div class="download-model-all-buttons">\n                    <button  class="model-btn-style ok-btn">OK</button>\n                    <button  class="model-btn-style download-btn-from-model" data-qrcodeid="${a}" data-user-slug=${i}>\n                    <i class="fa-solid fa-download"></i></i><span>Download</span>\n                    </button>\n                </div>\n                \n            </div>\n        </div>\n\n    </div>\n\n    <div class="qrcode-info-div">\n        <div>\n            <div><span class="bold-label">Title:</span> ${n}</div>\n        </div>\n        <div>\n            <div><span class="bold-label">Description:</span> ${s} </div>\n        </div>\n         <div>\n            <div><span class="bold-label">QRCodeID:</span> ${a} </div>\n        </div>\n    </div>`}\n                </div>`;return n||(c=`<div class="profile-qrcode-div">\n                <div class="profile-qrcode-image-div">\n                    <img src="${e}" alt="QR Code" class="qr-preview" style="border-radius: 10px;">\n                    \n                </div>\n                <div class="Download-qrcode-buttons">\n                    \n                    \n                    <button class="profile-card-buttons" id="downloadonlyQRCode-btn-dynamic" data-user-slug=${i}>\n                        <i class="fas fa-qrcode"></i>\n                        Download This QR Code\n                    </button>\n                    \x3c!-- URL Copy Section --\x3e\n                    ${` <div class="url-copy-section">\n            <div class="url-input-wrapper">\n                <textarea class="url-textarea" id="${r}" readonly>${t}</textarea>\n                <button class="copy-icon-btn" id="${o}" data-user-slug=${i} title="Copy URL">\n                    <i class="fas fa-copy"></i>\n                </button>\n            </div>\n        </div>\n       `}\n                   \n                </div>`),c}let Z=!1,Y=0;function X(){return __async(this,null,function*(){if(Z)return;const e=Date.now();if(e-Y<500)return;Z=!0,Y=e;const a=me();if(a)try{let e=function(e){e.find(".popup").addClass("hidden"),e.find(".overlay").addClass("hidden")};if(A.init(),yield function(e){return __async(this,null,function*(){const t=document.querySelector(".userprofile-dynamic-html");t.innerHTML="Loading...";try{let n=yield g.getCardhtmlData(e);const a=yield n;window.location.origin,$("#save-contact-div").empty(),a.success?t.innerHTML=a.html:t.innerHTML="Error: "+a.message}catch(n){t.innerHTML="Failed to load card"}})}(a.slug),a.cardId){const e=a.slug||a.cardId,n=`${window.location.origin}/card/${e}`,i=yield g.getQRCode(e);a.email,a.hasProfilePhoto?(a.cardId,a.initials):a.initials;let s=K(i,n,"","",a.slug);$("#defaultQR").empty(),$("#defaultQR").append(s);const o=(yield G(e)).data;if(o.success&&o.qrCodes&&o.qrCodes.length>0){let e=o.qrCodes.length,t=o.qrCodes;$("#generatedQR").empty();for(let n=0;n<e;n++){let e=K(t[n].imageUrl,t[n].url,t[n].name,t[n].id,a.slug,t[n].description);$("#generatedQR").append(e)}}yield function(e){return __async(this,null,function*(){try{const t=yield fetch(`${g.baseURL}/api/card/${e}/wallet-card-data`),n=yield t.json();if(!n.success||!n.data)throw new Error("Failed to fetch card data");{const e=function(e){g.baseURL,e.qrUrl;const t=`${g.baseURL}${e.cardUrl}`;e.cardId&&(g.baseURL,e.cardId);let n="";if(e.hasProfilePhoto){n=`<div class="wallet-card-avatar-overlap"><img src="${`${g.baseURL}/api/profile/photo/c/${e.cardId}`}" \n                           alt="${te(e.name)}" \n                           crossorigin="anonymous"\n                           onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${e.initials}</span>';"></div>`}else n=` <div class="wallet-card-avatar-download"><span>${e.initials}</span></div>`;let a=te(e.name);te(e.organization)&&(a=te(e.organization));return`<div class="digital-wallet-card" id="canvas-digital-wallet-card" data-card-id="${e.cardId}">\n      \n            \n    \x3c!-- Colored Header Section --\x3e\n    <div class="wallet-card-header-section">\n        <div class="wallet-card-brand-name">${a}</div>\n       \n            ${n}\n       \n        \x3c!-- Overlapping Profile Photo --\x3e\n        \n    </div>\n    \n    \x3c!-- Content Section --\x3e\n    <div class="wallet-card-content">\n        <div class="empty-div"><div class="wallet-qr-top-container">\n            <img src="/card/${te(e.slug)}/qr" alt="QR Code for ${te(e.name)}">\n        </div></div>\n        <div class="actual-content">\n        <div class="wallet-card-name">${te(e.name)}</div>\n        \n        <div class="wallet-card-email"><a href="mailto:${te(e.email)}" class="wallet-display-email" title="Email">${te(e.email)}</a></div>\n  \n        </div>\n    </div>\n    \n    <div class="digital-card-action-btn-style">\n        <div class="logo">\n            <img src="./image/connectiko-logo-transparent.png" alt="ConnectiKo Logo" class="card-logo-image-only">\n        </div>\n        <span>PoweredBy:${window.location.href} </span>\n    </div>\n </div><div class="dc-div-buttons">\n <button class="profile-card-buttons" id="downloadQRCode-btn-dynamic">\n                            <i class="fa-regular fa-address-card"></i>\n                            Download Digital Card\n                        </button>\n                        <button data-personal-card-url="${t}" class="profile-card-buttons copy-url-btn">\n                            <i class="fa-regular fa-copy"></i> Copy Digital Card URL\n                        </button>\n </div>`}(n.data);$("#dc-digital-wallet-card-div"),document.getElementById("dc-digital-wallet-card-div").innerHTML=e,$(".userprofile-dynamic-html").find(".card-navbar-parent").css("display","none");V.insertBrandingUI("#card-branding-container")&&(n.data.colorBranding?setTimeout(()=>{V.applyGradientToCard(n.data.colorBranding.gradientStart,n.data.colorBranding.gradientEnd)},100):setTimeout(()=>{V.applyToLoadedCard()},100))}}catch(t){document.getElementById("dc-digital-wallet-card").innerHTML='\n            <div style="text-align: center; padding: 2rem; color: #6c757d;">\n                <i class="fas fa-exclamation-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i>\n                <p>Failed to load digital wallet card</p>\n            </div>\n        '}})}(a.cardId),function(){document.querySelectorAll('[id^="copyUrlIcon"]').forEach(e=>{e.replaceWith(e.cloneNode(!0))});document.querySelectorAll('[id^="copyUrlIcon"]').forEach(e=>{e.addEventListener("click",()=>__async(this,null,function*(){try{const n=e.closest(".url-input-wrapper").querySelector(".url-textarea");if(!n)return;yield navigator.clipboard.writeText(n.value);const a=e.querySelector("i"),i=a.className;a.className="fas fa-check",e.style.background="#28a745",e.style.color="white",t("URL copied to clipboard!"),setTimeout(()=>{a.className=i,e.style.background="",e.style.color=""},2e3)}catch(n){}}))})}()}$("#navbarAvatar").show(),$("#navbarAvatarDesktop").show(),$(".card-actions").appendTo("#Download-qrcode-buttons"),$(document).on("click",".download-qr-btn",function(){const e=$(this).parent().find(".slider-wrapper");e.find(".popup").removeClass("hidden"),e.find(".overlay").removeClass("hidden")}),$(document).on("click",".ok-btn",function(){const t=$(this).closest(".slider-wrapper");e(t)}),$(document).on("click",".overlay",function(){const t=$(this).closest(".slider-wrapper");e(t)}),$(document).on("input",".sizeSlider",function(){var e=$(this).val().replace(/\D/g,""),t=Number(e);t>2400&&(t=2400),t<0&&""!==e&&(t=0),$(this).val(t||""),$(this).siblings(".sliderValue").text(t+"px")});let n=0;$(document).on("click",".download-btn-from-model",function(){return __async(this,null,function*(){const e=Date.now(),t=e-n;if(t<5e3){const e=Math.ceil((5e3-t)/1e3);return void k.error(`Please wait ${e} more seconds before downloading again.`)}n=e;let a=$(this).parents(".popup").find("input.sizeSlider").val(),i=$(this).attr("data-qrcodeid");const s=yield g.downloadCustomQRCode(i,a),o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=`qr_${i}_${a}px.png`,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(o),$(".ok-btn").trigger("click"),k.success("QRCode Downloaded Successfully")})})}catch(i){J={data:null,identifier:null,timestamp:0,cacheDuration:5e3},n("Failed to load display page. Please refresh and try again.")}finally{Z=!1}})}function ee(){return __async(this,null,function*(){try{const e=me();e&&e.cardId&&(yield g.downloadVCard(e.cardId),t("vCard download started!"))}catch(e){n("Failed to download vCard")}})}function te(e){if(!e)return"";const t=document.createElement("div");return t.textContent=e,t.innerHTML}function ne(){return __async(this,null,function*(){try{const e=me(),t=yield g.getQRCode(e.slug),n=yield fetch(t),a=yield n.blob(),i=window.URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=`qr-${e.slug}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(i)}catch(e){n("Failed to download styled QR card")}})}class ae{constructor(e="/api/wallet/screenshot"){this.apiUrl=e}captureElement(e){return __async(this,arguments,function*(e,t={}){try{const n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error("Element not found");const a=this.extractOptimizedStyles(n),i=n.outerHTML,s=n.getBoundingClientRect(),o={html:i,css:a,selector:t.selector||null,width:t.width||Math.ceil(s.width)||1920,height:t.height||Math.ceil(s.height)||1080,fullPage:void 0!==t.fullPage&&t.fullPage},r=yield fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),l=yield r.json();if(!l.success)throw new Error(l.error||"Screenshot failed");return l.image}catch(n){throw n}})}captureFromUrl(){return __async(this,arguments,function*(e={}){try{const t={url:e.url||window.location.href,selector:e.selector||null,width:e.width||1920,height:e.height||1080,fullPage:void 0===e.fullPage||e.fullPage},n=yield fetch("/api/wallet/screenshot-url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=yield n.json();if(!a.success)throw new Error(a.error||"Screenshot failed");return a.image}catch(t){throw t}})}downloadImage(e,t="screenshot.png"){const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}extractOptimizedStyles(e){const t=[];return[e,...e.querySelectorAll("*")].forEach(e=>{const n=window.getComputedStyle(e),a=[];if(["background","background-color","background-image","background-size","background-position","background-repeat","color","font-family","font-size","font-weight","font-style","padding","padding-top","padding-right","padding-bottom","padding-left","margin","margin-top","margin-right","margin-bottom","margin-left","border","border-radius","border-width","border-style","border-color","width","height","max-width","max-height","min-width","min-height","display","position","top","right","bottom","left","flex","flex-direction","justify-content","align-items","grid","grid-template-columns","grid-template-rows","gap","text-align","text-decoration","text-transform","opacity","transform","box-shadow","text-shadow","line-height","letter-spacing","white-space"].forEach(e=>{const t=n.getPropertyValue(e);t&&"none"!==t&&"normal"!==t&&"0px"!==t&&a.push(`${e}: ${t}`)}),a.length>0){const n=e.className?`.${e.className.split(" ")[0]}`:e.tagName.toLowerCase(),i=(e.id?`#${e.id}`:"")||n;t.push(`${i} { ${a.join("; ")} }`)}}),t.join("\n")}extractInlineStylesOnly(e){const t=[];return e.style.cssText&&t.push(`${e.tagName.toLowerCase()} { ${e.style.cssText} }`),e.querySelectorAll("[style]").forEach(e=>{if(e.style.cssText){const n=e.className||e.tagName.toLowerCase();t.push(`.${n} { ${e.style.cssText} }`)}}),t.join("\n")}captureElementOptimized(e){return __async(this,arguments,function*(e,t={}){try{const n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error("Element not found");const a=n.cloneNode(!0);this.applyComputedStyles(n,a);const i=a.outerHTML,s=n.getBoundingClientRect(),o={html:i,css:"",selector:null,width:t.width||Math.ceil(s.width)||1920,height:t.height||Math.ceil(s.height)||1080,fullPage:!1},r=yield fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),l=yield r.json();if(!l.success)throw new Error(l.error||"Screenshot failed");return l.image}catch(n){throw n}})}applyComputedStyles(e,t){const n=window.getComputedStyle(e);let a="";["background","color","font-family","font-size","font-weight","padding","margin","border","border-radius","width","height","display","position","text-align","line-height"].forEach(e=>{a+=`${e}: ${n.getPropertyValue(e)};`}),t.style.cssText=a;const i=e.children,s=t.children;for(let o=0;o<i.length;o++)this.applyComputedStyles(i[o],s[o])}captureAndDownload(e){return __async(this,arguments,function*(e,t="screenshot.png",n={}){try{const a=!1!==n.optimized?yield this.captureElementOptimized(e,n):yield this.captureElement(e,n);return this.downloadImage(a,t),a}catch(a){throw a}})}}function ie(){return __async(this,null,function*(){try{const e=document.querySelector("#canvas-digital-wallet-card");if(!e)return void k.show("Wallet card not found");const t=yield html2canvas(e,{backgroundColor:"#ffffff",scale:2,useCORS:!0}),n=document.createElement("a");n.href=t.toDataURL("image/png"),n.download="wallet-card.png",n.click(),k.show("screenshot downloaded!")}catch(e){k.show("Error: "+e.message)}})}"undefined"!=typeof module&&module.exports&&(module.exports=ae);const se=Object.freeze(Object.defineProperty({__proto__:null,downloadQRCode:ie,downloadStyledQRCard:ne,downloadVCard:ee,loadCustomCards:G,trackContactClick:function(e){return __async(this,null,function*(){const t=me();t&&t.cardId&&(yield g.trackContactClick(t.cardId,e))})},trackSocialClick:function(e){return __async(this,null,function*(){const t=me();t&&t.cardId&&(yield g.trackSocialClick(t.cardId,e))})},updateDisplayPage:X},Symbol.toStringTag,{value:"Module"})),oe=function(){const e={QRBlob:""},a={name:"",url:"",description:"",dotsStyle:"rounded",cornerSquareStyle:"extra-rounded",cornerDotStyle:"dot",colorPrimary:"#000000",colorSecondary:"#ffffff",colorPrimaryOpacity:100,colorSecondaryOpacity:100,logoType:"none",socialIcon:null,avatarFile:null,avatarDataUrl:null,currentQRDataUrl:null,isGenerating:!1,currentStep:1,colorPrimaryDot:"#000000",colorPrimaryCornerSquare:"#000000"};let i=null,s={};const o=[{value:"rounded",label:"Rounded",icon:'<div class="dot-preview rounded-dots"><span></span><span></span><span></span></div>'},{value:"dots",label:"Dots",icon:'<div class="dot-preview circle-dots"><span></span><span></span><span></span></div>'},{value:"classy",label:"Classy",icon:'<div class="dot-preview diamond-dots"><span></span><span></span><span></span></div>'},{value:"classy-rounded",label:"Classy Rounded",icon:'<div class="dot-preview classy-rounded-dots"><span></span><span></span><span></span></div>'},{value:"square",label:"Square",icon:'<div class="dot-preview square-dots"><span></span><span></span><span></span></div>'}],r=[{value:"extra-rounded",label:"Extra Rounded"},{value:"dot",label:"Dot"},{value:"square",label:"Square"}],l=[{value:"dot",label:"Dot"},{value:"square",label:"Square"}],c=[{primary:"#000000",secondary:"#ffffff",name:"Classic"},{primary:"#4285f4",secondary:"#ffffff",name:"Blue"},{primary:"#ea4335",secondary:"#ffffff",name:"Red"},{primary:"#34a853",secondary:"#ffffff",name:"Green"},{primary:"#fbbc05",secondary:"#ffffff",name:"Yellow"},{primary:"#9c27b0",secondary:"#ffffff",name:"Purple"},{primary:"#ff6d00",secondary:"#ffffff",name:"Orange"},{primary:"#00bcd4",secondary:"#ffffff",name:"Cyan"}];function d(e){const t=e.trim();if(t.match(/^#?[0-9A-Fa-f]{6}$/))return"#"===t.charAt(0)?t.toUpperCase():"#"+t.toUpperCase();const n=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i)||t.match(/(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/);if(n){const e=parseInt(n[1]),t=parseInt(n[2]),a=parseInt(n[3]);if(e>=0&&e<=255&&t>=0&&t<=255&&a>=0&&a<=255)return function(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}(e,t,a)}return null}function u(e,t){return`rgba(${parseInt(e.slice(1,3),16)}, ${parseInt(e.slice(3,5),16)}, ${parseInt(e.slice(5,7),16)}, ${t/100})`}function p(e){a.name=e.target.value.trim(),x()}function m(e){a.url=e.target.value.trim(),x()}function h(e){a.description=e.target.value.trim(),x()}function y(){a.url&&(clearTimeout(i),i=setTimeout(()=>{b()},300))}function g(e){const t=new Uint8Array(e.data);return new Blob([t],{type:e.contentType})}function f(){s.nameInput&&(s.nameInput.value=""),s.urlInput&&(s.urlInput.value=""),s.descriptionInput&&(s.descriptionInput.value=""),s.colorPrimary&&(s.colorPrimary.value="#000000"),s.colorSecondary&&(s.colorSecondary.value="#ffffff"),s.colorPrimaryText&&(s.colorPrimaryText.value="#000000"),s.colorSecondaryText&&(s.colorSecondaryText.value="#ffffff"),s.colorPrimaryOpacity&&(s.colorPrimaryOpacity.value="100"),s.colorSecondaryOpacity&&(s.colorSecondaryOpacity.value="100"),s.colorPrimaryOpacityValue&&(s.colorPrimaryOpacityValue.value="100"),s.colorSecondaryOpacityValue&&(s.colorSecondaryOpacityValue.value="100"),document.querySelectorAll(".qr-style-btn").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".qr-color-preset").forEach(e=>{e.classList.remove("active")}),s.avatarFile&&(s.avatarFile.value=""),s.uploadZone&&(s.uploadZone.style.display="flex"),s.avatarPreviewWrapper&&(s.avatarPreviewWrapper.style.display="none"),s.avatarPreviewImg&&(s.avatarPreviewImg.src=""),document.querySelectorAll(".qr-social-btn").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".qr-logo-tab").forEach(e=>{e.classList.remove("active")});const e=document.querySelector('.qr-logo-tab[data-tab="upload"]');e&&e.classList.add("active"),s.logoUpload&&(s.logoUpload.style.display="block"),s.logoSocial&&(s.logoSocial.style.display="none"),s.previewImage&&(s.previewImage.style.display="none",s.previewImage.src=""),s.previewPlaceholder&&(s.previewPlaceholder.style.display="flex")}function v(e,t){const n=new FormData;return n.append("url",e.url),n.append("name",e.name),n.append("description",e.description),n.append("qrcodeid",e.qrcodeid),n.append("savedata",t?"true":"false"),n.append("settings",JSON.stringify(e.settings)),e.avatarBuffer&&n.append("avatarFile",new Blob([e.avatarBuffer],{type:"image/png"}),"avatar.png"),n}function b(i,o){return __async(this,null,function*(){if(a.name&&a.url&&!a.isGenerating)try{a.isGenerating=!0,s.previewPlaceholder.style.display="none",s.previewLoading.style.display="flex",s.previewImage.style.display="none";const r=u(a.colorPrimary,a.colorPrimaryOpacity),l=u(a.colorSecondary,a.colorSecondaryOpacity);a.colorPrimaryDot===a.colorPrimary&&a.colorPrimaryCornerSquare===a.colorPrimary&&(a.colorPrimaryDot=a.colorPrimary,a.colorPrimaryCornerSquare=a.colorPrimary),a.colorPrimaryDot!==a.colorPrimary&&("#000000"==a.colorPrimaryDot?a.colorPrimaryDot=a.colorPrimary:a.colorPrimaryDot=a.colorPrimaryDot),a.colorPrimaryCornerSquare!==a.colorPrimary&&("#000000"==a.colorPrimaryCornerSquare?a.colorPrimaryCornerSquare=a.colorPrimary:a.colorPrimaryCornerSquare=a.colorPrimaryCornerSquare);const c=u(a.colorPrimaryDot,100),d=u(a.colorPrimaryCornerSquare,100),p={url:a.url,name:a.name,description:a.description,qrcodeid:i||"",settings:{colorPrimary:r,colorSecondary:l,dotsStyle:a.dotsStyle,cornerSquareStyle:a.cornerSquareStyle,cornerDotStyle:a.cornerDotStyle,colorPrimaryDot:c,colorPrimaryCornerSquare:d,logoType:a.logoType||"",socialIconName:a.socialIconName||"",size:300,colorPrimaryOpacity:a.colorPrimaryOpacity||"",colorSecondaryOpacity:a.colorSecondaryOpacity||""},avatarBuffer:a.avatarBuffer||null};let m=v(p,!1);o&&(m=v(p,!0));const h=yield fetch("/api/qr-designer/savetobucket",{method:"POST",body:m,credentials:"include"}),y=yield h.json();if(y.success)if(o)t("QR code saved successfully!"),a.editingId=null,a.isEditMode=!1,f(),a.name="",a.url="",a.description="",a.currentQRDataUrl=null,a.dotsStyle="rounded",a.cornerSquareStyle="extra-rounded",a.cornerDotStyle="dot",a.colorPrimary="#000000",a.colorSecondary="#ffffff",a.colorPrimaryOpacity=100,a.colorSecondaryOpacity=100,a.logoType="none",a.socialIcon=null,a.avatarFile=null,a.avatarDataUrl=null,a.isGenerating=!1,a.currentStep=1,a.colorPrimaryDot="#000000",a.colorPrimaryCornerSquare="#000000",a.socialIconName="",a.editingId="",a.isEditMode=!1,a.avatarBuffer="",a.currentQRBlob="",s.previewPlaceholder.style.display="flex",s.previewLoading.style.display="none",s.previewImage.style.display="none",x(),w(),X();else{const t=g(y.qrData);a.currentQRBlob=t,e.QRBlob=t;const n=URL.createObjectURL(t);a.currentQRDataUrl=n,s.previewImage.src=n,s.previewPlaceholder.style.display="none",s.previewLoading.style.display="none",s.previewImage.style.display="block",x()}else if(s.previewLoading.style.display="none",y.response.limitReached){const e=yield k.show(`<p>You've reached the maximum limit of <strong>${y.maxAllowed} custom QR codes</strong> for your current account.</p>\n                        <p>To create more custom QR codes, please create a new account or upgrade your existing account.</p>`,{type:"warning",title:"QR Code Limit Reached",closable:!0,closeOnOverlay:!1,buttons:[{text:"Cancel",style:"secondary",value:!1},{text:"Create New Account",style:"primary",value:!0,icon:"fas fa-user-plus"}]});!1===e?(q(),f(),function(){document.querySelectorAll(".qr-section").forEach(e=>{e.classList.add("qr-collapsed")}),a.currentStep=1;const e=document.getElementById("personalized-qr");e&&(e.style.display="none")}(),w()):!0===e&&(yield ge(),window.location.href="/signup")}else n(y.message||"Failed to save QR code")}catch(r){}finally{a.isGenerating=!1}})}function w(){const e=document.querySelector('.card-tab[data-card="default-card"]');e&&e.click()}function C(e){const t=e.target.files[0];if(!t)return;if(t.size>5242880)return void k.show("File must be less than 5MB");const n=new FileReader;n.onload=e=>{a.logoType="avatar",a.avatarDataUrl=null,a.avatarBuffer=new Uint8Array(e.target.result),s.avatarPreviewImg.src=URL.createObjectURL(new Blob([a.avatarBuffer],{type:t.type})),s.uploadZone.style.display="none",s.avatarPreviewWrapper.style.display="block",a.socialIcon="",a.socialIconName="",$(".qr-social-btn").removeClass("active"),y()},n.readAsArrayBuffer(t)}function S(){a.avatarDataUrl=null,a.logoType="none",s.avatarFile.value="",s.uploadZone.style.display="flex",s.avatarPreviewWrapper.style.display="none",y()}function E(){if(!a.currentQRDataUrl)return;const e=document.createElement("a"),t=a.name?`${a.name.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`:"qr-code.png";e.download=t,e.href=a.currentQRDataUrl,e.click()}function x(){const e=a.name&&a.url&&a.currentQRDataUrl;s.saveBtn.disabled=!e,s.downloadBtn.disabled=!a.currentQRDataUrl,s.quickDownload.disabled=!a.currentQRDataUrl}function q(){a.name="",a.url="",a.description="",a.dotsStyle="rounded",a.cornerSquareStyle="extra-rounded",a.cornerDotStyle="dot",a.colorPrimary="#000000",a.colorSecondary="#ffffff",a.colorPrimaryOpacity=100,a.colorSecondaryOpacity=100,a.logoType="none",a.socialIcon=null,a.avatarFile=null,a.avatarDataUrl=null,a.currentQRDataUrl=null,a.isGenerating=!1,a.currentStep=1,a.editingId=null,a.isEditMode=!1,a.colorPrimaryDot="#000000",a.colorPrimaryCornerSquare="#000000",x()}return{init:function(){!function(){__async(this,null,function*(){try{let e=JSON.parse(localStorage.getItem("qrcodeIcons")),t={};if(e)t=e;else{const e=yield fetch("/api/qr-designer/geticons",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});t=yield e.json(),localStorage.setItem("qrcodeIcons",JSON.stringify(t))}if(t.message&&t.message.success){const e=`\n                    <div class="qr-social-grid">\n                        ${t.message.data.map((e,t)=>`\n                            <button class="qr-social-btn" data-index="${t}" title="${e.name}">\n                                <img src="${e.url}" class="qr-social-img" />\n                            </button>\n                        `).join("")}\n                    </div>\n                `;let n=$("#qr-social-icons-container").length;setTimeout(()=>{n>0&&($("#qr-social-icons-container").empty(),$("#qr-social-icons-container").append(e))},1e3)}}catch(e){}})}();const e=document.getElementById("design-card-view");e&&(e.innerHTML=`\n            <div class="qr-designer-elegant">\n                \x3c!-- Header --\x3e\n                <div class="qr-header">\n                    <div class="qr-designer-title-icon">\n                        <h2 class="qr-title">\n                            <i class="fas fa-qrcode"></i>\n                            \n                        </h2>\n                        <h2 class="qr-title">\n                        QR Code Designer\n                            \n                        </h2>\n                    </div>\n                    <div class="qr-designer-subtitle">\n                        <p class="qr-subtitle">Create beautiful, professional QR codes in seconds</p>\n                    </div>\n                    <div class="qrcode-position">(QRCode Preview will be at the bottom of the screen.)</div>\n                </div>\n\n                <div class="qr-main-layout">\n                    \x3c!-- Left Panel - Controls --\x3e\n                    <div class="qr-controls-panel">\n                        \n            <div class="qr-section" data-step="1">\n                <div class="qr-section-header" data-toggle-step="1">\n                    <div class="qr-section-title-wrapper">\n                        <span class="qr-step-number">1</span>\n                        <h3 class="qr-section-title">\n                            <i class="fas fa-link"></i>\n                            Data\n                        </h3>\n                    </div>\n                    <i class="fas fa-chevron-down qr-collapse-icon"></i>\n                </div>\n                <div class="qr-section-content">\n                    <div class="qr-form-group">\n                        <label class="qr-label">Name <span class="qr-required">*</span></label>\n                        <input \n                            type="text" \n                            id="qr-name-input" \n                            class="qr-input-elegant" \n                            placeholder="My QR Code"\n                            maxlength="150"\n                        />\n                    </div>\n                    <div class="qr-form-group">\n                        <label class="qr-label">URL <span class="qr-required">*</span></label>\n                        <input \n                            type="url" \n                            id="qr-url-input" \n                            class="qr-input-elegant" \n                            placeholder="https://example.com"\n                        />\n                        <div class="qr-input-hint">Enter the destination link for your QR code. (ex: https://google.com)</div>\n                    </div>\n                    <div class="qr-form-group">\n                        <label class="qr-label">Description </label>\n                        <textarea \n                            id="myqrcodeDescription"\n                            rows="4"\n                            maxlength="500"\n                            placeholder="Type here (max 500 characters)..."></textarea>\n                        <div class="qr-input-hint">Enter the short texts for QR code.</div>\n                    </div>\n                    <button class="qr-next-btn" data-next-step="2">\n                        Next: Dots Style <i class="fas fa-arrow-right"></i>\n                    </button>\n                </div>\n            </div>\n        \n                        \n            <div class="qr-section qr-collapsed" data-step="2">\n                <div class="qr-section-header" data-toggle-step="2">\n                    <div class="qr-section-title-wrapper">\n                        <span class="qr-step-number">2</span>\n                        <h3 class="qr-section-title">\n                            <i class="fas fa-grip-dots"></i>\n                            Dots Style\n                        </h3>\n                    </div>\n                    <i class="fas fa-chevron-down qr-collapse-icon"></i>\n                </div>\n                <div class="qr-section-content">\n                    <div class="qr-style-grid">\n                        ${o.map(e=>`\n                            <label class="qr-style-card ${"rounded"===e.value?"active":""}" data-style="${e.value}">\n                                <input \n                                    type="radio" \n                                    name="dots-style" \n                                    value="${e.value}"\n                                    ${"rounded"===e.value?"checked":""}\n                                />\n                                <div class="qr-style-preview">${e.icon}</div>\n                                <div class="qr-style-name">${e.label}</div>\n                            </label>\n                        `).join("")}\n                    </div>\n                    <button class="qr-next-btn" data-next-step="3">\n                        Next: Corners <i class="fas fa-arrow-right"></i>\n                    </button>\n                </div>\n            </div>\n        \n                        \n            <div class="qr-section qr-collapsed" data-step="3">\n                <div class="qr-section-header" data-toggle-step="3">\n                    <div class="qr-section-title-wrapper">\n                        <span class="qr-step-number">3</span>\n                        <h3 class="qr-section-title">\n                            <i class="fas fa-vector-square"></i>\n                            Corners\n                        </h3>\n                    </div>\n                    <i class="fas fa-chevron-down qr-collapse-icon"></i>\n                </div>\n                <div class="qr-section-content">\n                    <div class="qr-form-group">\n                        <label class="qr-label">Corner Square Style</label>\n                        <select id="qr-corner-square-style" class="qr-select-elegant">\n                            ${r.map(e=>`\n                                <option value="${e.value}" ${"extra-rounded"===e.value?"selected":""}>\n                                    ${e.label}\n                                </option>\n                            `).join("")}\n                        </select>\n                        <div class="qr-color-input-wrapper corner-color-picker-div">\n                                    <input type="color" id="qr-color-corner-square" class="qr-color-input" value="#000000">\n                                    <input type="text" id="qr-color-corner-square-text" class="qr-color-text-input" value="#000000" placeholder="#000000 or rgb(0,0,0)">\n                        </div>\n                    </div>\n                    <div class="qr-form-group">\n                        <label class="qr-label">Corner Dot Style</label>\n                        <select id="qr-corner-dot-style" class="qr-select-elegant">\n                            ${l.map(e=>`\n                                <option value="${e.value}" ${"dot"===e.value?"selected":""}>\n                                    ${e.label}\n                                </option>\n                            `).join("")}\n                        </select>\n                        <div class="qr-color-input-wrapper corner-color-picker-div">\n                                    <input type="color" id="qr-color-corner-dot" class="qr-color-input" value="#000000">\n                                    <input type="text" id="qr-color-corner-dot-text" class="qr-color-text-input" value="#000000" placeholder="#000000 or rgb(0,0,0)">\n                        </div>\n                    </div>\n                    <button class="qr-next-btn" data-next-step="4">\n                        Next: Colors <i class="fas fa-arrow-right"></i>\n                    </button>\n                </div>\n            </div>\n        \n                        \n            <div class="qr-section qr-collapsed" data-step="4">\n                <div class="qr-section-header" data-toggle-step="4">\n                    <div class="qr-section-title-wrapper">\n                        <span class="qr-step-number">4</span>\n                        <h3 class="qr-section-title">\n                            <i class="fas fa-palette"></i>\n                            Colors\n                        </h3>\n                    </div>\n                    <i class="fas fa-chevron-down qr-collapse-icon"></i>\n                </div>\n                <div class="qr-section-content">\n                    <div class="qr-color-presets">\n                        ${c.map((e,t)=>`\n                            <button \n                                class="qr-color-preset ${0===t?"active":""}" \n                                data-primary="${e.primary}"\n                                data-secondary="${e.secondary}"\n                                style="background: linear-gradient(135deg, ${e.primary} 0%, ${e.secondary} 100%);"\n                                title="${e.name}"\n                            ></button>\n                        `).join("")}\n                    </div>\n                    <div class="qr-color-pickers">\n                        <div class="qr-color-picker-group">\n                            <label class="qr-label">Dots Color</label>\n                            <div class="qr-color-controls">\n                                <div class="qr-color-input-wrapper">\n                                    <input type="color" id="qr-color-primary" class="qr-color-input" value="#000000">\n                                    <input type="text" id="qr-color-primary-text" class="qr-color-text-input" value="#000000" placeholder="#000000 or rgb(0,0,0)">\n                                </div>\n                                <div class="qr-opacity-wrapper">\n                                    <label class="qr-opacity-label">Opacity</label>\n                                    <div class="qr-opacity-controls">\n                                        <input type="range" id="qr-color-primary-opacity" class="qr-opacity-slider" min="0" max="100" value="100">\n                                        <input type="number" id="qr-color-primary-opacity-value" class="qr-opacity-value" min="0" max="100" value="100">\n                                        <span class="qr-opacity-percent">%</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="qr-color-picker-group">\n                            <label class="qr-label">Background</label>\n                            <div class="qr-color-controls">\n                                <div class="qr-color-input-wrapper">\n                                    <input type="color" id="qr-color-secondary" class="qr-color-input" value="#ffffff">\n                                    <input type="text" id="qr-color-secondary-text" class="qr-color-text-input" value="#ffffff" placeholder="#ffffff or rgb(255,255,255)">\n                                </div>\n                                <div class="qr-opacity-wrapper">\n                                    <label class="qr-opacity-label">Opacity</label>\n                                    <div class="qr-opacity-controls">\n                                        <input type="range" id="qr-color-secondary-opacity" class="qr-opacity-slider" min="0" max="100" value="100">\n                                        <input type="number" id="qr-color-secondary-opacity-value" class="qr-opacity-value" min="0" max="100" value="100">\n                                        <span class="qr-opacity-percent">%</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <button class="qr-next-btn" data-next-step="5">\n                        Next: Logo <i class="fas fa-arrow-right"></i>\n                    </button>\n                </div>\n            </div>\n        \n                        \n            <div class="qr-section qr-collapsed" data-step="5">\n                <div class="qr-section-header" data-toggle-step="5">\n                    <div class="qr-section-title-wrapper">\n                        <span class="qr-step-number">5</span>\n                        <h3 class="qr-section-title">\n                            <i class="fas fa-image"></i>\n                            Logo (Optional)\n                        </h3>\n                    </div>\n                    <i class="fas fa-chevron-down qr-collapse-icon"></i>\n                </div>\n                <div class="qr-section-content">\n                    <div class="qr-logo-tabs">\n                        <button class="qr-logo-tab active" data-tab="none">\n                            <i class="fas fa-ban"></i> None\n                        </button>\n                        <button class="qr-logo-tab" data-tab="social">\n                            <i class="fas fa-share-alt"></i> Social\n                        </button>\n                        <button class="qr-logo-tab" data-tab="upload">\n                            <i class="fas fa-upload"></i> Upload\n                        </button>\n                    </div>\n                    \n                    <div id="qr-logo-social" class="qr-logo-content" style="display:none;">\n                        <div class="qr-social-grid" id="qr-social-icons-container">\n                            \n                        </div>\n                    </div>\n                    \n                    <div id="qr-logo-upload" class="qr-logo-content" style="display:none;">\n                        <div class="qr-upload-zone" id="qr-upload-zone">\n                            <input type="file" id="qr-avatar-file" accept="image/*" style="display:none;">\n                            <i class="fas fa-cloud-upload-alt"></i>\n                            <p>Click to upload or drag & drop</p>\n                            <span class="qr-upload-hint">PNG, JPG up to 5MB</span>\n                        </div>\n                        <div id="qr-avatar-preview-wrapper" class="qr-avatar-preview-wrapper" style="display:none;">\n                            <img id="qr-avatar-preview-img" class="qr-avatar-preview-img" alt="Logo">\n                            <button class="qr-remove-logo" id="qr-remove-logo">\n                                <i class="fas fa-times"></i>\n                            </button>\n                        </div>\n                    </div>\n                    <button class="qr-next-btn" data-next-step="6">\n                        Next: Actions <i class="fas fa-arrow-right"></i>\n                    </button>\n                </div>\n            </div>\n        \n                        \n            <div class="qr-section qr-collapsed" data-step="6">\n                <div class="qr-section-header" data-toggle-step="6">\n                    <div class="qr-section-title-wrapper">\n                        <span class="qr-step-number">6</span>\n                        <h3 class="qr-section-title">\n                            <i class="fas fa-check-circle"></i>\n                            Save & Download\n                        </h3>\n                    </div>\n                    <i class="fas fa-chevron-down qr-collapse-icon"></i>\n                </div>\n                <div class="qr-section-content">\n                    <div class="qr-actions-elegant">\n                        <button class="qr-btn-elegant qr-btn-primary" id="qr-save-btn" disabled>\n                            <i class="fas fa-save"></i>\n                            Save to Pocket\n                        </button>\n                        <button class="qr-btn-elegant qr-btn-secondary" id="qr-download-btn" disabled>\n                            <i class="fas fa-download"></i>\n                            Download PNG\n                        </button>\n                    </div>\n                </div>\n            </div>\n        \n                    </div>\n\n                    \x3c!-- Right Panel - Preview --\x3e\n                    <div class="qr-preview-panel-elegant">\n                        <div class="qr-preview-sticky">\n                            <div class="qr-preview-header">\n                                <h3>Preview</h3>\n                                <button class="qr-preview-download" id="qr-quick-download" disabled>\n                                    <i class="fas fa-download"></i>\n                                </button>\n                            </div>\n                            <div class="qr-preview-box" id="qr-preview-box">\n                                <div class="qr-preview-placeholder" id="qr-preview-placeholder">\n                                    <i class="fas fa-qrcode"></i>\n                                    <p>Enter URL to generate</p>\n                                </div>\n                                <div class="qr-preview-loading" id="qr-preview-loading" style="display:none;">\n                                    <div class="qr-spinner"></div>\n                                    <p>Generating...</p>\n                                </div>\n                                <img id="qr-preview-image" class="qr-preview-img" style="display:none;" alt="QR Preview">\n                            </div>\n                            <div class="qr-preview-info">\n                                <p><i class="fas fa-info-circle"></i> Scan with your camera to test</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,s={nameInput:document.getElementById("qr-name-input"),urlInput:document.getElementById("qr-url-input"),descriptionInput:document.getElementById("myqrcodeDescription"),dotsStyleInputs:document.querySelectorAll('input[name="dots-style"]'),cornerSquareStyle:document.getElementById("qr-corner-square-style"),colorPrimaryCornerSquare:document.getElementById("qr-color-corner-square"),colorPrimaryTextCornerSquare:document.getElementById("qr-color-corner-square-text"),cornerDotStyle:document.getElementById("qr-corner-dot-style"),colorPrimaryDot:document.getElementById("qr-color-corner-dot"),colorPrimaryTextDot:document.getElementById("qr-color-corner-dot-text"),colorPresets:document.querySelectorAll(".qr-color-preset"),colorPrimary:document.getElementById("qr-color-primary"),colorPrimaryText:document.getElementById("qr-color-primary-text"),colorPrimaryOpacity:document.getElementById("qr-color-primary-opacity"),colorPrimaryOpacityValue:document.getElementById("qr-color-primary-opacity-value"),colorSecondary:document.getElementById("qr-color-secondary"),colorSecondaryText:document.getElementById("qr-color-secondary-text"),colorSecondaryOpacity:document.getElementById("qr-color-secondary-opacity"),colorSecondaryOpacityValue:document.getElementById("qr-color-secondary-opacity-value"),logoTabs:document.querySelectorAll(".qr-logo-tab"),logoSocial:document.getElementById("qr-logo-social"),logoUpload:document.getElementById("qr-logo-upload"),socialBtns:document.querySelectorAll(".qr-social-btn"),uploadZone:document.getElementById("qr-upload-zone"),avatarFile:document.getElementById("qr-avatar-file"),avatarPreviewWrapper:document.getElementById("qr-avatar-preview-wrapper"),avatarPreviewImg:document.getElementById("qr-avatar-preview-img"),removeLogo:document.getElementById("qr-remove-logo"),previewPlaceholder:document.getElementById("qr-preview-placeholder"),previewLoading:document.getElementById("qr-preview-loading"),previewImage:document.getElementById("qr-preview-image"),saveBtn:document.getElementById("qr-save-btn"),downloadBtn:document.getElementById("qr-download-btn"),quickDownload:document.getElementById("qr-quick-download")},s.nameInput.addEventListener("input",p),s.urlInput.addEventListener("input",m),s.descriptionInput.addEventListener("input",h),s.cornerDotStyle.addEventListener("change",e=>{a.cornerDotStyle=e.target.value,y()}),s.colorPrimaryDot.addEventListener("input",e=>{a.colorPrimaryDot=e.target.value,s.colorPrimaryTextDot.value=e.target.value.toUpperCase(),y()}),s.colorPrimaryTextDot.addEventListener("change",e=>{const t=d(e.target.value);t?(a.colorPrimaryDot=t,s.colorPrimaryDot.value=t,s.colorPrimaryTextDot.value=t.toUpperCase(),y()):s.colorPrimaryTextDot.value=a.colorPrimaryDot.toUpperCase()}),s.dotsStyleInputs.forEach(e=>{e.addEventListener("change",e=>{document.querySelectorAll(".qr-style-card").forEach(e=>e.classList.remove("active")),e.target.closest(".qr-style-card").classList.add("active"),a.dotsStyle=e.target.value,y()})}),s.colorPrimaryCornerSquare.addEventListener("input",e=>{a.colorPrimaryCornerSquare=e.target.value,s.colorPrimaryTextCornerSquare.value=e.target.value.toUpperCase(),y()}),s.colorPrimaryTextCornerSquare.addEventListener("change",e=>{const t=d(e.target.value);t?(a.colorPrimaryCornerSquare=t,s.colorPrimaryCornerSquare.value=t,s.colorPrimaryTextCornerSquare.value=t.toUpperCase(),y()):s.colorPrimaryTextCornerSquare.value=a.colorPrimaryCornerSquare.toUpperCase()}),s.cornerSquareStyle.addEventListener("change",e=>{a.cornerSquareStyle=e.target.value,y()}),s.colorPresets.forEach(e=>{e.addEventListener("click",t=>{s.colorPresets.forEach(e=>e.classList.remove("active")),e.classList.add("active");const n=e.dataset.primary,i=e.dataset.secondary;s.colorPrimary.value=n,s.colorPrimaryText.value=n.toUpperCase(),a.colorPrimary=n,s.colorSecondary.value=i,s.colorSecondaryText.value=i.toUpperCase(),a.colorSecondary=i,y()})}),s.colorPrimary.addEventListener("input",e=>{a.colorPrimary=e.target.value,s.colorPrimaryText.value=e.target.value.toUpperCase(),y()}),s.colorPrimaryText.addEventListener("change",e=>{const t=d(e.target.value);t?(a.colorPrimary=t,s.colorPrimary.value=t,s.colorPrimaryText.value=t.toUpperCase(),y()):s.colorPrimaryText.value=a.colorPrimary.toUpperCase()}),s.colorPrimaryOpacity.addEventListener("input",e=>{const t=e.target.value;a.colorPrimaryOpacity=parseInt(t),s.colorPrimaryOpacityValue.value=t,y()}),s.colorPrimaryOpacityValue.addEventListener("change",e=>{let t=parseInt(e.target.value);isNaN(t)&&(t=100),t=Math.max(0,Math.min(100,t)),a.colorPrimaryOpacity=t,s.colorPrimaryOpacity.value=t,s.colorPrimaryOpacityValue.value=t,y()}),s.colorSecondary.addEventListener("input",e=>{a.colorSecondary=e.target.value,s.colorSecondaryText.value=e.target.value.toUpperCase(),y()}),s.colorSecondaryText.addEventListener("change",e=>{const t=d(e.target.value);t?(a.colorSecondary=t,s.colorSecondary.value=t,s.colorSecondaryText.value=t.toUpperCase(),y()):s.colorSecondaryText.value=a.colorSecondary.toUpperCase()}),s.colorSecondaryOpacity.addEventListener("input",e=>{const t=e.target.value;a.colorSecondaryOpacity=parseInt(t),s.colorSecondaryOpacityValue.value=t,y()}),s.colorSecondaryOpacityValue.addEventListener("change",e=>{let t=parseInt(e.target.value);isNaN(t)&&(t=100),t=Math.max(0,Math.min(100,t)),a.colorSecondaryOpacity=t,s.colorSecondaryOpacity.value=t,s.colorSecondaryOpacityValue.value=t,y()}),s.avatarPreviewImg.addEventListener("click",()=>{a.avatarDataUrl&&(a.logoType="avatar",a.socialIcon="",a.socialIconName="",$(".qr-social-btn").removeClass("active"),y())}),s.logoTabs.forEach(e=>{e.addEventListener("click",t=>{s.logoTabs.forEach(e=>e.classList.remove("active")),e.classList.add("active");const n=e.dataset.tab;s.logoSocial.style.display="social"===n?"block":"none",s.logoUpload.style.display="upload"===n?"block":"none","none"===n?(a.logoType="none",a.socialIcon="",a.socialIconName="",a.avatarDataUrl=null,a.avatarBuffer=null,$(".qr-social-btn").removeClass("active"),s.uploadZone.style.display="flex",s.avatarPreviewWrapper.style.display="none",y()):"social"===n?(a.logoType="social",a.avatarDataUrl=null,a.avatarBuffer=null,a.socialIconName&&y()):"upload"===n&&(a.socialIcon="",a.socialIconName="",$(".qr-social-btn").removeClass("active"),a.avatarBuffer||a.avatarDataUrl?(a.logoType="avatar",y()):a.logoType="none")})}),$(document).on("click",".qr-social-btn",function(){$(".qr-social-btn").removeClass("active"),$(this).addClass("active"),parseInt($(this).data("index")),a.logoType="social",a.socialIcon=$(this).attr("title").toLowerCase(),a.socialIconName=$(this).attr("title").toLowerCase(),a.avatarDataUrl=null,a.avatarBuffer=null,y()}),s.uploadZone.addEventListener("click",()=>{s.avatarFile.click()}),s.avatarFile.addEventListener("change",C),s.removeLogo.addEventListener("click",S),s.saveBtn.addEventListener("click",()=>b("",!0)),s.downloadBtn.addEventListener("click",E),s.quickDownload.addEventListener("click",E),document.querySelectorAll("[data-toggle-step]").forEach(e=>{e.addEventListener("click",function(){!function(e){const t=document.querySelector(`.qr-section[data-step="${e}"]`);t&&(t.classList.contains("qr-collapsed")?(t.classList.remove("qr-collapsed"),a.currentStep=e):t.classList.add("qr-collapsed"))}(parseInt(this.getAttribute("data-toggle-step")))})}),document.querySelectorAll(".qr-next-btn").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),function(e){if(1===a.currentStep||2===e){if(!a.url)return void k.show("Please enter a URL before proceeding");a.currentQRDataUrl||b()}const t=document.querySelector(`.qr-section[data-step="${a.currentStep}"]`);t&&t.classList.add("qr-collapsed");const n=document.querySelector(`.qr-section[data-step="${e}"]`);n&&(n.classList.remove("qr-collapsed"),a.currentStep=e,n.scrollIntoView({behavior:"smooth",block:"nearest"}))}(parseInt(this.getAttribute("data-next-step")))})}),a.dotsStyle="rounded",a.cornerSquareStyle="extra-rounded",a.cornerDotStyle="dot",a.colorPrimary="#000000",a.colorSecondary="#ffffff",a.colorPrimaryOpacity=100,a.colorSecondaryOpacity=100)},updateState:function(e){Object.assign(a,e),x()},updateActiveqrblob:function(t){Object.assign(e,t);const n=URL.createObjectURL(e.QRBlob);a.currentQRDataUrl=n},getState:function(){return __spreadValues({},a)},resetState:q,forceRegenerate:function(e){a.url&&a.url.trim()&&b(e)},mongoBufferToBlob:g}}(),re=function(){function e(e){return __async(this,null,function*(){e.preventDefault();const a=$(this).data("qrcodeid");if(a)try{$(this).prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> Loading...');let e={qrcodeId:a};const n=yield fetch("/api/qr-designer/edit",{headers:{"Content-Type":"application/json"},credentials:"include",method:"POST",body:JSON.stringify(e)}),r=yield n.json();if(r.success&&r.qrCode)!function(){const e=document.querySelector('.card-tab[data-card="design-card"]');e&&e.click();const t=document.getElementById("design-card-view");t&&(document.querySelectorAll(".carousel-card").forEach(e=>{e.classList.remove("active")}),t.classList.add("active"),document.querySelectorAll(".card-tab").forEach(e=>{e.classList.remove("active")}),e&&e.classList.add("active"),t.scrollIntoView({behavior:"smooth",block:"nearest"}))}(),function(e){const t=document.getElementById("qr-name-input"),n=document.getElementById("qr-url-input"),a=document.getElementById("myqrcodeDescription");t&&(t.value=e.name||"");n&&(n.value=e.url||"");a&&(a.value=e.description||"");const r=e.settings||{},l=r.dotsStyle||"rounded",c=document.querySelector(`input[name="dots-style"][value="${l}"]`);if(c){c.checked=!0,document.querySelectorAll(".qr-style-card").forEach(e=>e.classList.remove("active"));const e=c.closest(".qr-style-card");e&&e.classList.add("active")}const d=document.getElementById("qr-corner-square-style"),u=document.getElementById("qr-corner-dot-style");d&&r.cornerSquareStyle&&(d.value=r.cornerSquareStyle);u&&r.cornerDotStyle&&(u.value=r.cornerDotStyle);const p=o(r.colorPrimary)||"#000000",m=o(r.colorSecondary)||"#ffffff",h=document.getElementById("qr-color-primary"),y=document.getElementById("qr-color-primary-text"),g=document.getElementById("qr-color-secondary"),f=document.getElementById("qr-color-secondary-text");h&&(h.value=p);y&&(y.value=p.toUpperCase());g&&(g.value=m);f&&(f.value=m.toUpperCase());const v=o(r.colorPrimaryDot)||"#000000",b=o(r.colorPrimaryCornerSquare)||"#000000",w=document.getElementById("qr-color-corner-square"),C=document.getElementById("qr-color-corner-square-text"),S=document.getElementById("qr-color-corner-dot"),E=document.getElementById("qr-color-corner-dot-text");S&&(S.value=v);E&&(E.value=v.toUpperCase());w&&(w.value=b);C&&(C.value=b.toUpperCase());document.querySelectorAll(".qr-color-preset").forEach(e=>{e.classList.remove("active")});let x=r.logoType;"avatar"==r.logoType&&(x="upload");if(r.logoType&&"none"!==r.logoType){const t=document.querySelector(`.qr-logo-tab[data-tab="${x}"]`);if(t){document.querySelectorAll(".qr-logo-tab").forEach(e=>e.classList.remove("active")),t.classList.add("active");const e=document.getElementById("qr-logo-social"),n=document.getElementById("qr-logo-upload");e&&(e.style.display="social"===x?"block":"none"),n&&(n.style.display="upload"===x?"block":"none")}if("social"===r.logoType&&r.socialIconName&&setTimeout(()=>{$(".qr-social-btn").removeClass("active");const e=$(`.qr-social-btn[title="${t=r.socialIconName,t?t.charAt(0).toUpperCase()+t.slice(1):""}"]`);var t;e.length&&e.addClass("active")},300),"avatar"===r.logoType&&e.data&&r.avatarFile){const e=document.getElementById("qr-avatar-preview-img"),t=document.getElementById("qr-avatar-preview-wrapper"),n=document.getElementById("qr-upload-zone");let a=i(r.avatarFile);e&&(e.src=a),t&&(t.style.display="block"),n&&(n.style.display="none")}}else{const e=document.querySelector('.qr-logo-tab[data-tab="none"]');e&&(document.querySelectorAll(".qr-logo-tab").forEach(e=>e.classList.remove("active")),e.classList.add("active"))}if(e.data){const t=document.getElementById("qr-preview-image");if(t&&e.data){let n=i(e.data);t.src=n,t.style.display="block";const a=document.getElementById("qr-preview-placeholder"),s=document.getElementById("qr-preview-loading");a&&(a.style.display="none"),s&&(s.style.display="none")}}const k=document.querySelector('.qr-section[data-step="1"]');k&&k.classList.remove("qr-collapsed");function q(e){let t="";return e&&Array.isArray(e)&&(t=new Uint8Array(e)),t}if(oe&&"function"==typeof oe.updateState){let t="";e.settings.avatarFile&&e.settings.avatarFile.data&&(t=q(e.settings.avatarFile.data)),oe.updateState({name:e.name||"",url:e.url||"",description:e.description||"",dotsStyle:r.dotsStyle||"rounded",cornerSquareStyle:r.cornerSquareStyle||"extra-rounded",cornerDotStyle:r.cornerDotStyle||"dot",colorPrimary:p,colorSecondary:m,colorPrimaryOpacity:s(r.colorPrimary)||100,colorSecondaryOpacity:s(r.colorSecondary)||100,logoType:r.logoType||"none",socialIcon:r.socialIconName||null,socialIconName:r.socialIconName||null,avatarDataUrl:r.logoDataUrl||null,currentQRDataUrl:e.data||null,editingId:e.id||null,isEditMode:!0,avatarBuffer:t,colorPrimaryDot:r.colorPrimaryDot||"#000000",colorPrimaryCornerSquare:r.colorPrimaryCornerSquare||"#000000"});const n=oe.mongoBufferToBlob(e.data);oe.updateActiveqrblob({QRBlob:n||""})}}(r.qrCode),t("QR Code loaded for editing");else if(r.response.limitReached){const e=yield k.show(`<p>You've reached the maximum limit of <strong>${r.maxAllowed} custom QR codes</strong> for your current account.</p>\n                        <p>To create more custom QR codes, please create a new account or upgrade your existing account.</p>`,{type:"warning",title:"QR Code Limit Reached",closable:!0,closeOnOverlay:!1,buttons:[{text:"Cancel",style:"secondary",value:!1},{text:"Create New Account",style:"primary",value:!0,icon:"fas fa-user-plus"}]});!1===e||!0===e&&(yield ge(),window.location.href="/signup")}else{yield k.show(`<p>Some Error on Server <strong>${r.message} </strong> for your current account.</p>`,{type:"warning",title:"Server Error",closable:!0,closeOnOverlay:!1,buttons:[{text:"Cancel",style:"secondary",value:!1}]})}}catch(r){n("Failed to load QR code for editing")}finally{$(this).prop("disabled",!1).html('<i class="fas fa-edit"></i> Edit')}else n("QR Code ID not found")})}function a(e){return __async(this,null,function*(){e.preventDefault();const a=$(this).data("qrcodeid");a?k.show("Are you sure you want to delete this QR code? This action cannot be undone.",{type:"confirm",buttons:[{text:"Cancel",style:"secondary"},{text:"Proceed",style:"primary",onClick:()=>__async(this,null,function*(){try{$(this).prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> Deleting...');const e=yield fetch(`/api/qr-designer/${a}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),n=yield e.json();n.success?(t("QR Code deleted successfully"),$(this).closest(".profile-qrcode-div").fadeOut(300,function(){$(this).remove(),function(){if(0===document.querySelectorAll(".profile-qrcode-div").length){const e=document.getElementById("generatedQR")||document.querySelector(".owner-qr-code-options");e&&(e.innerHTML='\n                    <div class="empty-state" style="text-align: center; padding: 3rem 1rem;">\n                        <i class="fas fa-qrcode" style="font-size: 4rem; opacity: 0.3; margin-bottom: 1rem; color: white;"></i>\n                        <h3 style="color: white; margin-bottom: 0.5rem;">No Custom QR Codes Yet</h3>\n                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1.5rem;">Create your first personalized QR code using the designer</p>\n                        <button class="btn btn-primary" onclick="document.querySelector(\'.card-tab[data-card=\\\'design-card\\\']\').click()">\n                            <i class="fas fa-plus"></i> Create QR Code\n                        </button>\n                    </div>\n                ')}}()}),k.success("QR Code deleted successfully")):(k.error("Failed to delete QR code: "+n.message),$(this).prop("disabled",!1).html('<i class="fas fa-trash-alt"></i> Delete'))}catch(e){k.error("Failed to delete QR code: "+e.message),$(this).prop("disabled",!1).html('<i class="fas fa-trash-alt"></i> Delete')}})}]}):n("QR Code ID not found")})}function i(e){if(e.data&&Array.isArray(e.data)){const t=new Uint8Array(e.data),n=new Blob([t],{type:e.data.contentType||"image/png"});return URL.createObjectURL(n)}return null}function s(e){if(!e)return 100;if(e.startsWith("rgba")){const t=e.match(/rgba?\([\d\s,]+,\s*([\d.]+)\)/);if(t&&t[1])return Math.round(100*parseFloat(t[1]))}return 100}function o(e){if(!e)return null;if(e.startsWith("#"))return e.substring(0,7);if(e.startsWith("rgba")||e.startsWith("rgb")){const t=e.match(/\d+/g);if(t&&t.length>=3){return function(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]))}}return null}return{init:function(t){$(document).on("click",".edit-qr-btn",e),$(document).on("click",".delete-qr-btn",a)}}}();let le=null,ce=null;function de(e){le=e}function ue(e){ce=e}function pe(){return le}function me(){return ce}function he(){return __async(this,null,function*(){window.location.href=`${g.baseURL}/auth/google`})}function ye(){return __async(this,null,function*(){window.location.href=`${g.baseURL}/auth/google`})}function ge(){return __async(this,null,function*(){try{(yield g.logout())&&($("#navbarAvatar").css("display","none"),$("#navbarAvatarDesktop").css("display","none"),le=null,ce=null,fe(),ve(),Re("home"),t("Successfully logged out!"),$("#footer-cta").removeClass("display-none-cta-button"),$("#footer-cta").addClass("cta-section"),$("#singup-cta-button-div-uc").removeClass("display-none-cta-button"),$("#singup-cta-button-div-uc").addClass("usecase-cta"))}catch(e){n("Error logging out. Please try again.")}})}function fe(){document.getElementById("authNav");const e=document.getElementById("loginBtn"),t=document.getElementById("signupBtn"),n=document.getElementById("profileBtn"),a=document.getElementById("displayBtn"),i=document.getElementById("walletBtn"),s=document.getElementById("logoutBtn"),o=document.getElementById("faqBtn");null==o||o.classList.remove("hidden"),le?(null==e||e.classList.add("hidden"),null==t||t.classList.add("hidden"),null==n||n.classList.remove("hidden"),null==a||a.classList.remove("hidden"),null==i||i.classList.remove("hidden"),null==s||s.classList.remove("hidden")):(null==e||e.classList.remove("hidden"),null==t||t.classList.remove("hidden"),null==n||n.classList.add("hidden"),null==a||a.classList.add("hidden"),null==i||i.classList.add("hidden"),null==s||s.classList.add("hidden"))}function ve(){const e=document.getElementById("loginBtnMobile"),t=document.getElementById("signupBtnMobile"),n=document.getElementById("profileBtnMobile"),a=document.getElementById("displayBtnMobile"),i=document.getElementById("walletBtnMobile"),s=document.getElementById("logoutBtnMobile"),o=document.getElementById("faqBtnMobile");null==o||o.classList.remove("hidden"),le?(null==e||e.classList.add("hidden"),null==t||t.classList.add("hidden"),null==n||n.classList.remove("hidden"),null==a||a.classList.remove("hidden"),null==i||i.classList.remove("hidden"),null==s||s.classList.remove("hidden")):(null==e||e.classList.remove("hidden"),null==t||t.classList.remove("hidden"),null==n||n.classList.add("hidden"),null==a||a.classList.add("hidden"),null==i||i.classList.add("hidden"),null==s||s.classList.add("hidden"))}const be={baseURL:window.location.origin,initialize(){return __async(this,null,function*(){if(!window.CryptoHelper)return!1;return!!(yield window.CryptoHelper.initialize())})},signup(e,t,n,a){return __async(this,null,function*(){const i=yield v.hashPassword(t),s=yield fetch(`${this.baseURL}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:i,name:n,signupData:a})});return yield s.json()})},verifyEmail(e,t){return __async(this,null,function*(){const n=yield fetch(`${this.baseURL}/auth/verify-email`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,code:t})});return yield n.json()})},resendVerification(e){return __async(this,null,function*(){const t=yield fetch(`${this.baseURL}/auth/resend-verification`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});return yield t.json()})},login(e,t){return __async(this,null,function*(){const n=yield v.hashPassword(t),a=yield fetch(`${this.baseURL}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e,password:n})});return yield a.json()})},forgotPassword(e){return __async(this,null,function*(){const t=yield fetch(`${this.baseURL}/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:e})});return yield t.json()})},resetPassword(e,t){return __async(this,null,function*(){const n=yield v.hashPassword(t),a=yield fetch(`${this.baseURL}/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:e,password:n})});return yield a.json()})}};function we(e){let t=0;const n={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)};Object.keys(n).forEach(e=>{const a=document.getElementById(`req-${e}`);a&&(n[e]?(a.classList.add("valid"),t++):a.classList.remove("valid"))});const a=document.getElementById("strengthBarFill"),i=document.getElementById("strengthText");return a&&i&&(a.className="strength-bar-fill",t<=2?(a.classList.add("weak"),i.textContent="Weak password",i.style.color="#e74c3c"):t<=4?(a.classList.add("medium"),i.textContent="Medium password",i.style.color="#f39c12"):(a.classList.add("strong"),i.textContent="Strong password",i.style.color="#27ae60")),n}function $e(e){let t=0;const n={length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/[0-9]/.test(e),special:/[@$!%*?&#]/.test(e)};Object.keys(n).forEach(e=>{const a=document.getElementById(`req-newpass-${e}`);a&&(n[e]?(a.classList.add("valid"),t++):a.classList.remove("valid"))});const a=document.getElementById("strengthBarFillnewpass"),i=document.getElementById("strengthTextnewpass");return a&&i&&(a.className="strength-bar-fill-newpass",t<=2?(a.classList.add("weak"),i.textContent="Weak password",i.style.color="#e74c3c"):t<=4?(a.classList.add("medium"),i.textContent="Medium password",i.style.color="#f39c12"):(a.classList.add("strong"),i.textContent="Strong password",i.style.color="#27ae60")),n}function Ce(){return __async(this,null,function*(){try{const a=$("#loginEmail").val().trim(),i=$("#loginPassword").val().trim(),s=yield be.login(a,i);if(s.success){s.token&&(localStorage.setItem("authToken",s.token),g.setToken(s.token)),t("Login successful."),document.getElementById("loginEmail").value="",document.getElementById("loginPassword").value="";const a=yield g.getCurrentUser(),i=yield g.getProfile();if(a.success&&i.success&&i.profile){de(a.user);if(ue(i.profile),fe(),ve(),window.verticalNav&&window.verticalNav.updateAuthUI&&window.verticalNav.updateAuthUI(a.user),"function"==typeof window.initiateQRmanager)window.initiateQRmanager();else try{void 0!==oe&&oe.init&&oe.init(),void 0!==re&&re.init&&re.init(),void 0!==V&&V.init&&V.init()}catch(e){}Re("display"),function(){__async(this,null,function*(){const e=new URLSearchParams(window.location.search),n=e.get("redirectToWallet");if("login"===e.get("page")&&("true"==n||n)){const e=sessionStorage.getItem("pendingWalletCard");if(e){const n=yield fetch(`/api/wallet/add/${e}`,{method:"POST",credentials:"include"}),a=yield n.json();if(!a.success)throw new Error(a.message||"Failed to add card");t("Card added to your wallet! You can view it in the Wallet tab."),setTimeout(()=>{},1e3),window.open("/wallet")}else window.open("/login")}})}(),Ue("display"),T()}else n("Issue while getting current user")}else s.useGoogleOAuth?(n("This account uses Google Sign-In"),setTimeout(()=>he(),2e3)):s.emailNotVerified?(n("Please verify your email first"),sessionStorage.setItem("verificationEmail",a),setTimeout(()=>Re("emailVerification"),2e3)):n(s.message||"Login failed")}catch(a){n("Network error. Please try again.")}})}$(document).ready(function(){const e=$("#signupForm"),a=$("#signupPassword"),i=$("#createactBtn, #createActButton");a.length&&a.on("input",function(){we($(this).val())}),i.on("click",function(e){return __async(this,null,function*(){e.preventDefault();const a=$(this),i=a.html();$(".error-message").text("");const s=$("#signupName").val().trim(),o=$("#signupEmail").val().trim().toLowerCase(),r=$("#signupPassword").val(),l=$("#accountType").val();if(!s||!o||!r)return void n("Please fill in all required fields");const c=we(r);if(Object.values(c).every(e=>!0===e)){a.prop("disabled",!0),a.html('<i class="fas fa-spinner fa-spin"></i> Creating Account...');try{const e={name:s,email:o,password:r,accountType:l};if("corporate"===l)if($('[name="companyName"]').val().trim()&&$('[name="companySize"]').val()){e.companyName=$('[name="companyName"]').val()||"",e.companyDomain=$('[name="companyDomain"]').val()||"",e.companySize=$('[name="companySize"]').val()||"",e.industry=$('[name="industry"]').val()||"";const a=yield be.signup(o,r,s,e);if(a.success)if(sessionStorage.setItem("verificationEmail",o),a.redirectToVerification){if(a.codeResent)t("New verification code sent! Please check your email.");else if(a.codeExpiresIn){t(`Verification code already sent! Valid for ${Math.floor(a.codeExpiresIn/60)} more minutes.`)}else t("Account created! Please check your email for verification code.");setTimeout(()=>{$("#verificationEmail").text(o),Re("emailVerification")},1500)}else t("Account created! Please check your email for verification code."),setTimeout(()=>{$("#verificationEmail").text(o),Re("emailVerification")},1500);else a.useGoogleOAuth?(n("Gmail accounts must use Google Sign-In"),setTimeout(()=>he(),2e3)):a.redirectToLogin?(n(a.message||"Account already exists. Please login."),setTimeout(()=>Re("emailLoginPage"),2e3)):(n(a.message||"Signup failed"),a.message&&a.message.includes("email")&&$("#emailError").text(a.message))}else $('[name="companyName"]').val().trim()||$('[name="companyName"]').css("border","1px solid red"),$('[name="companySize"]').val().trim()||$('[name="companySize"]').css("border","1px solid red");else try{const a=yield be.signup(o,r,s,e);if(a.success)if(sessionStorage.setItem("verificationEmail",o),a.redirectToVerification){if(a.codeResent)t("New verification code sent! Please check your email.");else if(a.codeExpiresIn){t(`Verification code already sent! Valid for ${Math.floor(a.codeExpiresIn/60)} more minutes.`)}else t("Account created! Please check your email for verification code.");setTimeout(()=>{document.getElementById("verificationEmail").textContent=o,Re("emailVerification")},1500)}else t("Account created! Please check your email for verification code."),setTimeout(()=>{document.getElementById("verificationEmail").textContent=o,Re("emailVerification")},1500);else a.useGoogleOAuth?(n("Gmail accounts must use Google Sign-In"),setTimeout(()=>he(),2e3)):a.redirectToLogin?(n(a.message||"Account already exists. Please login."),setTimeout(()=>Re("emailLoginPage"),2e3)):(n(a.message||"Signup failed"),a.message&&a.message.includes("email")&&(document.getElementById("emailError").textContent=a.message))}catch(d){n("Network error. Please try again.")}}catch(d){n("Network error. Please try again.")}finally{a.prop("disabled",!1),a.html(i)}}else $("#passwordError").text("Please meet all password requirements")})}),e.on("submit",function(e){e.preventDefault(),i.first().trigger("click")})}),$(document).on("click","#signinbackbtn",function(){Re("login")}),$(document).on("click",".loginbutton",function(){Re("login")}),$(document).on("click","#backsignupbtn",function(){Re("signup")}),$(document).on("click","#signupbutton",function(){Re("signup")}),$(document).on("click",".forgot-link",function(){Re("forgotPassword")}),$(document).on("click","#forgotBtn",function(){return __async(this,null,function*(){const e=document.getElementById("forgotPasswordForm"),a=new FormData(e).get("email").trim().toLowerCase();try{const e=yield be.forgotPassword(a);e&&e.success?(t("Check your email."),Re("login")):(n("Error while sending reset link"),Re("login"))}catch(i){n("Error while sending reset link: "+i.message),Re("login")}})}),$(document).on("click",".toggle-password",function(){const e=$(this),t=e.data("passtype"),n=$("#"+t),a=e.find("i");"password"===n.attr("type")?(n.attr("type","text"),a.removeClass("fa-eye").addClass("fa-eye-slash")):(n.attr("type","password"),a.removeClass("fa-eye-slash").addClass("fa-eye"))}),$(document).on("click","#resetBtn",function(){return __async(this,null,function*(){try{const e=document.getElementById("confirmPassword"),a=document.getElementById("newPassword"),i=e.value.trim(),s=a.value.trim();if(i===s)if(s&&i){const e=function(e){const t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length?t.pop().split(";").shift():null}("passResetToken");if(e){const a=yield be.resetPassword(e,i);a&&a.success?(t("Password Reset Successfully"),Re("login"),document.getElementById("newPassword").value="",document.getElementById("confirmPassword").value=""):(n("Network Error"),Re("login"))}else n("Token is expired sp request again."),Re("login")}else n("Empty Values");else n("Password and confirm password are not matching")}catch(e){}})}),document.addEventListener("DOMContentLoaded",function(){return __async(this,null,function*(){try{if(document.getElementById("resetPasswordForm")){const e=document.getElementById("confirmPassword"),t=document.getElementById("newPassword");let n;if(e&&e.addEventListener("input",e=>{const t=$e(e.target.value);n=Object.values(t).every(e=>!0===e)}),t&&t.addEventListener("input",e=>{const t=$e(e.target.value);n=Object.values(t).every(e=>!0===e)}),!n)return void(document.getElementById("passwordErrornewpass").textContent="Please meet all password requirements")}}catch(e){}})}),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("emailVerificationForm");if(e){const a=document.getElementById("verificationCode");a&&(a.addEventListener("input",e=>{e.target.value=e.target.value.replace(/\D/g,"").substring(0,6)}),a.addEventListener("input",t=>{6===t.target.value.length&&setTimeout(()=>{6===a.value.length&&e.dispatchEvent(new Event("submit"))},500)})),e.addEventListener("submit",e=>__async(this,null,function*(){e.preventDefault();const a=document.getElementById("verifyBtn"),i=a.innerHTML;document.getElementById("codeError").textContent="";const s=document.getElementById("verificationCode").value.trim(),o=sessionStorage.getItem("verificationEmail");if(s&&6===s.length){if(!o)return n("Session expired. Please sign up again."),void Re("emailSignupPage");a.disabled=!0,a.innerHTML='<i class="fas fa-spinner fa-spin"></i> Verifying...';try{const e=yield be.verifyEmail(o,s);e.success?(t("Email verified successfully! Redirecting..."),sessionStorage.removeItem("verificationEmail"),e.token&&(localStorage.setItem("authToken",e.token),g.setToken(e.token)),$("#signupName").empty(),$("#signupEmail").empty(),$("#signupPassword").empty(),document.getElementById("signupName").value="",document.getElementById("signupEmail").value="",document.getElementById("signupPassword").value="",window.verticalNav&&window.verticalNav.checkAuth&&(yield window.verticalNav.checkAuth()),setTimeout(()=>{window.location.href="/?page=profile"},1e3)):(e.expired?(n("Verification code expired. Please request a new one."),document.getElementById("codeError").textContent="Code expired"):(n(e.message||"Invalid verification code"),document.getElementById("codeError").textContent=e.message||"Invalid code"),document.getElementById("verificationCode").value="",document.getElementById("verificationCode").focus())}catch(r){n("Network error. Please try again."),document.getElementById("codeError").textContent="Network error"}finally{a.disabled=!1,a.innerHTML=i}}else document.getElementById("codeError").textContent="Please enter a valid 6-digit code"}))}}),$(document).on("click","#resendverification",function(){return __async(this,null,function*(){yield function(){return __async(this,null,function*(){const e=sessionStorage.getItem("verificationEmail");if(!e)return n("Session expired. Please sign up again."),void Re("signup");try{const a=yield be.resendVerification(e);a.success?t("Verification code sent!"):n(a.message||"Failed to resend code")}catch(a){n("Network error. Please try again.")}})}()})}),$(document).on("click","#signinBtn",function(){return __async(this,null,function*(){yield Ce()})}),$(document).ready(function(){$("#loginPassword").on("keypress",function(e){return __async(this,null,function*(){13!==e.which&&13!==e.keyCode||(e.preventDefault(),yield Ce())})}),$("#signupPassword").on("keypress",function(e){return __async(this,null,function*(){13!==e.which&&13!==e.keyCode||(e.preventDefault(),$("#createActButton").trigger("click"))})})});const Se=document.createElement("style");Se.textContent="\n  @keyframes slideInRight {\n    from {\n      transform: translateX(100%);\n      opacity: 0;\n    }\n    to {\n      transform: translateX(0);\n      opacity: 1;\n    }\n  }\n\n  @keyframes slideOutRight {\n    from {\n      transform: translateX(0);\n      opacity: 1;\n    }\n    to {\n      transform: translateX(100%);\n      opacity: 0;\n    }\n  }\n",document.head.appendChild(Se);const Ee=Object.freeze(Object.defineProperty({__proto__:null,get currentUser(){return le},getCurrentUser:pe,getUserProfile:me,getUserStatus:function(){return __async(this,null,function*(){try{return yield $.ajax({url:"auth/status",method:"GET",dataType:"json"})}catch(e){}})},loginWithGoogle:he,logout:ge,setCurrentUser:de,setUserProfile:ue,signupWithGoogle:ye,updateAuthUI:fe,updateAuthUImobilebuttons:ve,get userProfile(){return ce}},Symbol.toStringTag,{value:"Module"}));const xe=new class{constructor(){this.cache=new Map,this.cacheTimestamps=new Map,this.defaultTTL=3e5}set(e,t,n=this.defaultTTL){this.cache.set(e,t),this.cacheTimestamps.set(e,{timestamp:Date.now(),ttl:n})}get(e){if(!this.cache.has(e))return null;const t=this.cacheTimestamps.get(e);return Date.now()-t.timestamp>t.ttl?(this.delete(e),null):this.cache.get(e)}has(e){return null!==this.get(e)}delete(e){this.cache.delete(e),this.cacheTimestamps.delete(e)}clear(){this.cache.clear(),this.cacheTimestamps.clear()}clearByPattern(e){const t=new RegExp(e),n=[];for(const a of this.cache.keys())t.test(a)&&n.push(a);n.forEach(e=>this.delete(e))}getStats(){const e={totalEntries:this.cache.size,entries:[]};for(const[t,n]of this.cacheTimestamps.entries()){const a=Date.now()-n.timestamp,i=n.ttl-a;e.entries.push({key:t,age:Math.round(a/1e3)+"s",remaining:Math.round(i/1e3)+"s",expired:i<=0})}return e}printStats(){this.getStats().entries.length}};"undefined"!=typeof window&&(window.cacheManager=xe);const ke=new class{constructor(){this.currentQRData=null,this.profileId=null,this.isLoading=!1}showModal(e){return __async(this,null,function*(){try{if(!e)return void n("Invalid QR code ID");this.isLoading=!0,this.renderLoadingModal();const t=yield this.loadQRAnalytics(e);this.currentQRData={qrCodeId:e,analytics:t.analytics||t,history:t.history||t.scanHistory||[],summary:t.summary||{}},this.renderModal(),this.isLoading=!1}catch(t){n("Failed to load QR analytics"),this.hideModal(),this.isLoading=!1}})}loadQRAnalytics(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/qrana/analytics?qrCodeId=${e}&days=30`,{method:"GET",credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=yield t.json();if(n.success)return n;throw new Error(n.message||"Failed to load analytics")}catch(t){throw t}})}renderLoadingModal(){this.removeExistingModal(),document.body.insertAdjacentHTML("beforeend",'\n            <div id="qrAnalyticsModal" class="qr-analytics-modal">\n                <div class="qr-analytics-modal-content loading">\n                    <div class="modal-loading">\n                        <div class="loading-spinner"></div>\n                        <h3>Loading QR Analytics...</h3>\n                        <p>Gathering detailed scan data and statistics</p>\n                    </div>\n                </div>\n            </div>\n        ');document.getElementById("qrAnalyticsModal").style.display="block",this.setupModalEventListeners()}renderModal(){var e;if(!this.currentQRData)return void this.hideModal();const{qrCodeId:t,analytics:n,history:a,summary:i}=this.currentQRData,s=(null==(e=n.analytics)?void 0:e[0])||n[0]||n||{},o=a.history||a||[],r=i||n.summary||{},l=`\n            <div id="qrAnalyticsModal" class="qr-analytics-modal">\n                <div class="qr-analytics-modal-content">\n                    ${this.renderModalHeader(s)}\n                    ${this.renderAnalyticsStats(s,r)}\n                    ${this.renderScanChart(s)}\n                    ${this.renderScanHistory(o)}\n                    ${this.renderModalActions(t)}\n                </div>\n            </div>\n        `;this.removeExistingModal(),document.body.insertAdjacentHTML("beforeend",l);document.getElementById("qrAnalyticsModal").style.display="block",this.setupModalEventListeners()}renderModalHeader(e){var t;return`\n            <div class="qr-modal-header">\n                <div class="qr-modal-title">\n                    <i class="fas fa-qrcode"></i>\n                    <div>\n                        <h2>${(null==(t=e._id)?void 0:t.qrCodeName)||"Custom QR Code"}</h2>\n                        <p class="qr-modal-subtitle">Detailed Analytics & Scan History</p>\n                    </div>\n                </div>\n                <button class="qr-modal-close" id="qrModalClose">\n                    <i class="fas fa-times"></i>\n                </button>\n            </div>\n        `}renderAnalyticsStats(e,t){const n=e.totalScans||0,a=e.uniqueUsers||0,i=e.dailyScans||[],s=i.length>0?Math.round(n/Math.max(1,i.length)):0,o=i.reduce((e,t)=>t.scans>((null==e?void 0:e.scans)||0)?t:e,null);return`\n            <div class="qr-analytics-stats">\n                <div class="stats-grid">\n                    <div class="stat-card primary">\n                        <div class="stat-icon-qrana">\n                            <i class="fas fa-eye"></i>\n                        </div>\n                        <div class="stat-content">\n                            <div class="stat-number">${n}</div>\n                            <div class="stat-label">Total Scans</div>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card secondary">\n                        <div class="stat-icon-qrana">\n                            <i class="fas fa-users"></i>\n                        </div>\n                        <div class="stat-content">\n                            <div class="stat-number">${a}</div>\n                            <div class="stat-label">Unique Visitors</div>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card accent">\n                        <div class="stat-icon-qrana">\n                            <i class="fas fa-chart-line"></i>\n                        </div>\n                        <div class="stat-content">\n                            <div class="stat-number">${s}</div>\n                            <div class="stat-label">Avg. Daily Scans</div>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card highlight">\n                        <div class="stat-icon-qrana">\n                            <i class="fas fa-calendar-day"></i>\n                        </div>\n                        <div class="stat-content">\n                            <div class="stat-number">${(null==o?void 0:o.scans)||0}</div>\n                            <div class="stat-label">Peak Day Scans</div>\n                            ${o?`<div class="stat-meta">${o.date}</div>`:""}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}renderScanChart(e){const t=e.dailyScans||[];if(0===t.length)return'\n                <div class="qr-scan-chart">\n                    <h3><i class="fas fa-chart-area"></i> Scan Activity</h3>\n                    <div class="no-chart-data">\n                        <i class="fas fa-chart-line"></i>\n                        <p>No scan data available for chart visualization</p>\n                    </div>\n                </div>\n            ';const n=Math.max(...t.map(e=>e.scans));return`\n            <div class="qr-scan-chart">\n                <h3><i class="fas fa-chart-area"></i> Scan Activity (Last 14 Days)</h3>\n                <div class="chart-container">\n                    <div class="chart-bars">\n                        ${t.slice(-14).map(e=>{const t=n>0?e.scans/n*100:0,a=new Date(e.date),i=a.getMonth()+1+"/"+a.getDate();return`\n                <div class="chart-bar-wrapper" title="${e.scans} scans on ${e.date}">\n                    <div class="chart-bar" style="height: ${t}%">\n                        <div class="bar-value">${e.scans}</div>\n                    </div>\n                    <div class="chart-label">${i}</div>\n                </div>\n            `}).join("")}\n                    </div>\n                </div>\n            </div>\n        `}renderScanHistory(e){const t=Array.isArray(e)?e:(null==e?void 0:e.history)||(null==e?void 0:e.scanHistory)||[];if(!t||0===t.length)return'\n                <div class="qr-scan-history">\n                    <h3><i class="fas fa-history"></i> Recent Scans</h3>\n                    <div class="no-history-data">\n                        <i class="fas fa-calendar-times"></i>\n                        <p>No recent scan history available</p>\n                    </div>\n                </div>\n            ';return`\n            <div class="qr-scan-history">\n                <h3><i class="fas fa-history"></i> Recent Scans</h3>\n                <div class="history-table-wrapper">\n                    <table class="history-table">\n                        <thead>\n                            <tr>\n                                <th>Time</th>\n                                <th>Location</th>\n                                <th>Device</th>\n                                <th>IP Address</th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            ${t.slice(0,10).map(e=>{const t=new Date(e.createdAt||e.timestamp),n=e.location?`${e.location.city||"Unknown"}, ${e.location.country||"Unknown"}`:"Unknown Location",a=this.parseDeviceInfo(e.device);return`\n                <tr class="history-row">\n                    <td class="scan-time">\n                        <div class="time-info">\n                            <span class="date">${t.toLocaleDateString()}</span>\n                            <span class="time">${t.toLocaleTimeString()}</span>\n                        </div>\n                    </td>\n                    <td class="scan-location">\n                        <i class="fas fa-map-marker-alt"></i>\n                        ${n}\n                    </td>\n                    <td class="scan-device">\n                        <i class="fas fa-${a.icon}"></i>\n                        ${a.name}\n                    </td>\n                    <td class="scan-ip">\n                        <code>${e.ip||"Unknown"}</code>\n                    </td>\n                </tr>\n            `}).join("")}\n                        </tbody>\n                    </table>\n                </div>\n            </div>\n        `}renderModalActions(e){return`\n            <div class="qr-modal-actions">\n                <button class="qr-action-btn secondary" id="qrExportData" data-qr-id="${e}">\n                    <i class="fas fa-download"></i> Export Data\n                </button>\n                <button class="qr-action-btn primary" id="qrRefreshData" data-qr-id="${e}">\n                    <i class="fas fa-sync-alt"></i> Refresh\n                </button>\n            </div>\n        `}parseDeviceInfo(e){return e?e.isMobile?{name:"Mobile Device",icon:"mobile-alt"}:e.isTablet?{name:"Tablet",icon:"tablet-alt"}:{name:"Desktop",icon:"desktop"}:{name:"Unknown Device",icon:"desktop"}}setupModalEventListeners(){const e=document.getElementById("qrModalClose"),t=document.getElementById("qrAnalyticsModal");e&&e.addEventListener("click",()=>this.hideModal()),t&&t.addEventListener("click",e=>{e.target===t&&this.hideModal()});const n=document.getElementById("qrExportData");n&&n.addEventListener("click",()=>this.exportAnalyticsData());const a=document.getElementById("qrRefreshData");a&&a.addEventListener("click",()=>{const e=a.dataset.qrId;this.showModal(e)}),document.addEventListener("keydown",e=>{"Escape"===e.key&&document.getElementById("qrAnalyticsModal")&&this.hideModal()})}exportAnalyticsData(){return __async(this,null,function*(){var e,a;try{if(!this.currentQRData)return void n("No data to export");const{analytics:i,history:s,summary:o}=this.currentQRData,r=(null==(e=i.analytics)?void 0:e[0])||i[0]||i||{},l=Array.isArray(s)?s:(null==s?void 0:s.history)||(null==s?void 0:s.scanHistory)||[],c=(o||i.summary,(null==(a=r._id)?void 0:a.qrCodeName)||r.qrCodeName||"Custom QR Code");let d="QR Code Analytics Export\n\n";d+=`QR Code Name,${c}\n`,d+=`Total Scans,${r.totalScans||0}\n`,d+=`Unique Users,${r.uniqueUsers||0}\n`,d+=`Export Date,${(new Date).toLocaleString()}\n\n`,d+="Daily Scan History\n",d+="Date,Scans,Unique Users\n",r.dailyScans&&r.dailyScans.forEach(e=>{d+=`${e.date},${e.scans},${e.uniqueUsers||0}\n`}),d+="\nRecent Scan Details\n",d+="Date,Time,Location,Device,IP Address\n",l&&l.forEach(e=>{const t=new Date(e.createdAt||e.timestamp),n=e.location?`"${e.location.city||"Unknown"}, ${e.location.country||"Unknown"}"`:"Unknown Location",a=this.parseDeviceInfo(e.device);d+=`${t.toLocaleDateString()},${t.toLocaleTimeString()},"${n}","${a.name}",${e.ip||"Unknown"}\n`});const u=new Blob([d],{type:"text/csv"}),p=window.URL.createObjectURL(u),m=document.createElement("a");m.href=p,m.download=`qr-analytics-${c.replace(/[^a-z0-9]/gi,"-")}-${Date.now()}.csv`,m.click(),window.URL.revokeObjectURL(p),t("Analytics data exported successfully")}catch(i){n("Failed to export analytics data")}})}hideModal(){this.removeExistingModal(),this.currentQRData=null}removeExistingModal(){const e=document.getElementById("qrAnalyticsModal");e&&e.remove()}};"undefined"!=typeof window&&(window.qrAnalyticsModal=ke);class qe{constructor(){this.analytics=null,this.isLoading=!1,this.eventListenersAttached=!1,this.boundClickHandler=null,this.init()}init(){this.setupEventListeners()}loadAnalytics(){return __async(this,null,function*(){try{const e=yield g.getQRAnalytics();if(!e.success)throw new Error(e.message||"Failed to load analytics");this.analytics=e.analytics,this.renderAnalytics()}catch(e){n("Failed to load QR analytics: "+e.message)}})}renderAnalytics(){const e=document.getElementById("qrAnalyticsContainer");if(!e)return;const{totalCustomQRs:t,totalScans:n,qrCodeStats:a,period:i}=this.analytics,s=`\n            <div class="analytics-header">\n                <h3><i class="fas fa-chart-pie"></i> <span>QR Code Analytics</span></h3>\n                <span class="analytics-period">${i}</span>\n            </div>\n            \n            <div class="analytics-summary">\n                <div class="stat-card">\n                    <div class="stat-number">${t}</div>\n                    <div class="stat-label">Custom QR Codes</div>\n                </div>\n                <div class="stat-card">\n                    <div class="stat-number">${n}</div>\n                    <div class="stat-label">Total Scans</div>\n                </div>\n                <div class="stat-card">\n                    <div class="stat-number">${this.calculateAvgScans(a)}</div>\n                    <div class="stat-label">Avg Scans per QR</div>\n                </div>\n            </div>\n\n            <div class="qr-codes-table">\n                <table>\n                    <thead>\n                        <tr>\n                            <th>QR Code Name</th>\n                             <th>QRCodeID</th>\n                            <th>Destination URL</th>\n                            <th>Total Scans</th>\n                           \n                            \n                            <th>Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        ${this.renderQRCodeRows(a)}\n                    </tbody>\n                </table>\n            </div>\n        `;e.innerHTML=s,this.attachTableEventListeners()}renderQRCodeRows(e){return e&&0!==e.length?e.map(e=>`\n            <tr>\n                <td class="qr-name">\n                    <div>${e.qrCodeName||"Unnamed QR"}</div>\n                </td>\n                 <td class="unique-users">\n                    ${e.qrCodeId}\n                </td>\n                <td class="qr-url">\n                    <a href="${e.originalUrl}" target="_blank" rel="noopener">\n                        ${this.truncateUrl(e.originalUrl)}\n                    </a>\n                </td>\n                <td class="scan-count">\n                    <span class="badge scan-badge">${e.totalScans}</span>\n                </td>\n               \n               \n                <td class="actions">\n                    <button class="btn-sm btn-primary qr-details-btn" \n                            data-qr-id="${e.qrCodeId}"\n                            title="View QR Details">\n                        üìà Details\n                    </button>\n                </td>\n            </tr>\n        `).join(""):'\n                <tr>\n                    <td colspan="6" class="no-data">\n                        No QR code scans in the last 30 days\n                    </td>\n                </tr>\n            '}calculateAvgScans(e){if(!e||0===e.length)return 0;const t=e.reduce((e,t)=>e+t.totalScans,0);return Math.round(t/e.length)}truncateUrl(e,t=40){return e?e.length>t?e.substring(0,t)+"...":e:""}formatDate(e){const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}viewDetails(e){return __async(this,null,function*(){try{if(!e||!/^[a-f0-9]{24}$/.test(e))throw new Error("Invalid QR code ID format");yield ke.showModal(e)}catch(t){n("Failed to load QR code details")}})}setupEventListeners(){if(this.eventListenersAttached)return;const e=document.getElementById("refreshQRAnalytics");e&&(e.removeEventListener("click",this.handleRefresh),e.addEventListener("click",()=>{this.loadAnalytics()})),this.eventListenersAttached=!0,document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.getElementById("qrAnalyticsModal");e&&"block"===e.style.display&&this.closeModal()}})}attachTableEventListeners(){const e=document.getElementById("qrAnalyticsContainer");e&&(this.boundClickHandler&&e.removeEventListener("click",this.boundClickHandler),this.boundClickHandler=e=>__async(this,null,function*(){if(e.target.closest(".qr-details-btn")){e.preventDefault(),e.stopPropagation();const t=e.target.closest(".qr-details-btn");if(t.disabled)return;const a=t.dataset.qrId;if(a){const e=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...',t.disabled=!0;try{yield this.viewDetails(a)}finally{t.innerHTML=e,t.disabled=!1}}else n("Unable to load QR details - missing ID")}}),e.addEventListener("click",this.boundClickHandler))}destroy(){const e=document.getElementById("qrAnalyticsContainer");e&&this.boundClickHandler&&e.removeEventListener("click",this.boundClickHandler),this.eventListenersAttached=!1,this.boundClickHandler=null}exportQRData(e){return __async(this,null,function*(){try{t("QR data export feature coming soon")}catch(e){n("Failed to export QR data")}})}closeModal(){const e=document.getElementById("qrAnalyticsModal");e&&(e.style.display="none")}exportAnalytics(){return __async(this,null,function*(){try{const e=this.generateCSVReport(),n=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download=`qr-analytics-${(new Date).toISOString().split("T")[0]}.csv`,i.click(),window.URL.revokeObjectURL(a),t("üìÅ Analytics exported successfully")}catch(e){n("Failed to export analytics")}})}generateCSVReport(){const e=this.analytics.qrCodeStats.map(e=>[e.qrCodeName||"Unnamed",e.originalUrl||"",e.totalScans,e.uniqueUsers,this.formatDate(e.lastScan)]);return[`QR Analytics Overview - ${(new Date).toLocaleDateString()}`,"",`Summary: ${this.analytics.totalCustomQRs} QR Codes, ${this.analytics.totalScans} Total Scans`,"",["QR Code Name","Destination URL","Total Scans","Unique Users","Last Scan"].join(","),...e.map(e=>e.map(e=>`"${e}"`).join(","))].join("\n")}}window.qrAnalytics=new qe;const Ie=document.createElement("style");Ie.textContent="\n.analytics-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    padding-bottom: 10px;\n    border-bottom: 1px solid #eee;\n}\n\n.analytics-period {\n    font-size: 14px;\n    color: #666;\n    background: #f5f5f5;\n    padding: 4px 8px;\n    border-radius: 4px;\n    display:none;\n}\n\n.analytics-summary {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n    gap: 15px;\n    margin-bottom: 25px;\n}\n\n.stat-card {\n    background: white;\n   \n    padding: 20px;\n    border-radius: 8px;\n    text-align: center;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n}\n\n.stat-number {\n    font-size: 2rem;\n    font-weight: bold;\n    margin-bottom: 5px;\n}\n\n.stat-label {\n    font-size: 0.9rem;\n    opacity: 0.9;\n}\n\n.qr-codes-table {\n    background: white;\n    border-radius: 8px;\n    overflow: hidden;\n    box-shadow: 0 2px 10px rgba(0,0,0,0.1);\n}\n\n.qr-codes-table table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.qr-codes-table th {\n    background: #f8f9fa;\n    padding: 15px 12px;\n    text-align: left;\n    font-weight: 600;\n    color: #333;\n    border-bottom: 1px solid #dee2e6;\n}\n\n.qr-codes-table td {\n    padding: 12px;\n    border-bottom: 1px solid #f1f3f4;\n    color: #6b6b6b;\n    font-size: 0.9rem;\n    font-weight: 600;\n}\n\n.qr-codes-table tr:hover {\n    background: #f8f9fa;\n}\n\n.qr-name strong {\n    color: #333;\n}\n\n.qr-url a {\n    color: #1a73e8;\n    text-decoration: none;\n}\n\n.qr-url a:hover {\n    text-decoration: underline;\n}\n\n.scan-badge {\n    background: #28a745;\n    color: white;\n    padding: 4px 8px;\n    border-radius: 12px;\n    font-size: 0.8rem;\n    font-weight: 600;\n}\n\n.btn-sm {\n    padding: 4px 8px;\n    font-size: 0.8rem;\n    border-radius: 4px;\n    border: none;\n    cursor: pointer;\n}\n\n.btn-primary {\n    background: #1a73e8;\n    color: white;\n}\n\n.btn-primary:hover {\n    background: #1557b0;\n}\n/* QR-specific button styles */\n.qr-details-btn {\n    background: linear-gradient(135deg, #1a73e8 0%, #1557b0 100%);\n    color: white;\n    border: none;\n}\n\n.qr-details-btn:hover {\n    background: linear-gradient(135deg, #1557b0 0%, #0d47a1 100%);\n    box-shadow: 0 4px 8px rgba(26, 115, 232, 0.3);\n}\n\n.qr-export-btn {\n    background: linear-gradient(135deg, #28a745 0%, #218838 100%);\n    color: white;\n    border: none;\n}\n\n.qr-export-btn:hover {\n    background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);\n    box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);\n}\n\n\n.qr-details-btn {\n    position: relative;\n    overflow: hidden;\n}\n.qr-details-btn:disabled::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(255, 255, 255, 0.1);\n}\n\n\n.no-data {\n    text-align: center;\n    color: #666;\n    font-style: italic;\n    padding: 30px;\n}\n.btn-sm {\n        padding: 6px 10px;\n        font-size: 0.75rem;\n    }\n@media (max-width: 768px) {\n    .qr-codes-table {\n        overflow-x: auto;\n    }\n    \n    .analytics-summary {\n        grid-template-columns: 1fr;\n    }\n}\n",document.head.appendChild(Ie);const Pe=new class{constructor(){this.currentSubmissions=[],this.currentAnalytics=null,this.currentStatus="all",this.isInitialized=!1}init(){if(!this.isInitialized)try{this.setupEventListeners(),this.loadFormAnalytics(),this.isInitialized=!0}catch(e){}}setupEventListeners(){const e=document.getElementById("formAnalyticsStatusFilter");e&&e.addEventListener("change",e=>{this.loadSubmissions(e.target.value)});const t=document.getElementById("formAnalyticsExportBtn");t&&t.addEventListener("click",()=>this.exportSubmissions());const n=document.getElementById("formAnalyticsRefreshBtn");n&&n.addEventListener("click",()=>this.loadFormAnalytics());const a=document.getElementById("formAnalyticsCloseModal");a&&a.addEventListener("click",()=>this.closeSubmissionModal());const i=document.getElementById("formAnalyticsSubmissionsTable");i&&i.addEventListener("click",e=>{if(e.target.closest(".view-submission-btn")){e.preventDefault();const t=e.target.closest(".view-submission-btn"),n=t.dataset.submissionId;t.dataset.statusDetails,n&&this.viewSubmission(n)}if(e.target.closest(".status-change-btn")){e.preventDefault();const t=e.target.closest(".status-change-btn"),n=t.dataset.submissionId,a=t.dataset.status;n&&a&&this.changeSubmissionStatus(n,a)}});const s=document.getElementById("formAnalyticsModal");s&&s.addEventListener("click",e=>{e.target===s&&this.closeSubmissionModal()}),document.addEventListener("keydown",e=>{if("Escape"===e.key){const e=document.getElementById("formAnalyticsModal");e&&"block"===e.style.display&&this.closeSubmissionModal()}})}loadFormAnalytics(){return __async(this,null,function*(){try{yield this.loadAnalyticsStats(),yield this.loadSubmissions(this.currentStatus),t("Form analytics updated")}catch(e){n("Failed to load form analytics")}})}loadAnalyticsStats(){return __async(this,null,function*(){try{const e=yield fetch("/api/forms/config",{method:"GET",credentials:"include"}),t=yield e.json();t.success&&t.formConfig&&(this.currentAnalytics=t.formConfig.analytics,this.updateAnalyticsDisplay(t.formConfig.analytics))}catch(e){}})}loadSubmissions(e="all"){return __async(this,null,function*(){try{this.currentStatus=e;const t=yield fetch(`/api/forms/submissions?status=${e}`,{method:"GET",credentials:"include"}),n=yield t.json();n.success?(this.currentSubmissions=n.submissions||[],this.renderSubmissionsTable(n.submissions),this.updateSubmissionCount(n.submissions,e)):(this.renderEmptySubmissions(),this.updateSubmissionCount([],e))}catch(t){this.renderEmptySubmissions(),this.updateSubmissionCount([],e)}})}renderSubmissionsTable(e){const t=document.getElementById("formAnalyticsSubmissionsTable");if(!t)return;if(!e||0===e.length)return void this.renderEmptySubmissions();let n='\n            <div class="form-analytics-table-wrapper">\n                <table class="form-analytics-table">\n                    <thead>\n                        <tr>\n                            <th>Date</th>\n                            <th>Contact Info</th>\n                            <th>Custom Questions</th>\n                            <th>Source</th>\n                            <th>Status</th>\n                            <th>Actions</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n        ';e.forEach(e=>{var t;const a=this.extractSubmissionData(e),i=this.extractCustomQuestions(e),s=new Date(e.submittedAt).toLocaleDateString(),o=(null==(t=e.context)?void 0:t.triggerType)||"manual";n+=`\n                <tr class="submission-row" data-submission-id="${e._id}">\n                    <td class="submission-date">${s}</td>\n                    <td class="submission-contact">\n                        <div class="contact-info">\n                            <strong>${a.name||"N/A"}</strong>\n                            <div class="contact-details">\n                                <div> ${a.email?`üìß ${a.email}`:""}</div>\n                                <div> ${a.phone?`üì± ${a.phone}`:""}</div>\n                            </div>\n                        </div>\n                    </td>\n                    <td class="submission-custom">\n                        <div class="custom-responses">\n                            ${i.length>0?i.slice(0,2).map(e=>`<div class="custom-item">\n                                        <span class="custom-question">${e.question.substring(0,30)}${e.question.length>30?"...":""}</span>\n                                        <span class="custom-answer">${e.response}</span>\n                                    </div>`).join(""):'<span class="no-custom">No custom questions</span>'}\n                            ${i.length>2?`<div class="custom-more">+${i.length-2} more</div>`:""}\n                        </div>\n                    </td>\n                    <td class="submission-source">\n                        <span class="source-badge ${o}">${this.formatSource(o)}</span>\n                    </td>\n                    <td class="submission-status">\n                        <span class="status-badge ${e.status}">${e.status}</span>\n                    </td>\n                    <td class="submission-actions">\n                        <button class="action-btn view-submission-btn" \n                                data-submission-id="${e._id}" \n                                title="View Details" data-status-details="read">\n                            <i class="fas fa-eye"></i>\n                        </button>\n                    </td>\n                </tr>\n            `}),n+="\n                    </tbody>\n                </table>\n            </div>\n        ",t.innerHTML=n}renderEmptySubmissions(){const e=document.getElementById("formAnalyticsSubmissionsTable");e&&(e.innerHTML='\n                <div class="empty-submissions">\n                    <i class="fas fa-inbox"></i>\n                    <h3>No submissions yet</h3>\n                    <p>Submissions will appear here when visitors fill out your form</p>\n                </div>\n            ')}updateSubmissionCount(e,t){const n=document.getElementById("formAnalyticsSubmissionCount");if(n){const a=e?e.length:0,i="all"===t?"Total":t.charAt(0).toUpperCase()+t.slice(1);0===a?(n.textContent=`No ${"all"===t?"":t+" "}submissions found`,n.className="no-submissions"):1===a?(n.textContent=`1 ${i} submission`,n.className="has-submissions"):(n.textContent=`${a} ${i} submissions`,n.className="has-submissions")}}extractSubmissionData(e){const t=e.submittedData||{};return{name:t.get?t.get("name"):t.name||"",email:t.get?t.get("email"):t.email||"",phone:t.get?t.get("phone"):t.phone||"",notes:t.get?t.get("notes"):t.notes||""}}extractCustomQuestions(e){if(e.customQuestionResponses&&e.customQuestionResponses.length>0)return e.customQuestionResponses.map(e=>({question:e.question,response:e.response,type:e.answerType}));const t=e.submittedData||{},n=[];return Object.keys(t).forEach(e=>{if("string"==typeof e&&(e.includes("?")||e.startsWith("custom_"))){const a=t.get?t.get(e):t[e];n.push({question:e,response:a,type:"text"})}}),n}formatSource(e){return{on_load:"Page Load",on_click:"Button Click",on_scroll:"Scroll",on_exit:"Exit Intent",manual:"Manual"}[e]||e}updateSubmissionStatusInTable(e,t){try{const n=this.currentSubmissions.find(t=>t._id===e);if(n&&n.status!==t){n.status=t,n.readAt=new Date;const a=document.querySelector(`tr[data-submission-id="${e}"] .status-badge`);a&&(a.className=`status-badge ${t}`,a.textContent=t)}}catch(n){}}viewSubmission(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/forms/submissions/${e}`,{method:"GET",credentials:"include"});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const a=yield t.json();a.success&&a.submission?(this.showSubmissionModal(a.submission),this.updateSubmissionStatusInTable(e,"read")):n(a.message||"Submission not found")}catch(t){n("Failed to load submission details")}})}showSubmissionModal(e){var t,n;const a=this.extractSubmissionData(e),i=this.extractCustomQuestions(e);let s=`\n            <div class="submission-details">\n                <div class="submission-header">\n                    <h3>Submission Details</h3>\n                    <p class="submission-date">Submitted: ${new Date(e.submittedAt).toLocaleString()}</p>\n                </div>\n                \n                <div class="submission-contact-info">\n                    <h4><i class="fas fa-user"></i> Contact Information</h4>\n                    <div class="contact-grid">\n                        ${a.name?`<div class="contact-item"><strong>Name:</strong> ${a.name}</div>`:""}\n                        ${a.email?`<div class="contact-item"><strong>Email:</strong> ${a.email}</div>`:""}\n                        ${a.phone?`<div class="contact-item"><strong>Phone:</strong> ${a.phone}</div>`:""}\n                        ${a.notes?`<div class="contact-item"><strong>Message:</strong> ${a.notes}</div>`:""}\n                    </div>\n                </div>\n        `;i.length>0&&(s+=`\n                <div class="submission-custom-questions">\n                    <h4><i class="fas fa-question-circle"></i> Custom Questions</h4>\n                    <div class="custom-responses-grid">\n                        ${i.map(e=>`\n                            <div class="custom-response-item">\n                                <div class="custom-question-text">${e.question}</div>\n                                <div class="custom-answer-text">${e.response}</div>\n                                <div class="custom-answer-type">${e.type}</div>\n                            </div>\n                        `).join("")}\n                    </div>\n                </div>\n            `),e.visitorInfo&&(s+=`\n                <div class="submission-visitor-info">\n                    <h4><i class="fas fa-chart-line"></i> Visitor Information</h4>\n                    <div class="visitor-grid">\n                        ${e.visitorInfo.location?`<div class="visitor-item"><strong>Location:</strong> ${e.visitorInfo.location.city||""}, ${e.visitorInfo.location.country||""}</div>`:""}\n                        ${(null==(t=e.context)?void 0:t.triggerType)?`<div class="visitor-item"><strong>Source:</strong> ${this.formatSource(e.context.triggerType)}</div>`:""}\n                        ${(null==(n=e.context)?void 0:n.timeOnPageSeconds)?`<div class="visitor-item"><strong>Time on Page:</strong> ${Math.round(e.context.timeOnPageSeconds)}s</div>`:""}\n                    </div>\n                </div>\n            `),s+="</div>";const o=document.getElementById("formAnalyticsModalContent");if(o){o.innerHTML=s;const e=document.getElementById("formAnalyticsModal");e&&(e.style.display="block")}}closeSubmissionModal(){const e=document.getElementById("formAnalyticsModal");e&&(e.style.display="none")}changeSubmissionStatus(e,a){return __async(this,null,function*(){try{const i=yield fetch(`/api/forms/submissions/${e}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({status:a})});(yield i.json()).success?(t(`Status updated to ${a}`),yield this.loadSubmissions(this.currentStatus)):n("Failed to update status")}catch(i){n("Error updating submission status")}})}exportSubmissions(){return __async(this,null,function*(){try{if(!this.currentSubmissions||0===this.currentSubmissions.length)return void n("No submissions to export");let e="Date,Name,Email,Phone,Status,Source,Location";const a=new Set;this.currentSubmissions.forEach(e=>{this.extractCustomQuestions(e).forEach(e=>{a.add(e.question)})}),a.forEach(t=>{e+=`,${this.sanitizeCSVHeader(t)}`}),e+="\n",this.currentSubmissions.forEach(t=>{var n,i,s;const o=this.extractSubmissionData(t),r=this.extractCustomQuestions(t),l={};r.forEach(e=>{l[e.question]=e.response});const c=[new Date(t.submittedAt).toLocaleDateString(),o.name||"",o.email||"",o.phone||"",t.status||"",this.formatSource((null==(n=t.context)?void 0:n.triggerType)||"manual"),(null==(s=null==(i=t.visitorInfo)?void 0:i.location)?void 0:s.city)||""];a.forEach(e=>{c.push(l[e]||"")}),e+=c.map(e=>`"${(e||"").toString().replace(/"/g,'""')}"`).join(",")+"\n"});const i=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=`form-submissions-${Date.now()}.csv`,o.click(),window.URL.revokeObjectURL(s),t("Submissions exported successfully")}catch(e){n("Failed to export submissions")}})}sanitizeCSVHeader(e){return e.replace(/[,"\n]/g,"_").substring(0,30)}updateAnalyticsDisplay(e){if(e){const t=document.getElementById("formAnalyticsViews"),n=document.getElementById("formAnalyticsSubmissions"),a=document.getElementById("formAnalyticsConversion");t&&(t.textContent=e.totalViews||0),n&&(n.textContent=e.totalSubmissions||0),a&&(a.textContent=(e.conversionRate||0)+"%")}}};"undefined"!=typeof window&&(window.formAnalytics=Pe);const Le=new class{constructor(){this.currentCredentials=[],this.usageData=null,this.selectedCredentialId=null,this.charts={}}initialize(){return __async(this,null,function*(){this.setupEventListeners(),yield this.checkAPIAccess(),yield this.loadCredentials(),yield this.loadUsageOverview(),this.renderDashboard()})}checkAPIAccess(){return __async(this,null,function*(){try{const e=pe();return e&&e.subscription&&e.subscription.status,!0}catch(e){return!1}})}loadCredentials(){return __async(this,null,function*(){try{const e=yield g.apiRequest("/api/connectiko/credentials");e.success&&(this.currentCredentials=e.data.credentials)}catch(e){}})}loadUsageOverview(){return __async(this,null,function*(){try{const e=yield g.apiRequest("/api/connectiko/usage/overview?period=30");e.success&&(this.usageData=e.data)}catch(e){}})}renderAccessDenied(){const e=document.getElementById("connectikoApiPage");e&&(e.innerHTML='\n            <div class="connectiko-access-denied">\n                <div class="access-denied-content">\n                    <div class="access-denied-icon">\n                        <i class="fas fa-lock"></i>\n                    </div>\n                    <h2>Connectiko API</h2>\n                    <p class="access-denied-subtitle">Enterprise QR Code API Suite</p>\n                    \n                    <div class="access-denied-message">\n                        <h3>üîí Premium Feature</h3>\n                        <p>The Connectiko API is available exclusively for paid subscribers. Upgrade your plan to unlock:</p>\n                        \n                        <ul class="api-features-list">\n                            <li><i class="fas fa-check"></i> RESTful QR Code Generation API</li>\n                            <li><i class="fas fa-check"></i> HMAC Authentication & Security</li>\n                            <li><i class="fas fa-check"></i> Custom QR Styling & Branding</li>\n                            <li><i class="fas fa-check"></i> Usage Analytics & Reporting</li>\n                            <li><i class="fas fa-check"></i> Webhook Integrations</li>\n                            <li><i class="fas fa-check"></i> Enterprise-grade Rate Limiting</li>\n                        </ul>\n                    </div>\n                    \n                    <div class="access-denied-actions">\n                        <button class="btn-primary upgrade-btn" data-action="upgrade">\n                            <i class="fas fa-arrow-up"></i>\n                            Upgrade to Pro\n                        </button>\n                        <button class="btn-secondary demo-btn" data-action="show-demo">\n                            <i class="fas fa-play"></i>\n                            View Demo\n                        </button>\n                    </div>\n                    \n                    <div class="pricing-preview">\n                        <div class="pricing-card featured">\n                            <h4>Starter Plan</h4>\n                            <div class="price">$9/month</div>\n                            <div class="api-limits">\n                                <span>100 requests/min</span>\n                                <span>10,000 requests/day</span>\n                            </div>\n                        </div>\n                        <div class="pricing-card featured">\n                            <h4>Pro Plan</h4>\n                            <div class="price">$29/month</div>\n                            <div class="api-limits">\n                                <span>500 requests/min</span>\n                                <span>100,000 requests/day</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ')}renderDashboard(){const e=document.getElementById("connectikoApiPage");e&&(e.innerHTML=`\n            <div class="connectiko-api-dashboard">\n                ${this.renderHeader()}\n                ${this.renderNavigation()}\n                <div class="api-content">\n                    ${this.renderOverviewTab()}\n                    ${this.renderCredentialsTab()}\n                    ${this.renderUsageTab()}\n                    ${this.renderPlaygroundTab()}\n                    ${this.renderDocumentationTab()}\n                    ${this.renderBillingTab()}\n                </div>\n            </div>\n        `,this.showTab("overview"))}renderHeader(){return'\n            <div class="api-header">\n                <div class="api-header-content">\n                    <div class="api-title-section">\n                        <div class="api-logo">\n                            <i class="fas fa-code"></i>\n                        </div>\n                        <div class="api-title-info">\n                            <h1>Connectiko API</h1>\n                            <p>Enterprise QR Code API Suite</p>\n                        </div>\n                    </div>\n                    <div class="api-header-actions">\n                        <button class="btn-secondary" data-action="show-documentation">\n                            <i class="fas fa-book"></i>\n                            Documentation\n                        </button>\n                        <button class="btn-primary" data-action="create-credential">\n                            <i class="fas fa-plus"></i>\n                            New API Key\n                        </button>\n                    </div>\n                </div>\n            </div>\n        '}renderNavigation(){return'\n            <nav class="api-navigation">\n                <div class="api-nav-tabs">\n                    <button class="api-nav-tab active" data-tab="overview">\n                        <i class="fas fa-chart-line"></i>\n                        Overview\n                    </button>\n                    <button class="api-nav-tab" data-tab="credentials">\n                        <i class="fas fa-key"></i>\n                        API Keys\n                    </button>\n                    <button class="api-nav-tab" data-tab="usage">\n                        <i class="fas fa-chart-bar"></i>\n                        Usage\n                    </button>\n                    <button class="api-nav-tab" data-tab="playground">\n                        <i class="fas fa-play"></i>\n                        Playground\n                    </button>\n                    <button class="api-nav-tab" data-tab="documentation">\n                        <i class="fas fa-book"></i>\n                        Documentation\n                    </button>\n                    <button class="api-nav-tab" data-tab="billing">\n                        <i class="fas fa-credit-card"></i>\n                        Billing\n                    </button>\n                </div>\n            </nav>\n        '}renderOverviewTab(){var e,t;return`\n            <div id="overview-tab" class="api-tab-content">\n                <h2>API Overview</h2>\n                \n                <div class="overview-stats">\n                    <div class="stat-card">\n                        <div class="stat-icon">\n                            <i class="fas fa-key"></i>\n                        </div>\n                        <div class="stat-info">\n                            <h3>${this.currentCredentials.length}</h3>\n                            <p>Active API Keys</p>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card">\n                        <div class="stat-icon">\n                            <i class="fas fa-chart-line"></i>\n                        </div>\n                        <div class="stat-info">\n                            <h3>${this.formatNumber((null==(e=this.usageData)?void 0:e.totalRequests)||0)}</h3>\n                            <p>Total Requests</p>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card">\n                        <div class="stat-icon">\n                            <i class="fas fa-clock"></i>\n                        </div>\n                        <div class="stat-info">\n                            <h3>${this.formatNumber((null==(t=this.usageData)?void 0:t.requestsToday)||0)}</h3>\n                            <p>Requests Today</p>\n                        </div>\n                    </div>\n                    \n                    <div class="stat-card">\n                        <div class="stat-icon">\n                            <i class="fas fa-tachometer-alt"></i>\n                        </div>\n                        <div class="stat-info">\n                            <h3>100/min</h3>\n                            <p>Rate Limit</p>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="overview-actions">\n                    <button class="btn-primary" data-action="create-credential">\n                        <i class="fas fa-plus"></i>\n                        Create New API Key\n                    </button>\n                    <button class="btn-secondary" data-action="test-api">\n                        <i class="fas fa-play"></i>\n                        Test API\n                    </button>\n                </div>\n            </div>\n        `}renderCredentialsTab(){return`\n            <div id="credentials-tab" class="api-tab-content hidden">\n                <h2>API Keys Management</h2>\n                \n                <div class="credentials-header">\n                    <p>Manage your API keys and their permissions. Keep your credentials secure and never share them publicly.</p>\n                    <button class="btn-primary" data-action="create-credential">\n                        <i class="fas fa-plus"></i>\n                        Create New API Key\n                    </button>\n                </div>\n                \n                <div class="credentials-list">\n                    ${this.renderCredentialsList()}\n                </div>\n            </div>\n        `}renderCredentialsList(){return 0===this.currentCredentials.length?'\n                <div class="empty-state">\n                    <div class="empty-icon">\n                        <i class="fas fa-key"></i>\n                    </div>\n                    <h3>No API Keys</h3>\n                    <p>Create your first API key to start using the Connectiko API</p>\n                    <button class="btn-primary" data-action="create-credential">\n                        <i class="fas fa-plus"></i>\n                        Create API Key\n                    </button>\n                </div>\n            ':this.currentCredentials.map(e=>`\n            <div class="credential-card">\n                <div class="credential-header">\n                    <div class="credential-info">\n                        <h3>${e.name}</h3>\n                        <div class="credential-meta">\n                            <span class="credential-env ${e.environment}">${e.environment.toUpperCase()} : </span>\n                            <span class="credential-date">Created ${this.formatDate(e.createdAt)}</span>\n                        </div>\n                    </div>\n                    <div class="credential-actions">\n                        <button class="btn-icon" data-action="copy-key" data-key="${e.apiKey}" title="Copy API Key">\n                            <i class="fas fa-copy"></i>\n                        </button>\n                       \n                        <button class="btn-icon danger" data-action="delete-credential" data-credential-id="${e._id}" title="Delete">\n                            <i class="fas fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n                <div class="credential-details">\n                    <div class="credential-key">\n                        <label>API Key: </label>\n                        <code>${e.apiKey}</code>\n                    </div>\n                    <div class="credential-permissions">\n                        <label>Permissions: </label>\n                        <div class="permission-tags">\n                            ${e.permissions.map(e=>`<span class="permission-tag">${e}</span>`).join("")}\n                        </div>\n                    </div>\n                    <div class="credential-stats">\n                        <div class="stat">\n                            <span class="stat-label">Last Used: </span>\n                            <span class="stat-value">${this.formatDate(e.lastUsedAt)||"Never"}</span>\n                        </div>\n                        <div class="stat">\n                            <span class="stat-label">Total Requests: </span>\n                            <span class="stat-value">${this.formatNumber(e.totalRequests||0)}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `).join("")}renderUsageTab(){return'\n            <div id="usage-tab" class="api-tab-content hidden">\n                <h2>Usage & Limits</h2>\n                \n                <div class="usage-overview">\n                    <div class="usage-card">\n                        <h3>Current Usage</h3>\n                        <div class="usage-meter">\n                            <div class="meter-bar">\n                                <div class="meter-fill" style="width: 45%"></div>\n                            </div>\n                            <div class="meter-labels">\n                                <span>4,500 / 10,000 requests today</span>\n                                <span>45%</span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class="usage-card">\n                        <h3>Rate Limiting</h3>\n                        <div class="rate-info">\n                            <div class="rate-stat">\n                                <span class="rate-label">Per Minute</span>\n                                <span class="rate-value">100 requests</span>\n                            </div>\n                            <div class="rate-stat">\n                                <span class="rate-label">Per Day</span>\n                                <span class="rate-value">10,000 requests</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class="usage-chart">\n                    <h3>Usage History</h3>\n                    <canvas id="usageHistoryChart"></canvas>\n                </div>\n            </div>\n        '}renderPlaygroundTab(){const e=`\n            <div id="playground-tab" class="api-tab-content hidden">\n                <h2>API Playground</h2>\n                \n                <div class="playground-container">\n                    <div class="playground-controls">\n                        <div class="form-group">\n                            <label>Endpoint</label>\n                            <select id="playgroundEndpoint" class="form-control">\n                                <option value="/api/v1/qr/read">POST /api/v1/qr/read</option>\n                                <option value="/api/v1/qr/qranalytics">POST /api/v1/qr/qranalytics</option>\n                                <option value="/api/v1/lead/formanalytics">GET /api/v1/lead/formanalytics</option>\n                            </select>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label>API Key</label>\n                            <select id="playgroundCredential" class="form-control">\n                                ${this.currentCredentials.map(e=>`<option value="${e.apiKey}">${e.name}</option>`).join("")}\n                            </select>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label>Request Body <span class="auto-update-indicator">‚Ä¢ Auto-updated</span></label>\n                            <textarea id="playgroundRequestBody" class="form-control code-editor" rows="4">{\n    "format": "png",\n    "qrcodeId": "693b4aeb9fd28c6acca37a0c"\n}</textarea>\n                            <small class="form-help">Request body updates automatically when you change the endpoint</small>\n                        </div>\n                        \n                        <div id="sample-image-div" class="sample-image-container">\n                            \x3c!-- QR images will be displayed here for /qr/read endpoint --\x3e\n                        </div>\n                        \n                        <button class="btn-primary" data-action="execute-playground">\n                            <i class="fas fa-play"></i>\n                            Execute Request\n                        </button>\n                        \n                        <button class="btn-secondary" data-action="reset-request-body" style="margin-left: 10px;">\n                            <i class="fas fa-undo"></i>\n                            Reset to Default\n                        </button>\n                    </div>\n                    \n                    <div class="playground-response">\n                        <h3>Response</h3>\n                        <div id="playgroundResponse" class="response-container">\n                            <p class="placeholder">Execute a request to see the response</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;return setTimeout(()=>{this.initializePlayground();this.updateRequestBodyForEndpoint("/api/v1/qr/read")},100),e}renderDocumentationTab(){return'\n            <div id="documentation-tab" class="api-tab-content hidden">\n                <h2>API Documentation</h2>\n                \n                <div class="documentation-content">\n                    <section class="doc-section">\n                        <h3>Authentication</h3>\n                        <p>All API requests require HMAC-SHA256 authentication using your API key and secret.</p>\n                        \n                        <h4>Required Headers</h4>\n                        <pre><code>X-Connectiko-API-Key: your_api_key\nX-Connectiko-Timestamp: unix_timestamp\nContent-Type: application/json</code></pre>\n\n\n                    </section>\n                    \n                    <section class="doc-section">\n                        <h3>QR Code Read</h3>\n                        <p>Retrieve and display a previously generated QR code.</p>\n                        \n                        <h4>Endpoint</h4>\n                        <pre><code>POST /api/v1/qr/read</code></pre>\n                        \n                        <h4>Request Body</h4>\n                        <pre><code>{\n    "qrcodeId": "693b4aeb9fd28c6acca37a0c",\n    "format": "png",\n}</code></pre>\n\n                    <h4>Response Body (404)</h4>\n                                            <pre><code>{\n    "success":false,\n    "message":"QR code not found"\n}</code></pre>\n\n                    <h4>Response Body (200)</h4>\n                                            <pre><code>{\n    "success": true,\n    "data": {\n        "qrId": "6940fd381143e6650cff7021",\n        "format": "png",\n        "size": 300,\n        "imageData": "iVBORw0KGgoAAAANSUhEUgJyzf.....",\n        "mimeType": "image/png",\n        "dataUrl": "data:image/png;base64,iVBORw0KGgoAAAANSUh.....",\n        "fileSize": 12126\n    },\n    "metadata": {\n        "requestId": "3b17f656-ff01-40a3-b773-44894cb25ddb",\n        "processingTime": "3.628917ms"\n    }\n}</code></pre>\n                    </section>\n                    \n                    <section class="doc-section">\n                        <h3>QR Analytics</h3>\n                        <p>Get analytics data for QR code usage and scans.</p>\n                        \n                        <h4>Endpoint</h4>\n                        <pre><code>POST /api/v1/qr/qranalytics</code></pre>\n                        \n                        <h4>Request Body</h4>\n                        <pre><code>{\n  "qrcodeId": "693b4aeb9fd28c6acca37a0c",\n  "timeframe": 30 // Number of days. Not greater than 90. Starting from today.\n}</code></pre>\n                    </section>\n                    \n                    <section class="doc-section">\n                        <h3>Form Analytics</h3>\n                        <p>Retrieve analytics data for form submissions and interactions.</p>\n                        \n                        <h4>Endpoint</h4>\n                        <pre><code>GET /api/v1/lead/formanalytics</code></pre>\n                        \n                        <h4>Request Body</h4>\n                        <pre><code>{\n  "formId": "693b4aeb9fd28c6acca37a0c",\n  "timeframe": 30 // Number of days. Not greater than 90. Starting from today.\n}</code></pre>\n                    </section>\n                    \n                    <section class="doc-section">\n                        <h3>Rate Limits</h3>\n                        <p>API requests are rate limited based on your subscription tier:</p>\n                        <ul>\n                            <li>Starter: 100 requests/minute, 10,000 requests/day</li>\n                            <li>Pro: 500 requests/minute, 100,000 requests/day</li>\n                            <li>Enterprise: Custom limits</li>\n                        </ul>\n                    </section>\n                </div>\n            </div>\n        '}renderBillingTab(){return'\n            <div id="billing-tab" class="api-tab-content hidden">\n                <h2>Billing & Usage</h2>\n                \n                <div class="billing-overview">\n                    <div class="current-plan">\n                        <h3>Current Plan</h3>\n                        <div class="plan-details">\n                            <div class="plan-name">Pro Plan</div>\n                            <div class="plan-price">$29/month</div>\n                            <div class="plan-features">\n                                <span>500 requests/minute</span>\n                                <span>100,000 requests/day</span>\n                            </div>\n                        </div>\n                        <button class="btn-secondary" data-action="manage-subscription">\n                            Manage Subscription\n                        </button>\n                    </div>\n                    \n                    <div class="usage-summary">\n                        <h3>This Month\'s Usage</h3>\n                        <div class="usage-stat">\n                            <span>Total Requests</span>\n                            <strong>45,230</strong>\n                        </div>\n                        <div class="usage-stat">\n                            <span>Estimated Cost</span>\n                            <strong>$29.00</strong>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}setupEventListeners(){$(document).off(".connectikoAPI"),$(document).on("click.connectikoAPI","[data-action]",e=>{const t=$(e.currentTarget).data("action"),n=$(e.currentTarget).data("credential-id"),a=$(e.currentTarget).data("key");switch("BUTTON"===e.currentTarget.tagName&&e.preventDefault(),t){case"upgrade":window.open("/upgrade","_blank");break;case"show-demo":this.showAPIDemo();break;case"show-documentation":this.showAPIDocumentation();break;case"create-credential":this.createNewCredential();break;case"copy-key":this.copyApiKey(a);break;case"regenerate-key":this.regenerateCredential(n);break;case"delete-credential":this.deleteCredential(n);break;case"test-api":this.showTab("playground");break;case"execute-playground":this.executePlaygroundRequest();break;case"reset-request-body":this.resetRequestBody();break;case"manage-subscription":window.open("/subscription","_blank");break;case"close-secret-modal":this.closeSecretModal();break;case"download-credentials":const t=$(e.currentTarget).data("api-key"),i=$(e.currentTarget).data("api-secret");this.downloadCredentials(t,i)}}),$(document).on("click.connectikoAPI",".copy-btn",e=>{e.preventDefault();const t=$(e.currentTarget).data("copy-text");t&&this.copyToClipboard(t)}),$(document).on("click.connectikoAPI",".api-nav-tab",e=>{const t=$(e.currentTarget).data("tab");this.showTab(t)}),$(document).on("click.connectikoAPI",'.modal-close, [data-action="close-modal"]',e=>{this.hideCredentialModal()}),$(document).on("submit.connectikoAPI","#credentialForm",e=>{e.preventDefault(),this.submitCredentialForm()}),this.setupPlaygroundEventHandlers()}setupPlaygroundEventHandlers(){$(document).on("change","#playgroundEndpoint",e=>{const t=e.target.value;this.updateRequestBodyForEndpoint(t)}),$(document).on("blur","#playgroundRequestBody",e=>{try{const t=e.target.value.trim();if(t){const n=JSON.parse(t),a=JSON.stringify(n,null,4);e.target.value=a}}catch(t){}})}getDefaultRequestBody(e){return{"/api/v1/qr/read":{format:"png",qrcodeId:"693b4aeb9fd28c6acca37a0c"},"/api/v1/qr/qranalytics":{qrcodeId:"693b4aeb9fd28c6acca37a0c",timeframe:30},"/api/v1/lead/formanalytics":{formId:"693b4aeb9fd28c6acca37a0c",timeframe:30}}[e]||{}}updateRequestBodyForEndpoint(e){const t=document.getElementById("playgroundRequestBody");if(t)try{const n=this.getDefaultRequestBody(e),a=JSON.stringify(n,null,4);t.value=a,t.style.borderColor="#28a745",setTimeout(()=>{t.style.borderColor=""},1e3)}catch(a){n("Failed to update request body")}}getEndpointMethod(e){return{"/api/v1/qr/read":"POST","/api/v1/qr/qranalytics":"POST","/api/v1/lead/formanalytics":"POST"}[e]||"POST"}resetRequestBody(){const e=$("#playgroundEndpoint").val();this.updateRequestBodyForEndpoint(e),t("Request body reset to default")}formatQRCodeDataAPIDisplay(e){return`\n        <div class="qr-display-container">\n            <div class="info-qr-code">\n                <h4>Generated QR Code</h4>\n                <div class="qr-meta">\n                    QR ID: ${e.qrId} | Size: ${e.size}px | Format: ${e.format.toUpperCase()}\n                </div>\n            </div>\n        </div>\n        <div class="api-qrcode-div">\n            <img src="${e.dataUrl}" \n                 alt="QR Code ${e.qrId}"\n                 style="max-width: 250px; height: auto; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 10px;">\n            <br>\n            <a href="${e.dataUrl}" \n               download="qr-code-${e.qrId}.png" \n               class="btn-primary" \n               style="display: inline-block; padding: 8px 15px; text-decoration: none; border-radius: 4px;">\n                <i class="fas fa-download"></i> Download\n            </a>\n        </div>\n    `}renderJSONViewer(e){const t=document.getElementById("jsonViewer"),n=document.getElementById("lineNumbers");if(!t||!n)return;const a=e.split("\n"),i=a.length>1e3?a.slice(0,1e3).concat(["...truncated..."]):a;t.innerHTML=i.map((e,t)=>`<div class="json-line" data-line="${t+1}">${this.formatJSONLine(e)}</div>`).join(""),n.innerHTML=i.map((e,t)=>`<span class="line-number">${t+1}</span>`).join(""),this.setupJSONEvents()}formatQRanalyticsDataAPIDisplay(){return'\n        <div class="qr-qranalyticsApiResponse-container">\n            <div class="json-toolbar">\n                <button id="copyJsonBtn" class="copy-json-btn">\n                    <i class="fas fa-copy"></i> Copy JSON\n                </button>\n            </div>\n\n            <div class="json-wrapper">\n                <div class="json-viewer" id="jsonViewer"></div>\n            </div>\n        </div>\n    '}renderQRAnalyticsJSON(e){const t=document.getElementById("jsonViewer"),n=document.getElementById("copyJsonBtn");if(t)try{const a=JSON.stringify(e,null,2),i=a.split("\n"),s=100,o=i.length>s?i.slice(0,s).concat([`... truncated (showing ${s} of ${i.length} lines)`]):i;this.originalJsonData=e,this.originalJsonString=a,t.innerHTML=o.map((e,t)=>e.includes("... truncated")?`<div class="json-line truncated-line" data-line="${t+1}">${this.escapeHTML(e)}</div>`:`<div class="json-line" data-line="${t+1}">${this.formatJSONLine(e)}</div>`).join(""),this.attachJSONEvents(n,t)}catch(a){t.innerHTML=`\n            <div class="error-message" style="color: red; padding: 20px;">\n                Failed to render JSON: ${a.message}\n            </div>\n        `}else setTimeout(()=>{this.renderQRAnalyticsJSON(e)},200)}formatJSONLine(e){const t=this.escapeHTML(e),n=t.trim();return n.endsWith("{")||n.endsWith("[")?`<span class="collapsible" data-collapsed="false">‚ñº</span> ${t}`:t}attachJSONEvents(e,t){if(e){const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",()=>{try{let e="";e=this.originalJsonString?this.originalJsonString:this.getCleanJSONText(t),navigator.clipboard.writeText(e).then(()=>{const e=n.innerHTML;n.innerHTML='<i class="fas fa-check"></i> Copied!',n.style.backgroundColor="#28a745",setTimeout(()=>{n.innerHTML=e,n.style.backgroundColor=""},2e3)}).catch(e=>{alert("Failed to copy JSON")})}catch(e){}})}t&&this.setupCollapsibleEvents(t)}getCleanJSONText(e){const t=e.cloneNode(!0);t.querySelectorAll(".collapsible").forEach(e=>e.remove());t.querySelectorAll('.json-line[style*="display: none"]').forEach(e=>e.remove());let n=t.textContent||t.innerText;return n=n.replace(/\.\.\. truncated.*$/m,""),n=n.trim(),n}setupCollapsibleEvents(e){e.removeEventListener("click",e._collapseHandler),e._collapseHandler=e=>{if(!e.target.classList.contains("collapsible"))return;e.preventDefault(),e.stopPropagation();const t=e.target,n=t.closest(".json-line"),a="true"===t.dataset.collapsed;t.textContent=a?"‚ñº":"‚ñ∂",t.dataset.collapsed=a?"false":"true";const i=n.textContent.replace(/[‚ñº‚ñ∂]\s*/,"").match(/^(\s*)/),s=i?i[1].length:0;let o=n.nextElementSibling,r=!1;for(;o&&!r;){const e=o.textContent.replace(/[‚ñº‚ñ∂]\s*/,""),t=e.match(/^(\s*)/),n=t?t[1].length:0;if(n<=s&&(e.trim().startsWith("}")||e.trim().startsWith("]")))r=!0,o.style.display=a?"block":"none";else{if(!(n>s))break;o.style.display=a?"block":"none"}o=o.nextElementSibling}},e.addEventListener("click",e._collapseHandler)}updateLineNumbers(){const e=document.getElementById("jsonViewer"),t=document.getElementById("lineNumbers");if(!e||!t)return;const n=Array.from(e.querySelectorAll(".json-line")).filter(e=>"none"!==e.style.display);t.innerHTML=n.map((e,t)=>`<span class="line-number">${t+1}</span>`).join("")}setupJSONEvents(){const e=document.getElementById("copyJsonBtn"),t=document.getElementById("jsonViewer");e&&t&&(this.attachJSONEvents(e,t),this.setupScrollSync())}escapeHTML(e){return"string"!=typeof e?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}initializeJSONViewer(e,t){const n=document.getElementById(e);n&&(n.innerHTML=this.formatQRanalyticsDataAPIDisplay(),setTimeout(()=>{this.renderQRAnalyticsJSON(t)},10))}formatFormAnalyticsDataAPIDisplay(){return'\n        <div class="qr-formanalyticsApiResponse-container">\n            <div class="json-toolbar">\n                <div class="toolbar-title">\n                    <i class="fas fa-clipboard-list"></i>\n                    Form Analytics Data\n                </div>\n                <button id="copyFormJsonBtn" class="copy-json-btn">\n                    <i class="fas fa-copy"></i> Copy JSON\n                </button>\n            </div>\n\n            <div class="json-wrapper">\n                <div class="json-viewer" id="formJsonViewer"></div>\n            </div>\n        </div>\n    '}renderFormAnalyticsJSON(e){const t=document.getElementById("formJsonViewer"),n=document.getElementById("copyFormJsonBtn");if(t)try{const a=JSON.stringify(e,null,2),i=a.split("\n"),s=100,o=i.length>s?i.slice(0,s).concat([`... truncated (showing ${s} of ${i.length} lines)`]):i;this.originalFormJsonData=e,this.originalFormJsonString=a,t.innerHTML=o.map((e,t)=>e.includes("... truncated")?`<div class="json-line truncated-line" data-line="${t+1}">${this.escapeHTML(e)}</div>`:`<div class="json-line" data-line="${t+1}">${this.formatJSONLine(e)}</div>`).join(""),this.attachFormAnalyticsEvents(n,t)}catch(a){t.innerHTML=`\n            <div class="error-message" style="color: red; padding: 20px;">\n                <i class="fas fa-exclamation-triangle"></i><br>\n                Failed to render Form Analytics JSON<br>\n                <small>${a.message}</small>\n            </div>\n        `}else setTimeout(()=>{this.renderFormAnalyticsJSON(e)},200)}attachFormAnalyticsEvents(e,t){if(e){const n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",()=>{try{let e="";e=this.originalFormJsonString?this.originalFormJsonString:this.getCleanJSONText(t),navigator.clipboard.writeText(e).then(()=>{const e=n.innerHTML;n.innerHTML='<i class="fas fa-check"></i> Copied!',n.style.backgroundColor="#28a745",setTimeout(()=>{n.innerHTML=e,n.style.backgroundColor=""},2e3)}).catch(e=>{alert("Failed to copy Form Analytics JSON")})}catch(e){}})}t&&this.setupCollapsibleEvents(t)}displayQRInSampleDiv(e,t){return __async(this,null,function*(){const n=document.getElementById("sample-image-div");if(n)try{"read"===t?n.innerHTML=this.formatQRCodeDataAPIDisplay(e):"qranalytics"===t?(n.innerHTML=this.formatQRanalyticsDataAPIDisplay(),setTimeout(()=>{this.renderQRAnalyticsJSON(e)},100)):"formanalytics"===t?(n.innerHTML=this.formatFormAnalyticsDataAPIDisplay(),setTimeout(()=>{this.renderFormAnalyticsJSON(e)},100)):n.innerHTML=`\n                <div class="error-message" style="color: orange; text-align: center; padding: 20px;">\n                    <i class="fas fa-question-circle"></i><br>\n                    Unknown API type: ${t}\n                </div>\n            `}catch(a){n.innerHTML=`\n            <div class="error-message" style="color: red; text-align: center; padding: 20px;">\n                <i class="fas fa-exclamation-triangle"></i><br>\n                Failed to display ${t} response<br>\n                <small>${a.message}</small>\n            </div>\n        `}})}generateHMACSignature(e,t,n){return __async(this,null,function*(){const a=n.toString()+t,i=(new TextEncoder).encode(e),s=yield crypto.subtle.importKey("raw",i,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),o=yield crypto.subtle.sign("HMAC",s,(new TextEncoder).encode(a));return Array.from(new Uint8Array(o)).map(e=>e.toString(16).padStart(2,"0")).join("")})}showTab(e){$(".api-nav-tab").removeClass("active"),$(`.api-nav-tab[data-tab="${e}"]`).addClass("active"),$(".api-tab-content").addClass("hidden"),$(`#${e}-tab`).removeClass("hidden"),this.loadTabData(e)}loadTabData(e){return __async(this,null,function*(){switch(e){case"overview":yield this.loadUsageOverview(),this.renderUsageCharts();break;case"usage":yield this.loadDetailedUsage();break;case"playground":this.initializePlayground()}})}showAPIDemo(){this.showTab("playground"),t("API demo loaded in playground")}showAPIDocumentation(){this.showTab("documentation")}createNewCredential(){this.showCreateCredentialModal()}copyApiKey(e){return __async(this,null,function*(){try{yield navigator.clipboard.writeText(e),t("API key copied to clipboard")}catch(a){n("Failed to copy API key")}})}regenerateCredential(e){return __async(this,null,function*(){if(confirm("Are you sure you want to regenerate this API key? The old key will be immediately invalidated."))try{S("Regenerating API key...");const n=yield g.apiRequest(`/api/connectiko/credentials/${e}/regenerate`,{method:"POST"});if(!n.success)throw new Error(n.message);t("API key regenerated successfully"),this.showSecretDisplay(n.data),yield this.loadCredentials(),this.refreshCredentialsList()}catch(a){n(a.message||"Failed to regenerate API key")}finally{E()}})}deleteCredential(e){return __async(this,null,function*(){if(confirm("Are you sure you want to delete this API key? This action cannot be undone."))try{S("Deleting API key...");const n=yield g.apiRequest(`/api/connectiko/credentials/${e}`,{method:"DELETE"});if(!n.success)throw new Error(n.message);t("API key deleted successfully"),yield this.loadCredentials(),this.refreshCredentialsList()}catch(a){n(a.message||"Failed to delete API key")}finally{E()}})}buildRequestBody(e,t){if(e.includes("read")){return{endpointName:"read",apireqbody:JSON.stringify({qrcodeId:t.qrcodeId,format:t.format,size:300})}}if(e.includes("qranalytics")){return{endpointName:"qranalytics",apireqbody:JSON.stringify({qrcodeId:t.qrcodeId,timeframe:30})}}if(e.includes("formanalytics")){return{endpointName:"formanalytics",apireqbody:JSON.stringify({formId:t.formId,timeframe:30})}}return JSON.stringify({})}executePlaygroundRequest(){return __async(this,null,function*(){try{S("Executing API request...");const n=$("#playgroundEndpoint").val(),i=$("#playgroundCredential").val(),s=$("#playgroundRequestBody").val();let o;try{o=JSON.parse(s)}catch(e){return}pe();let r=this.buildRequestBody(n,o);const l=r.apireqbody;try{const e=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Connectiko-API-Key":i,"X-Connectiko-Timestamp":Math.floor(Date.now()/1e3).toString()},credentials:"include",body:l});t("Request executed successfully");const a=yield e.json();yield this.displayQRInSampleDiv(a.data,r.endpointName)}catch(a){return{success:!1,message:"Failed to add card"}}}catch(a){n(a.message||"Failed to execute request")}finally{E()}})}displayPlaygroundResponse(e,t,n){const a=t>=200&&t<300?"success":"error",i=JSON.stringify(e,null,2);$("#playgroundResponse").html(`\n            <div class="response-header">\n                <span class="status-badge status-${a}">\n                    ${t} ${t>=200&&t<300?"OK":"Error"}\n                </span>\n                <span class="endpoint-info">${n}</span>\n            </div>\n            <pre class="response-json"><code>${this.escapeHtml(i)}</code></pre>\n        `)}initializePlayground(){this.setupPlaygroundEventHandlers()}renderUsageCharts(){}loadDetailedUsage(){return __async(this,null,function*(){try{const e=yield g.apiRequest("/api/connectiko/usage/overview?period=30");e.success&&(this.detailedUsageData=e.data)}catch(e){}})}formatNumber(e){return e?e.toLocaleString():"0"}formatDate(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):null}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}showCreateCredentialModal(){$("body").append('\n            <div id="credentialModal" class="modal-overlay">\n                <div class="modal-content">\n                    <div class="modal-header">\n                        <h3>Create New API Key</h3>\n                        <button class="modal-close" data-action="close-modal">\n                            <i class="fas fa-times"></i>\n                        </button>\n                    </div>\n                    <form id="credentialForm">\n                        <div class="form-group">\n                            <label for="credentialName">API Key Name</label>\n                            <input type="text" id="credentialName" name="credentialName" class="form-control" \n                                   placeholder="e.g. Production API Key" required>\n                            <small class="form-help">Choose a descriptive name to identify this API key</small>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="credentialEnvironment">Environment</label>\n                            <select id="credentialEnvironment" name="credentialEnvironment" class="form-control" required>\n                                <option value="live">Live (Production)</option>\n                                <option value="test">Test (Development)</option>\n                            </select>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label>Permissions</label>\n                            <div class="checkbox-group">\n                                <label class="checkbox-label">\n                                    <input type="checkbox" name="permissions" value="qr.generate" checked>\n                                    <span>Generate QR Codes</span>\n                                </label>\n                                <label class="checkbox-label">\n                                    <input type="checkbox" name="permissions" value="qr.batch">\n                                    <span>Batch Operations</span>\n                                </label>\n                                <label class="checkbox-label">\n                                    <input type="checkbox" name="permissions" value="profile.read">\n                                    <span>Read Profiles</span>\n                                </label>\n                                <label class="checkbox-label">\n                                    <input type="checkbox" name="permissions" value="analytics.read">\n                                    <span>Read Analytics</span>\n                                </label>\n                            </div>\n                        </div>\n                        \n                        <div class="modal-actions">\n                            <button type="button" class="btn-secondary" data-action="close-modal">Cancel</button>\n                            <button type="submit" class="btn-primary">Create API Key</button>\n                        </div>\n                    </form>\n                </div>\n            </div>\n        '),this.selectedCredentialId=null}hideCredentialModal(){$("#credentialModal").remove(),this.selectedCredentialId=null}submitCredentialForm(){return __async(this,null,function*(){try{S("Creating API key...");const e=new FormData(document.getElementById("credentialForm")),n=Array.from(document.querySelectorAll('input[name="permissions"]:checked')).map(e=>e.value),a={name:e.get("credentialName"),environment:e.get("credentialEnvironment"),permissions:n},i=yield g.apiRequest("/api/connectiko/credentials",{method:"POST",body:JSON.stringify(a)});if(!i.success)throw new Error(i.message);t("API key created successfully"),this.showSecretDisplay(i.data),yield this.loadCredentials(),this.refreshCredentialsList()}catch(e){n(e.message||"Failed to create API key")}finally{E()}})}showSecretDisplay(e){const t=`\n            <div id="secretDisplayModal" class="modal-overlay">\n                <div class="modal-content secret-modal">\n                    <div class="modal-header">\n                        <h3>üîí Your API Credentials</h3>\n                        <div class="security-warning">\n                            <i class="fas fa-exclamation-triangle"></i>\n                            Save these credentials securely. The secret will only be shown once!\n                        </div>\n                    </div>\n                    <div class="credential-display">\n                        <div class="credential-field">\n                            <label>API Key</label>\n                            <div class="credential-value">\n                                <code>${e.apiKey}</code>\n                                <button class="copy-btn" data-copy-text="${e.apiKey}">\n                                    <i class="fas fa-copy"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class="credential-field">\n                            <label>API Secret</label>\n                            <div class="credential-value">\n                                <code>${e.apiSecret}</code>\n                                <button class="copy-btn" data-copy-text="${e.apiSecret}">\n                                    <i class="fas fa-copy"></i>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="implementation-example">\n                        <h4>Quick Start Example</h4>\n                        <pre><code>curl -X POST "${window.location.origin}/api/v1/qr/read" \\\n  -H "X-Connectiko-API-Key: ${e.apiKey}" \\\n  -H "X-Connectiko-Signature: [HMAC-SHA256]" \\\n  -H "X-Connectiko-Timestamp: $(date +%s)" \\\n  -H "Content-Type: application/json" \\\n  -d '{"qrcodeId": "693b4aeb9fd28c6acca37a0c", "format": "png"}'</code></pre>\n                    </div>\n                    <div class="modal-actions">\n                        <button class="btn-secondary" data-action="download-credentials" \n                                data-api-key="${e.apiKey}" \n                                data-api-secret="${e.apiSecret}">\n                            <i class="fas fa-download"></i>\n                            Download as File\n                        </button>\n                        <button class="btn-primary" data-action="close-secret-modal">\n                            <i class="fas fa-check"></i>\n                            I've Saved These Credentials\n                        </button>\n                    </div>\n                </div>\n            </div>\n        `;$("body").append(t),this.hideCredentialModal()}closeSecretModal(){$("#secretDisplayModal").remove()}copyToClipboard(e){return __async(this,null,function*(){try{yield navigator.clipboard.writeText(e),t("Copied to clipboard")}catch(a){n("Failed to copy")}})}downloadCredentials(e,n){const a=`Connectiko API Credentials\nGenerated: ${(new Date).toISOString()}\n\nAPI Key: ${e}\nAPI Secret: ${n}\n\nIMPORTANT: Keep these credentials secure and never commit them to version control.\n\nDocumentation: ${window.location.origin}/api/docs\n`,i=new Blob([a],{type:"text/plain"}),s=URL.createObjectURL(i),o=document.createElement("a");o.href=s,o.download=`connectiko-api-credentials-${Date.now()}.txt`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),t("Credentials downloaded successfully")}refreshCredentialsList(){const e=$(".credentials-list");e.length&&e.html(this.renderCredentialsList())}};window.connectikoAPI=Le;const Te=Object.freeze(Object.defineProperty({__proto__:null,default:Le},Symbol.toStringTag,{value:"Module"}));const Be=new class{constructor(){this.initialized=!1,this.maxRetries=10,this.retryInterval=200,this.connectikoAPI=null,this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setup()):setTimeout(()=>this.setup(),100),window.addEventListener("popstate",()=>this.checkForPricingRoutes())}setup(){const e=()=>"function"==typeof window.showPage&&(this.extendNavigationSystem(),this.setupUpgradeRedirection(),this.setupPricingButtons(),this.checkForPricingRoutes(),this.initialized=!0,!0);e()||this.waitForNavigationSystem(e)}setupPricingButtons(){$(document).off("click.pricingHandler"),$(document).on("click.pricingHandler",".pricing-card .btn-primary",e=>__async(this,null,function*(){e.preventDefault();const t=$(e.currentTarget),n=t.closest(".pricing-card");t.text().includes("Get Started")||t.text().includes("Upgrade Now")?yield this.handleSubscriptionUpgrade(n):t.text().includes("Contact Sales")&&this.handleContactSales()}))}handleSubscriptionUpgrade(e){return __async(this,null,function*(){try{const n=e.find(".btn-primary"),a=n.text();n.text("Loading...").prop("disabled",!0),"function"==typeof window.showPage&&window.showPage("connectikoApi"),yield this.initializeConnectikoAPI(),setTimeout(()=>{n.text(a).prop("disabled",!1)},1e3),t("Welcome to ConnectiKo API! Explore the features below.")}catch(a){n("Unable to load API interface. Please try again.")}})}initializeConnectikoAPI(){return __async(this,null,function*(){try{if(this.connectikoAPI)return this.connectikoAPI;if(window.connectikoAPI)return this.connectikoAPI=window.connectikoAPI,"function"==typeof this.connectikoAPI.initialize&&(yield this.connectikoAPI.initialize()),this.connectikoAPI;const t=yield e(()=>Promise.resolve().then(()=>Te));return this.connectikoAPI=t.default,"function"==typeof this.connectikoAPI.initialize&&(yield this.connectikoAPI.initialize()),this.connectikoAPI}catch(t){if(window.connectikoAPI)return this.connectikoAPI=window.connectikoAPI,this.connectikoAPI;throw t}})}handleContactSales(){t("Contact sales feature coming soon!")}waitForNavigationSystem(e){let t=0;const n=setInterval(()=>{t++,(e()||t>=this.maxRetries)&&(clearInterval(n),t>=this.maxRetries&&(this.setupUpgradeRedirection(),this.setupPricingButtons(),this.checkForPricingRoutes(),this.initialized=!0))},this.retryInterval)}showPricingPage(){this.hideAllPages();const e=document.getElementById("pricingPage");e&&(e.classList.add("active"),e.style.display="block",this.updateNavigation("pricing"))}showBillingPage(){this.hideAllPages();const e=document.getElementById("billingPage");e&&(e.classList.add("active"),e.style.display="block",this.updateNavigation("billing"))}hideAllPages(){document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active"),e.style.display="none"})}updateNavigation(e){"function"==typeof window.updateURL&&window.updateURL(e),"function"==typeof window.setActiveNavItem&&window.setActiveNavItem(e)}checkForPricingRoutes(){const e=new URLSearchParams(window.location.search).get("page");return"pricing"===e?(this.showPricingPage(),!0):"billing"===e&&(this.showBillingPage(),!0)}extendNavigationSystem(){if("function"==typeof window.showPage){const e=window.showPage;window.showPage=t=>{if("pricing"!==t){if("billing"!==t)return e.call(this,t);this.showBillingPage()}else this.showPricingPage()}}}setupUpgradeRedirection(){const e=window.open;window.open=(t,n,a)=>"/upgrade"===t?("function"==typeof window.showPage?window.showPage("pricing"):this.showPricingPage(),null):"/subscription"===t?("function"==typeof window.showPage?window.showPage("billing"):this.showBillingPage(),null):e.call(this,t,n,a)}isInitialized(){return this.initialized}openPricing(){this.initialized&&this.showPricingPage()}openBilling(){this.initialized&&this.showBillingPage()}getConnectikoAPI(){return this.connectikoAPI}};window.pricingHandler=Be;let Ae=!1,_e=null,De=null;function Re(e){return __async(this,null,function*(){if(!Ae&&_e!==e){Ae=!0;try{const a=pe();me();if(a&&"home"===e&&(e="display"),!a&&("profile"===e||"display"===e||"wallet"===e||"team"===e))return Re("home"),void n("Please log in to access Profile and Card page");document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active"),e.style.display="none"});const i=document.getElementById(e+"Page");if(i)if(i.classList.add("active"),i.style.display="block","profile"===e)_();else if("display"===e)X();else if("wallet"===e)"function"==typeof loadWalletCards&&loadWalletCards();else if("qranalytics"===e)try{De||(De=new qe),yield De.loadAnalytics()}catch(t){n("Failed to load QR Analytics")}else if("formAnalytics"===e)try{setTimeout(()=>{Pe.init()},100)}catch(t){}else if("connectikoApi"===e)try{setTimeout(()=>{Le.initialize(),Be.init()},100)}catch(t){}else"team"===e&&Re("display");_e=e}finally{setTimeout(()=>{Ae=!1},100)}}})}function Oe(){return __async(this,null,function*(){const t=new URLSearchParams(window.location.search);if(!t.toString()){const{getUserStatus:t}=yield e(()=>__async(this,null,function*(){const{getUserStatus:e}=yield Promise.resolve().then(()=>Ee);return{getUserStatus:e}})),n=yield t();return Re(n&&n.authenticated?"display":"home"),Me(n&&n.authenticated?"display":"home"),null}const n={};for(const[e,a]of t.entries())n[e]=a;if(t.has("page")){const{getUserStatus:a}=yield e(()=>__async(this,null,function*(){const{getUserStatus:e}=yield Promise.resolve().then(()=>Ee);return{getUserStatus:e}})),i=t.get("page"),s={home:"home",faq:"faq",usecase:"usecase",scenario:"usecase",resetPassword:"resetPassword",forgotPassword:"forgotPassword",verifyEmail:"verifyEmail",qranalytics:"qranalytics"},o=["home","faq","usecase","scenario","resetPassword","forgotPassword","verifyEmail","qranalytics"];if(s[i]){if(o.includes(i))return Re(s[i]),Me(s[i]),n;const e=yield a();return"home"===i&&e&&e.authenticated?(Re("display"),Me("display")):(Re(s[i]),Me(s[i])),n}if(["signup","login","profile","wallet","team"].includes(i)){const e=yield a();e&&e.authenticated?(Re("signup"===i||"login"===i?"display":i),Me("signup"===i||"login"===i?"display":i)):(Re("profile"===i||"wallet"===i||"team"===i?"login":i),Me("profile"===i||"wallet"===i||"team"===i?"login":i))}}return n})}function Me(e){try{const t=new URL(window.location);t.searchParams.set("page",e),window.history.pushState({page:e},"",t.toString())}catch(t){}}function Ue(e){document.querySelectorAll(".sidebar .nav-item").forEach(t=>{t.getAttribute("data-page")===e?t.classList.add("active"):t.classList.remove("active")})}"undefined"!=typeof window&&(window.formAnalytics=Pe);const Ne=Object.freeze(Object.defineProperty({__proto__:null,handleURLParams:Oe,setActiveNavItem:Ue,showPage:Re,updateURL:Me},Symbol.toStringTag,{value:"Module"})),Fe="connection_error",Qe="authentication_error",ze="server_error",je="validation_error",He="timeout_error",We="unknown_error";function Ve(e){return __async(this,arguments,function*(e,t={}){const i=function(e){if(!e)return We;const t=e.message?e.message.toLowerCase():"";return e instanceof TypeError&&t.includes("fetch")||t.includes("econnrefused")||t.includes("networkerror")||t.includes("failed to fetch")||t.includes("network request failed")||t.includes("connection")||"NetworkError"===e.name?Fe:t.includes("unauthorized")||t.includes("authentication")||t.includes("session expired")||t.includes("token")||401===e.status?Qe:500===e.status||502===e.status||503===e.status||504===e.status||t.includes("server error")||t.includes("internal server")?ze:400===e.status||422===e.status||t.includes("validation")||t.includes("invalid")?je:t.includes("timeout")||t.includes("timed out")?He:We}(e);switch(i){case Fe:yield function(){return __async(this,null,function*(){localStorage.clear(),sessionStorage.clear(),a("Connection Lost","Unable to connect to the server. You have been logged out for security reasons. Please check your internet connection and try logging in again.",6e3),yield new Promise(e=>setTimeout(e,2e3)),Re("login"),window.verticalNav&&window.verticalNav.checkAuth&&window.verticalNav.checkAuth()})}();break;case Qe:yield function(){return __async(this,null,function*(){localStorage.clear(),sessionStorage.clear(),a("Session Expired","Your session has expired for security reasons. Please log in again to continue.",1e3),yield new Promise(e=>setTimeout(e,1e3)),Re("login"),window.verticalNav&&window.verticalNav.checkAuth&&window.verticalNav.checkAuth()})}();break;case ze:yield function(e){return __async(this,null,function*(){a("Server Error",e.message||"The server is experiencing issues. Please try again later.",5e3)})}(e);break;case je:!function(e){const t=e.message||"Please check your input and try again.";n(t)}(e);break;case He:a("Request Timeout","The request took too long to complete. Please check your connection and try again.",5e3);break;default:!function(e){const t=e.message||"An unexpected error occurred. Please try again.";n(t)}(e)}})}function Je(){!function(){const e=document.querySelectorAll(".sidebar .nav-item");e.forEach(t=>{t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();const n=this.getAttribute("data-page");if(n){if(this.classList.contains("active"))return;e.forEach(e=>e.classList.remove("active")),this.classList.add("active"),Re(n),tt(n),Ge(),window.scrollTo(0,0)}})})}(),function(){const e=document.getElementById("mobileMenuToggle"),t=document.querySelector(".sidebar");e&&t&&(e.addEventListener("click",function(){t.classList.toggle("mobile-open");const e=this.querySelector("i");t.classList.contains("mobile-open")?(e.classList.remove("fa-bars"),e.classList.add("fa-times")):(e.classList.remove("fa-times"),e.classList.add("fa-bars"))}),document.addEventListener("click",function(n){window.innerWidth<=768&&(t.contains(n.target)||e.contains(n.target)||Ge())}))}(),Ke(),Xe(),function(){const e=new URLSearchParams(window.location.search).get("page");if(e){const t=pe();nt("home"===e&&t?"display":e)}else{nt(pe()?"display":"home")}}()}function Ge(){if(window.innerWidth<=768){const e=document.querySelector(".sidebar"),t=document.getElementById("mobileMenuToggle");if(e&&t){e.classList.remove("mobile-open");const n=t.querySelector("i");n&&(n.classList.remove("fa-times"),n.classList.add("fa-bars"))}}}function Ke(){return __async(this,null,function*(){try{const e=new URLSearchParams(window.location.search).get("page");if(["home","faq","usecase","scenario","resetPassword","forgotPassword","verifyEmail"].includes(e))return void Ye();const t=pe();if(t)Ze(t);else{if(yield g.checkAuthStatus()){const e=yield g.getCurrentUser();e.success&&e.user?Ze(e.user):Ye()}else Ye()}}catch(e){Ye()}})}function Ze(e){const t=document.querySelector(".homebutton"),n=document.getElementById("loginBtnSidebar"),a=document.getElementById("signupBtnSidebar"),i=document.getElementById("profileBtnSidebar"),s=document.getElementById("displayBtnSidebar"),o=document.getElementById("walletBtnSidebar"),r=document.getElementById("logoutBtnSidebar"),l=document.getElementById("userProfileSection"),c=document.querySelector('.nav-item[data-page="qranalytics"]'),d=document.getElementById("formAnalyticsBtnSidebar"),u=document.getElementById("connectikoApiBtnSidebar");if(t&&t.classList.add("hidden"),n&&n.classList.add("hidden"),a&&a.classList.add("hidden"),i&&i.classList.remove("hidden"),s&&s.classList.remove("hidden"),o&&o.classList.remove("hidden"),r&&(r.style.display="flex"),c&&(c.style.display="flex"),d&&(d.style.display="flex"),u&&(e.subscription&&e.subscription.status,u.classList.remove("hidden")),l){l.style.display="flex";const t=document.getElementById("sidebarUserName"),n=document.getElementById("sidebarUserEmail"),a=document.getElementById("sidebarUserInitials");if(t&&(t.textContent=e.name||e.email||"User"),n&&(n.textContent=e.email||""),a&&(e.name||e.email)){const t=(e.name||e.email).split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2);a.textContent=t}}const p=new URLSearchParams(window.location.search).get("page");if(!["home","faq","usecase","scenario","resetPassword","forgotPassword","verifyEmail"].includes(p))if("function"==typeof window.initiateQRmanager)window.initiateQRmanager();else try{void 0!==oe&&oe.init&&oe.init(),void 0!==re&&re.init&&re.init(),void 0!==V&&V.init&&V.init()}catch(m){}Xe()}function Ye(){const e=document.querySelector(".homebutton"),t=document.getElementById("loginBtnSidebar"),n=document.getElementById("signupBtnSidebar"),a=document.getElementById("profileBtnSidebar"),i=document.getElementById("displayBtnSidebar"),s=document.getElementById("walletBtnSidebar"),o=document.getElementById("logoutBtnSidebar"),r=document.getElementById("teamBtnSidebar"),l=document.getElementById("userProfileSection"),c=document.querySelector('.nav-item[data-page="qranalytics"]'),d=document.getElementById("formAnalyticsBtnSidebar"),u=document.getElementById("connectikoApiBtnSidebar");e&&e.classList.remove("hidden"),t&&t.classList.remove("hidden"),n&&n.classList.remove("hidden"),a&&a.classList.add("hidden"),i&&i.classList.add("hidden"),s&&s.classList.add("hidden"),r&&r.classList.add("hidden"),o&&(o.style.display="none"),l&&(l.style.display="none"),c&&(c.style.display="none"),d&&(d.style.display="none"),u&&u.classList.add("hidden"),Xe()}function Xe(){const e=pe(),t=document.querySelector('.nav-item[data-page="qrAnalytics"]')||document.querySelector('.nav-item[data-page="qranalytics"]');if(t)t.style.display=e?"flex":"none";else{const t=document.getElementById("qrAnalyticsBtnSidebar");t&&(e?(t.classList.remove("hidden"),t.style.display="flex"):(t.classList.add("hidden"),t.style.display="none"))}}const et=document.getElementById("logoutBtnSidebar");function tt(e){const t=new URL(window.location);t.searchParams.set("page",e),window.history.pushState({},"",t)}function nt(e){document.querySelectorAll(".sidebar .nav-item").forEach(t=>{t.getAttribute("data-page")===e?t.classList.add("active"):t.classList.remove("active")})}function at(){return/Android/i.test(navigator.userAgent)}function it(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}function st(){return!(it()||/iPad/.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1||at()||/webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))}function ot(){var e,t,n,a;if(!me())return;const i={name:document.getElementById("displayName").textContent||"John Doe",phone:(null==(t=null==(e=document.getElementById("displayPhoneLink"))?void 0:e.querySelector(".method-value"))?void 0:t.textContent)||"",email:document.getElementById("displayEmail").textContent||"",website:(null==(a=null==(n=document.getElementById("displayWebsite"))?void 0:n.querySelector(".method-value"))?void 0:a.textContent)||"",qrCodeData:window.location.href};it()?function(e){__async(this,null,function*(){!function(e){b(),w(),e.name,e.phone,e.email,e.website&&e.website,e.qrCodeData}(e);const t=me();"https:"===window.location.protocol&&t?function(e,t,n){__async(this,null,function*(){!function(){const e=document.createElement("div");e.id="wallet-loader",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        color: white;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ",e.innerHTML='\n        <div style="text-align: center;">\n            <div style="width: 40px; height: 40px; border: 3px solid #667eea; border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>\n            <p>Generating wallet pass...</p>\n        </div>\n        <style>\n            @keyframes spin {\n                0% { transform: rotate(0deg); }\n                100% { transform: rotate(360deg); }\n            }\n        </style>\n    ',document.body.appendChild(e)}();const e=`/api/card/${me().slug}/apple-wallet-pass`;try{const a=yield fetch(e,{method:"GET",headers:{Accept:"application/vnd.apple.pkpass, application/octet-stream"}});if(C(),!a.ok)throw new Error(`Failed to generate ${n} wallet pass`);const i=window.location.origin+e;if("apple"===n&&it())return;if("google"===n&&at());else{const e=document.createElement("a");e.href=i,e.download=`${t.name.replace(/\s+/g,"_")}.${"apple"===n?"pkpass":"gwpass"}`,e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}}catch(a){C(),rt()}})}(0,e,"apple"):rt()})}(i):at()?generateGoogleWalletPass(i):st()?downloadJSONAndShowPreview(i):function(e){const t=`\n    <!DOCTYPE html>\n    <html>\n    <head>\n        <meta charset="UTF-8">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <title>Digital Business Card - ${e.name}</title>\n        <style>\n            body {\n                margin: 0;\n                padding: 20px;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                background: #f0f0f0;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                min-height: 100vh;\n            }\n            .wallet-pass {\n                width: 340px;\n                max-width: 90vw;\n                height: 220px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                border-radius: 15px;\n                color: white;\n                padding: 20px;\n                box-shadow: 0 10px 30px rgba(0,0,0,0.3);\n            }\n            .pass-content h1 {\n                font-size: 20px;\n                margin: 0 0 10px 0;\n            }\n            .pass-content p {\n                margin: 3px 0;\n                font-size: 14px;\n            }\n        </style>\n    </head>\n    <body>\n        <div class="wallet-pass">\n            <div class="pass-content">\n                <h1>${e.name}</h1>\n                <p>${e.phone}</p>\n                <p>${e.email}</p>\n                ${e.website?`<p>${e.website}</p>`:""}\n            </div>\n        </div>\n    </body>\n    </html>`,n=window.open();n.document.write(t),n.document.close()}(i)}function rt(e){!function(e){const t=document.createElement("div");t.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n    ";const n=document.createElement("div");n.style.cssText="\n        background: white;\n        padding: 30px;\n        border-radius: 20px;\n        max-width: 500px;\n        text-align: center;\n    ",n.innerHTML=e+'\n        <button id="closeModalBtn" \n                style="background: #667eea; color: white; border: none; padding: 10px 20px; \n                       border-radius: 10px; cursor: pointer; font-size: 16px; margin-top: 20px;">\n            Got it!\n        </button>\n    ',t.appendChild(n),document.body.appendChild(t),document.getElementById("closeModalBtn").addEventListener("click",function(){t.remove()})}('\n        <h2>Add to Apple Wallet</h2>\n        <p>To add this business card to your Apple Wallet:</p>\n        <ol style="text-align: left; margin: 20px 0;">\n            <li>A wallet pass file will be generated</li>\n            <li>Tap "Add" when prompted</li>\n            <li>The card will appear in your Wallet app</li>\n        </ol>\n    ')}function lt(e){return e.trim().replace(/^@+/,"")}function ct(e,t){const n=lt(t),a=p[e];if(!a)return t;if("whatsapp"===e){const e=n.replace(/[^\d+]/g,"");return`${a.baseUrl}${e}`}return"reddit"!==e||n.startsWith("u/"),`${a.baseUrl}${n}`}function dt(e,t){if(!t||""===t.trim())return{valid:!0,url:""};const n=t.trim(),a=p[e];if(!a)return{valid:!0,url:n};const i=function(e){if(e.startsWith("http://")||e.startsWith("https://"))return!0;if(e.includes("/"))return!0;if(e.includes(".")){const t=e.split(".");if(t.length>2)return!0;if(2===t.length){const e=t[1].toLowerCase().split("/")[0];return!!m.includes(e)}}return!1}(n);if(!i){if(a.handlePattern){const t=lt(n);if(a.handlePattern.test(t)){return{valid:!0,url:ct(e,n)}}return{valid:!1,url:"",error:`Please enter a valid ${e} handle`}}return{valid:!0,url:ct(e,n)}}try{let t=n;t.startsWith("http://")||t.startsWith("https://")||(t="https://"+t);const i=new URL(t);return a.domains.some(e=>i.hostname.includes(e))?{valid:!0,url:t}:{valid:!1,url:"",error:`Please enter a valid ${e} URL or handle`}}catch(s){if(a.handlePattern){const t=lt(n);if(a.handlePattern.test(t)){return{valid:!0,url:ct(e,n)}}return{valid:!1,url:"",error:`Please enter a valid ${e} handle or URL`}}return{valid:!0,url:ct(e,n)}}}function ut(e,t){const n=document.getElementById(e);if(!n)return!0;const a=n.value.trim();if(!a)return!0;if("website"===e)try{let e=a;return e.startsWith("http://")||e.startsWith("https://")||(e="https://"+e),new URL(e),n.setAttribute("data-final-url",e),!0}catch(o){return i(e,t),!1}const s=dt(e,a);return s.valid?(n.setAttribute("data-final-url",s.url),!0):(i(e,s.error||t),!1)}function pt(e){return/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(e)}function mt(e,t,n){const a=document.getElementById(e).value.trim();return!(a.length>t)||(i(e,`${n} cannot be more than ${t} characters (current: ${a.length})`),!1)}function ht(){const e=document.getElementById("name"),t=document.getElementById("organization"),n=e.value.trim().toLowerCase(),a=t.value.trim().toLowerCase();return!n||!a||n!==a||(i("organization","Organization name cannot be the same as your name"),!1)}function yt(e,t){return!!document.getElementById(e).value.trim()||(i(e,t),!1)}function gt(e){const t=document.getElementById(e).value.trim();return!t||(!!/^\d{10}$/.test(t)||(i(e,"Please enter exactly 10 digits"),!1))}function ft(){var e,t,n,a,i;s();let o=!0;const r=document.getElementById("name"),l=document.getElementById("email"),c=document.getElementById("organization"),p=document.getElementById("phone"),m=document.getElementById("mobile"),y=document.getElementById("website");r&&(o=yt("name","Full name is required")&&o),l&&(o=yt("email","Email address is required")&&o);const g=(null==(e=null==r?void 0:r.value)?void 0:e.trim())||"";g&&(o=mt("name",d,"Name")&&o);const f=(null==(t=null==c?void 0:c.value)?void 0:t.trim())||"";f&&(o=mt("organization",u,"Organization")&&o),g&&f&&(o=ht()&&o);const v=(null==(n=null==p?void 0:p.value)?void 0:n.trim())||"",b=(null==(a=null==m?void 0:m.value)?void 0:a.trim())||"";v&&(o=gt("phone")&&o),b&&(o=gt("mobile")&&o);return((null==(i=null==y?void 0:y.value)?void 0:i.trim())||"")&&(o=ut("website","Please enter a valid website URL")&&o),h.forEach(e=>{var t;const n=document.getElementById(e);((null==(t=null==n?void 0:n.value)?void 0:t.trim())||"")&&(o=ut(e,`Please enter a valid ${e} URL`)&&o)}),o}function vt(){const e=document.getElementById("profileForm");e&&(e.addEventListener("input",function(e){e.target&&void 0!==e.target.value&&setTimeout(()=>{ft()},100)}),e.addEventListener("blur",function(e){var t,n;if(!e.target||!e.target.id||void 0===e.target.value)return;const a=e.target.id,i=(null==(t=e.target.value)?void 0:t.trim())||"";if(h.includes(a)){const t=e.target.closest(".social-item"),n=null==t?void 0:t.querySelector(".input-error");n&&(n.innerHTML="")}else{const t=null==(n=e.target.parentNode)?void 0:n.querySelector(".error-message");t&&t.remove()}e.target.style&&(e.target.style.borderColor="",e.target.style.backgroundColor=""),function(e,t){var n,a;null==t&&(t="");let i=!0;try{switch(e){case"name":if(i=yt(e,"Full name is required"),i&&t&&(i=mt("name",d,"Name")),i&&t){const e=document.getElementById("organization");((null==(n=null==e?void 0:e.value)?void 0:n.trim())||"")&&(i=ht())}break;case"organization":if(t&&(i=mt("organization",u,"Organization")),i&&t){const e=document.getElementById("name");((null==(a=null==e?void 0:e.value)?void 0:a.trim())||"")&&(i=ht())}break;case"email":i=yt(e,"Email is required");break;case"phone":case"mobile":t&&(i=gt(e));break;case"website":t&&(i=ut("website","Please enter a valid website URL"));break;default:h.includes(e)&&t&&(i=ut(e,`Please enter a valid ${e} URL`))}}catch(s){i=!1}}(a,i),setTimeout(()=>{ft()},50)},!0))}function bt(){try{vt();const e=$("#isPublic");e.length&&e.on("change",function(){try{const e=$(this).is(":checked"),t=$(this).closest(".form-group").find(".form-text");t.length&&(e?(t.text("When checked, others can view your card using the link or QR code"),t.removeClass("text-danger").addClass("text-muted")):(t.text("Your card will be private - only you can access it when logged in"),t.removeClass("text-muted").addClass("text-danger")))}catch(e){}}),function(){try{const e=document.querySelectorAll(".social-category-content");if(0===e.length)return;e.forEach((e,t)=>{e.getAttribute("data-category-content");e.querySelectorAll('.social-item input[type="url"]').forEach(e=>{e.addEventListener("input",function(e){if(!e.target||void 0===e.target.value)return;const t=e.target.value.trim(),n=e.target.id,a=e.target.closest(".social-item"),i=null==a?void 0:a.querySelector(".input-error");i&&(i.innerHTML=""),t&&h.includes(n)&&setTimeout(()=>{ut(n,`Please enter a valid ${n} URL`)},300)}),e.addEventListener("blur",function(e){if(!e.target||void 0===e.target.value)return;const t=e.target.value.trim(),n=e.target.id;t&&h.includes(n)&&ut(n,`Please enter a valid ${n} URL`)})})})}catch(e){}}()}catch(e){}}et&&et.addEventListener("click",function(){return __async(this,null,function*(){try{yield ge(),Ye(),Re("home"),tt("home"),nt("home"),t("Logged out successfully")}catch(e){n("Error logging out")}})}),window.addEventListener("popstate",function(){let e=new URLSearchParams(window.location.search).get("page")||"home";const t=pe();"home"===e&&t&&(e="display"),Re(e),nt(e)}),"undefined"!=typeof window&&(window.verticalNav={init:Je,setActive:nt,closeMobile:Ge,checkAuth:Ke,updateAuthUI:Ze,updateGuestUI:Ye,updateNavigation:Xe}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Je):Je();const wt={privacy:"privacy-modal",terms:"terms-modal",faq:"faq-modal",suggestions:"suggestions-modal",contact:"contact-modal"},$t={privacy:"privacy-link",terms:"terms-link",faq:"faq-link",suggestions:"suggestions-link",contact:"contact-link"};function Ct(){Object.entries($t).forEach(([e,t])=>{const n=document.getElementById(t);n&&n.addEventListener("click",t=>{t.preventDefault(),function(e){const t=wt[e],n=document.getElementById(t);n&&(n.style.display="block",document.body.style.overflow="hidden")}(e)})})}function St(){document.querySelectorAll(".close").forEach(e=>{e&&e.addEventListener("click",()=>{Object.values(wt).forEach(e=>{const t=document.getElementById(e);t&&"block"===t.style.display&&(t.style.display="none")}),document.body.style.overflow="auto"})}),Object.values(wt).forEach(e=>{const t=document.getElementById(e);t&&t.addEventListener("click",e=>{e.target===t&&(t.style.display="none",document.body.style.overflow="auto")})})}function Et(){Ct(),St(),document.querySelectorAll(".faq-question").forEach(e=>{e&&e.addEventListener("click",()=>{const t=e.nextElementSibling;if(t){const e=t.classList.contains("show");document.querySelectorAll(".faq-answer").forEach(e=>{e.classList.remove("show")}),e||t.classList.add("show")}})})}function xt(e){return __async(this,null,function*(){e.preventDefault();const a=document.getElementById("contact-success");a&&(a.style.display="none");const i=new FormData(e.target),s={name:i.get("name"),email:i.get("email"),category:i.get("category"),title:i.get("title"),details:i.get("details")},o=e.target.querySelector('button[type="submit"]'),r=o.innerHTML,l=function(e){const t=[];return(!e.name||e.name.trim().length<2)&&t.push({field:"suggestion-name",message:"Name must be at least 2 characters"}),e.email&&pt(e.email)||t.push({field:"suggestion-email",message:"Please enter a valid email address"}),(!e.title||e.title.trim().length<5)&&t.push({field:"suggestion-title",message:"Title must be at least 5 characters"}),(!e.details||e.details.trim().length<20)&&t.push({field:"suggestion-details",message:"Details must be at least 20 characters"}),t}(s);if(l.length>0)return c=l,document.querySelectorAll(".form-error").forEach(e=>e.remove()),void c.forEach(e=>{const t=document.getElementById(e.field);if(t){const n=document.createElement("div");n.className="form-error",n.style.cssText="\n                color: #dc3545;\n                font-size: 0.875rem;\n                margin-top: 0.25rem;\n            ",n.textContent=e.message,t.parentNode.insertBefore(n,t.nextSibling),t.style.borderColor="#dc3545"}});var c;o.innerHTML='<i class="fas fa-spinner fa-spin"></i> Submitting...',o.disabled=!0;try{const n=yield g.updatesuggestions(s);if(!n||!n.success)throw new Error(n.message||"Failed to submit suggestion");{t(n.message),e.target.reset();const a=e.target.closest(".modal");a&&(a.style.display="none",document.body.style.overflow="auto")}}catch(d){let e="There was an error submitting your suggestion. ";d.message.includes("fetch")||d.message.includes("NetworkError")?e+="Please check your internet connection and try again.":d.message.includes("similar suggestion")?e="A similar suggestion was already submitted recently. Please try a different suggestion.":e+=d.message||"Please try again later.",n(e)}finally{o.innerHTML=r,o.disabled=!1}})}function kt(e){return __async(this,null,function*(){e.preventDefault();const a=document.getElementById("contact-success");a&&(a.style.display="none");const i=new FormData(e.target),s={name:i.get("name"),email:i.get("email"),phone:i.get("phone"),subject:i.get("subject"),message:i.get("message")},o=e.target.querySelector('button[type="submit"]'),r=o.innerHTML,l=!(c=s).name||c.name.trim().length<2?"Please enter a valid name (at least 2 characters)":c.email&&pt(c.email)?c.subject?!c.message||c.message.trim().length<10?"Please enter a message (at least 10 characters)":c.phone&&c.phone.trim()&&(d=c.phone,!/^[\+]?[1-9][\d]{0,15}$/.test(d.trim()))?"Please enter a valid phone number or leave it empty":null:"Please select a subject":"Please enter a valid email address";var c,d;if(l)n(l);else{o.innerHTML='<i class="fas fa-spinner fa-spin"></i> Sending...',o.disabled=!0;try{const n=yield g.updatecontactinfo(s);if(!n||!n.success)throw new Error(n.message||"Failed to send message");a?(a.style.display="block",a.textContent="Thank you for contacting us. We will get back to you soon!"):t("Thank you for contacting us. We will get back to you soon!"),e.target.reset(),setTimeout(()=>{const e=document.getElementById("contact-modal");e&&(e.style.display="none",document.body.style.overflow="auto"),a&&(a.style.display="none")},3e3)}catch(u){let e="There was an error sending your message. ";u.message.includes("fetch")||u.message.includes("NetworkError")?e+="Please check your internet connection and try again.":u.message.includes("validation")||u.message.includes("required")?e="Please fill in all required fields correctly.":e+=u.message||"Please try again later.",n(e)}finally{o.innerHTML=r,o.disabled=!1}}})}const qt=new class{constructor(e={}){this.config={interval:e.interval||2e3,transitionDuration:e.transitionDuration||500,images:e.images||["../image/sample-design-branding-1.png","../image/sample-design-branding-4.png","../image/sample-design-branding-2.png","../image/sample-design-branding-3.png"],selector:e.selector||".phone-frame"},this.currentIndex=0,this.carouselInterval=null,this.phoneScreens=[],this.phoneFrame=null,this.isInitialized=!1}init(){this.isInitialized||(this.phoneFrame=document.querySelector(this.config.selector),this.phoneFrame&&(this.phoneFrame.innerHTML="",this.config.images.forEach((e,t)=>{const n=document.createElement("img");n.src=e,n.alt=`Digital Card Design ${t+1}`,n.className="phone-screen",0===t&&n.classList.add("active"),this.phoneFrame.appendChild(n),this.phoneScreens.push(n)}),this.setupEventListeners(),this.start(),this.isInitialized=!0))}showNext(){0!==this.phoneScreens.length&&(this.phoneScreens[this.currentIndex].classList.remove("active"),this.currentIndex=(this.currentIndex+1)%this.phoneScreens.length,this.phoneScreens[this.currentIndex].classList.add("active"))}showPrevious(){0!==this.phoneScreens.length&&(this.phoneScreens[this.currentIndex].classList.remove("active"),this.currentIndex=0===this.currentIndex?this.phoneScreens.length-1:this.currentIndex-1,this.phoneScreens[this.currentIndex].classList.add("active"))}goToIndex(e){e<0||e>=this.phoneScreens.length||0!==this.phoneScreens.length&&(this.phoneScreens[this.currentIndex].classList.remove("active"),this.currentIndex=e,this.phoneScreens[this.currentIndex].classList.add("active"))}start(){this.carouselInterval&&this.stop(),this.carouselInterval=setInterval(()=>{this.showNext()},this.config.interval)}stop(){this.carouselInterval&&(clearInterval(this.carouselInterval),this.carouselInterval=null)}reset(){this.stop(),this.phoneScreens.forEach(e=>e.classList.remove("active")),this.currentIndex=0,this.phoneScreens.length>0&&this.phoneScreens[0].classList.add("active"),this.start()}updateConfig(e){this.config=__spreadValues(__spreadValues({},this.config),e),this.carouselInterval&&(this.stop(),this.start())}setupEventListeners(){document.addEventListener("visibilitychange",()=>{document.hidden?this.stop():this.start()}),window.addEventListener("beforeunload",()=>{this.destroy()})}destroy(){this.stop(),this.phoneScreens=[],this.currentIndex=0,this.phoneFrame=null,this.isInitialized=!1}getState(){return{currentIndex:this.currentIndex,totalImages:this.phoneScreens.length,isRunning:null!==this.carouselInterval,isInitialized:this.isInitialized,config:__spreadValues({},this.config)}}};function It(){return __async(this,null,function*(){const e=localStorage.getItem("token");if(e)try{const t=yield $.ajax({url:"/api/profile",method:"GET",headers:{Authorization:"Bearer "+e}});t.success&&function(e){let t=$("#navbarAvatar");if(t.show().empty(),e.hasProfilePhoto){const n=`${g.baseURL}/api/profile/photo/c/${e.cardId}`;t.html(`\n        <img src="${n}" \n             alt="${e.name||e.username}" \n             onerror="this.style.display='none'; this.parentElement.textContent='${e.initials}';">\n    `)}else t.text(e.initials);t.css("cursor","pointer").off("click").on("click",function(){window.location.href="/profile"})}(t.profile)}catch(t){$("#navbarAvatar").hide()}else $("#navbarAvatar").hide()})}"undefined"!=typeof window&&(window.PhoneCarousel=qt),$(document).ready(function(){}),$(window).on("focus",function(){It()});class Pt{constructor(){this.countries=[],this.currentStates=[],this.currentCities=[],this.selectedCountry=null,this.selectedState=null,this.selectedCity=null,this.currentSelectedIndex=-1,this.activeDropdown=null,this.filteredCountries=[],this.filteredStates=[],this.filteredCities=[],this.initAutocomplete()}getFilteredCountries(){return this.filteredCountries}getFilteredStates(){return this.filteredStates}getFilteredCities(){return this.filteredCities}handleCountryInput(e){const t=document.getElementById("countryDropdown");if(!e||e.length<1)return t.classList.remove("active"),void(this.filteredCountries=[]);this.filteredCountries=this.countries.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())),this.displayCountryResults(this.filteredCountries,t)}handleStateInput(e){const t=document.getElementById("stateDropdown");if(!e||e.length<1)return t.classList.remove("active"),void(this.filteredStates=[]);this.filteredStates=this.currentStates.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())),this.displayStateResults(this.filteredStates,t)}handleCityInput(e){const t=document.getElementById("cityDropdown");if(!e||e.length<1)return t.classList.remove("active"),void(this.filteredCities=[]);this.filteredCities=this.currentCities.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())),this.displayCityResults(this.filteredCities,t)}loadCountries(){return __async(this,null,function*(){try{const e=yield fetch("/data/countries_states_cities.json");if(!e.ok)throw new Error("Failed to load countries data");const t=yield e.json();this.countries=t.map(e=>({name:e.name,code:e.iso2,iso3:e.iso3,flag:e.emoji||"üåç",phonecode:e.phonecode,currency:e.currency,region:e.region,states:e.states||[]}))}catch(e){}})}initAutocomplete(){const e=document.getElementById("country"),t=document.getElementById("countryDropdown");e&&(e.addEventListener("input",e=>{this.currentSelectedIndex=-1,this.handleCountryInput(e.target.value)}),e.addEventListener("focus",()=>{this.activeDropdown="country",e.value&&this.handleCountryInput(e.value)}),e.addEventListener("blur",()=>{setTimeout(()=>{"country"===this.activeDropdown&&(this.activeDropdown=null)},200)}),e.addEventListener("keydown",n=>{document.activeElement===e&&t.classList.contains("active")&&this.handleKeyboardNavigation(n,"countryDropdown")}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||(t.classList.remove("active"),this.currentSelectedIndex=-1)}));const n=document.getElementById("state"),a=document.getElementById("stateDropdown");n&&(n.addEventListener("input",e=>{this.currentSelectedIndex=-1,this.handleStateInput(e.target.value)}),n.addEventListener("focus",()=>{this.activeDropdown="state",n.value&&this.handleStateInput(n.value)}),n.addEventListener("blur",()=>{setTimeout(()=>{"state"===this.activeDropdown&&(this.activeDropdown=null)},200)}),n.addEventListener("keydown",e=>{document.activeElement===n&&a.classList.contains("active")&&this.handleKeyboardNavigation(e,"stateDropdown")}),document.addEventListener("click",e=>{n.contains(e.target)||a.contains(e.target)||(a.classList.remove("active"),this.currentSelectedIndex=-1)}));const i=document.getElementById("city"),s=document.getElementById("cityDropdown");i&&(i.addEventListener("input",e=>{this.currentSelectedIndex=-1,this.currentCities.length>0&&this.handleCityInput(e.target.value)}),i.addEventListener("focus",()=>{this.activeDropdown="city",i.value&&this.currentCities.length>0&&this.handleCityInput(i.value)}),i.addEventListener("blur",()=>{setTimeout(()=>{"city"===this.activeDropdown&&(this.activeDropdown=null)},200)}),i.addEventListener("keydown",e=>{document.activeElement===i&&this.currentCities.length>0&&s.classList.contains("active")&&this.handleKeyboardNavigation(e,"cityDropdown")}),document.addEventListener("click",e=>{i.contains(e.target)||s.contains(e.target)||(s.classList.remove("active"),this.currentSelectedIndex=-1)}))}handleKeyboardNavigation(e,t){const n=document.getElementById(t);if(!n||!n.classList.contains("active"))return;const a=n.querySelectorAll(".autocomplete-item");if(0!==a.length)switch(e.key){case"ArrowDown":e.preventDefault(),e.stopPropagation(),this.currentSelectedIndex=(this.currentSelectedIndex+1)%a.length,this.updateSelection(a);break;case"ArrowUp":e.preventDefault(),e.stopPropagation(),this.currentSelectedIndex=this.currentSelectedIndex<=0?a.length-1:this.currentSelectedIndex-1,this.updateSelection(a);break;case"Enter":e.preventDefault(),e.stopPropagation();const i=a[this.currentSelectedIndex>=0?this.currentSelectedIndex:0];i&&i._data&&("countryDropdown"===t?this.selectCountry(i._data):"stateDropdown"===t?this.selectState(i._data):"cityDropdown"===t&&this.selectCity(i._data)),n.classList.remove("active"),this.currentSelectedIndex=-1;break;case"Escape":e.preventDefault(),e.stopPropagation(),n.classList.remove("active"),this.currentSelectedIndex=-1;break;case"Tab":n.classList.remove("active"),this.currentSelectedIndex=-1}}updateSelection(e){e.forEach(e=>e.classList.remove("selected")),this.currentSelectedIndex>=0&&e[this.currentSelectedIndex]&&(e[this.currentSelectedIndex].classList.add("selected"),e[this.currentSelectedIndex].scrollIntoView({block:"nearest",behavior:"smooth"}))}handleCountryInput(e){const t=document.getElementById("countryDropdown");if(!e||e.length<1)return void t.classList.remove("active");const n=this.countries.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));this.displayCountryResults(n,t)}displayCountryResults(e,t){if(t.innerHTML="",this.currentSelectedIndex=-1,0===e.length)return t.innerHTML='<div class="autocomplete-no-results">No countries found</div>',void t.classList.add("active");e.slice(0,10).forEach((e,n)=>{const a=document.createElement("div");a.className="autocomplete-item",a.innerHTML=`<span class="flag">${e.flag}</span> ${e.name}`,a._data=e,a._index=n,a.addEventListener("mousedown",t=>{t.preventDefault(),this.selectCountry(e)}),t.appendChild(a)}),t.classList.add("active")}selectCountry(e){this.selectedCountry=e;const t=document.getElementById("country"),n=document.getElementById("countryCode"),a=document.getElementById("countryDropdown");t&&(t.value=e.name),n&&(n.value=e.code),a&&a.classList.remove("active"),this.selectedState=null,this.selectedCity=null,this.currentStates=[],this.currentCities=[],this.currentSelectedIndex=-1;const i=document.getElementById("state"),s=document.getElementById("stateId");i&&(i.value=""),s&&(s.value=""),this.resetCity(),this.loadStates(e)}loadStates(e){if(!e.states||0===e.states.length){this.currentStates=[];const e=document.getElementById("state");return void(e&&(e.disabled=!0,e.placeholder="No states available"))}this.currentStates=e.states.map(e=>({id:e.id,name:e.name,code:e.iso2,cities:e.cities||[]}));const t=document.getElementById("state");t&&(t.disabled=!1,t.placeholder="Start typing state name...")}handleStateInput(e){const t=document.getElementById("stateDropdown");if(!e||e.length<1)return void t.classList.remove("active");const n=this.currentStates.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));this.displayStateResults(n,t)}displayStateResults(e,t){if(t.innerHTML="",this.currentSelectedIndex=-1,0===e.length)return t.innerHTML='<div class="autocomplete-no-results">No states found</div>',void t.classList.add("active");e.slice(0,10).forEach((e,n)=>{const a=document.createElement("div");a.className="autocomplete-item",a.textContent=e.name,a.setAttribute("data-state-code",e.code),a.setAttribute("data-state-id",e.id),a._data=e,a._index=n,a.addEventListener("mousedown",t=>{t.preventDefault(),this.selectState(e)}),t.appendChild(a)}),t.classList.add("active")}selectState(e){this.selectedState=e;const t=document.getElementById("state"),n=document.getElementById("stateId"),a=document.getElementById("stateCode"),i=document.getElementById("stateDropdown");t&&(t.value=e.name),n&&(n.value=e.id),a&&(a.value=e.code),i&&i.classList.remove("active"),this.selectedCity=null,this.currentCities=[],this.currentSelectedIndex=-1;const s=document.getElementById("city"),o=document.getElementById("cityId");s&&(s.value=""),o&&(o.value=""),this.loadCities(e)}loadCities(e){if(!e.cities||0===e.cities.length){this.currentCities=[];const e=document.getElementById("city");return void(e&&(e.disabled=!1,e.placeholder="Type city name manually..."))}this.currentCities=e.cities.map(e=>({id:e.id,name:e.name,latitude:e.latitude,longitude:e.longitude}));const t=document.getElementById("city");t&&(t.disabled=!1,t.placeholder="Start typing city name...")}handleCityInput(e){const t=document.getElementById("cityDropdown");if(!e||e.length<1)return void t.classList.remove("active");const n=this.currentCities.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));this.displayCityResults(n,t)}displayCityResults(e,t){if(t.innerHTML="",this.currentSelectedIndex=-1,0===e.length)return t.innerHTML='<div class="autocomplete-no-results">No cities found - you can type manually</div>',void t.classList.add("active");e.slice(0,10).forEach((e,n)=>{const a=document.createElement("div");a.className="autocomplete-item",a.textContent=e.name,a._data=e,a._index=n,a.addEventListener("mousedown",t=>{t.preventDefault(),this.selectCity(e)}),t.appendChild(a)}),t.classList.add("active")}selectCity(e){this.selectedCity=e;const t=document.getElementById("city"),n=document.getElementById("cityId"),a=document.getElementById("cityDropdown");t&&(t.value=e.name),n&&(n.value=e.id),a&&a.classList.remove("active"),this.currentSelectedIndex=-1}resetCity(){const e=document.getElementById("city"),t=document.getElementById("cityId"),n=document.getElementById("cityDropdown");e&&(e.value="",e.disabled=!0,e.placeholder="Select state first..."),t&&(t.value=""),n&&n.classList.remove("active"),this.selectedCity=null,this.currentCities=[]}getSelectedLocation(){const e=document.getElementById("city"),t=e?e.value:null;return{country:this.selectedCountry,state:this.selectedState,city:this.selectedCity||{name:t}}}}let Lt;document.addEventListener("DOMContentLoaded",()=>__async(this,null,function*(){Lt=new Pt,yield Lt.loadCountries()}));const Tt={getWallet(){return __async(this,null,function*(){try{const e=yield fetch("/api/wallet",{credentials:"include"});return yield e.json()}catch(e){return{success:!1,message:"Failed to fetch wallet"}}})},addCard(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/wallet/add/${e}`,{method:"POST",credentials:"include"});return yield t.json()}catch(t){return{success:!1,message:"Failed to add card"}}})},removeCard(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/wallet/remove/${e}`,{method:"DELETE",credentials:"include"});return yield t.json()}catch(t){return{success:!1,message:"Failed to remove card"}}})},checkCard(e){return __async(this,null,function*(){try{const t=yield fetch(`/api/wallet/check/${e}`,{credentials:"include"});return yield t.json()}catch(t){return{success:!1,inWallet:!1}}})}};function Bt(){const e=document.getElementById("walletCardsContainer");if(!e)return;const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("click",function(e){return __async(this,null,function*(){if(e.target.closest(".shareWalletCardlink")){const t=e.target.closest(".shareWalletCardlink");t.getAttribute("data-cardid");const n=t.getAttribute("data-cardname"),a=t.getAttribute("data-slug");yield Ot(a,n)}if(e.target.closest(".removecardFromWallet")){const t=e.target.closest(".removecardFromWallet"),n=t.getAttribute("data-cardid"),a=t.getAttribute("data-cardname");yield Rt(n,a)}})})}function At(e,t,n){return __async(this,arguments,function*(e,t,n,a={}){try{const i=yield fetch(`/api/wallet/track/${e}/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({actionType:n,metadata:a})});yield i.json()}catch(i){}})}function _t(){return __async(this,null,function*(){const e=document.getElementById("walletCardsContainer"),t=document.getElementById("emptyWalletMessage");if(!e)return;e.innerHTML='<div style="text-align: center; padding: 2rem; color: white;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem;"></i><p>Loading wallet...</p></div>';const n=yield Tt.getWallet();if(!n.success||!n.wallet||0===n.wallet.cards.length)return e.innerHTML="",void(t.style.display="block");t.style.display="none",e.innerHTML=n.wallet.cards.map(e=>function(e){const t=function(e){if(!e)return"U";const t=e.trim().split(" ");if(t.length>=2)return(t[0][0]+t[t.length-1][0]).toUpperCase();return e.substring(0,2).toUpperCase()}(e.name),n=new Date(e.addedAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});let a;if(e.hasProfilePhoto){a=`<img src="${`${g.baseURL}/api/profile/photo/c/${e.cardId}`}" \n                           alt="${Dt(e.name)}" \n                           crossorigin="anonymous"\n                           onerror="this.style.display='none'; this.parentElement.innerHTML='<span>${t}</span>';">`}else a=`<span>${t}</span>`;e.organization;const i=e.title||"";let s="#667eea",o="#764ba2";e.cardBranding&&(s=e.cardBranding.gradientStart,o=e.cardBranding.gradientEnd);const r=`linear-gradient(135deg, ${s} 0%, ${o} 100%)`;return`\n        <div class="digital-wallet-card" data-card-id="${Dt(e.slug)}" data-cardid="${Dt(e.cardId)}">\n      \n            \n            \x3c!-- Colored Header Section --\x3e\n            <div class="wallet-card-header-section-i" style="background: ${r};">\n                <div class="wallet-card-brand-name">${Dt(e.organization)}</div>\n                <div class="wallet-qr-top-container">\n                    <img src="/card/${Dt(e.slug)}/qr" alt="QR Code for ${Dt(e.name)}">\n                </div>\n               \n            </div>\n            \n            \x3c!-- Content Section --\x3e\n            <div class="wallet-card-content">\n                <div class="empty-div"> \n                \x3c!-- Overlapping Profile Photo --\x3e\n                <div class="wallet-card-avatar-overlap">\n                    ${a}\n                </div></div>\n                <div class="actual-content">\n                <div class="wallet-card-name">${Dt(e.name)}</div>\n                ${i?`<div class="wallet-card-title">${Dt(i)}</div>`:""}\n                <div class="wallet-card-email"><a href="mailto:${Dt(e.email)}" class="wallet-display-email" title="Email">${Dt(e.email)}</a></div>\n          \n                </div>\n            </div>\n            \n            \x3c!-- Contact Icons --\x3e\n            <div class="wallet-card-contacts">\n                ${e.email?`<a href="mailto:${Dt(e.email)}" data-card-action="email" data-analytics-info='{"type":"email","value":"${Dt(e.email)}"}' data-card-actionType="contact" class="wallet-contact-icon-btn" title="Email"><i class="fas fa-envelope"></i></a>`:""}\n                ${e.phone?`<a href="tel:${Dt(e.phone)}" data-card-action="phone" data-analytics-info='{"type":"phone","value":"${Dt(e.phone)}"}' data-card-actionType="contact" class="wallet-contact-icon-btn" title="Call"><i class="fas fa-phone"></i></a>`:""}\n                ${e.phone?`<a href="sms:${Dt(e.phone)}" data-card-action="sms"  data-analytics-info='{"type":"sms","value":"${Dt(e.phone)}"}' data-card-actionType="contact" class="wallet-contact-icon-btn" title="Message"><i class="fas fa-sms"></i></a>`:""}\n                <a href="/card/${Dt(e.slug)}" target="_blank" data-card-action="view" data-analytics-info='{"source":"wallet_icon","slug":"${Dt(e.slug)}"}' data-card-actionType="card_view" class="wallet-contact-icon-btn" title="View Card"><i class="fas fa-address-card"></i></a>\n            </div>\n            \n            \x3c!-- Action Buttons - KEEPING YOUR FORMAT --\x3e\n            <div class="wallet-card-actions">\n                <a href="/card/${Dt(e.slug)}" data-analytics-info='{"source":"wallet_button","slug":"${Dt(e.slug)}"}' data-card-action="view" data-card-actionType="card_view" target="_blank" class="wallet-action-btn primary">\n                    <i class="fas fa-eye"></i> View\n                </a>\n                <button class="wallet-action-btn primary shareWalletCardlink" data-analytics-info='{"slug":"${Dt(e.slug)}"}' data-card-action="share" data-card-actionType="share" data-cardid="${Dt(e.cardId)}" data-slug="${Dt(e.slug)}" data-cardname="${Dt(e.name)}">\n                    <i class="fas fa-share-alt"></i> Share\n                </button>\n                <button class="wallet-action-btn danger removecardFromWallet" data-card-action="remove" data-analytics-info='{"slug":"${Dt(e.slug)}"}' data-card-actionType="wallet_remove" data-cardid="${Dt(e.cardId)}" data-slug="${Dt(e.slug)}" data-cardname="${Dt(e.name)}">\n                    <i class="fas fa-trash"></i> Remove\n                </button>\n            </div>\n            \n            <div class="wallet-card-added-date">\n                Added ${n}\n            </div>\n        </div>\n    `}(e)).join(""),Bt()})}function Dt(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.toString().replace(/[&<>"']/g,e=>t[e])}function Rt(e,a){return __async(this,null,function*(){k.show(`Are you sure you want to remove ${a} from your wallet?`,{type:"confirm",buttons:[{text:"Cancel",style:"secondary"},{text:"Proceed",style:"primary",onClick:()=>__async(this,null,function*(){try{const a=yield Tt.removeCard(e);if(a.success){t("Card removed from wallet"),k.info("Card removed from wallet");$(`[data-cardid="${e}"]`).remove();const n=document.querySelector(`[data-card-id="${e}"]`);n&&(n.style.transition="opacity 0.3s ease, transform 0.3s ease",n.style.opacity="0",n.style.transform="scale(0.9)",setTimeout(()=>{n.remove();0===document.querySelectorAll(".digital-wallet-card").length&&(document.getElementById("emptyWalletMessage").style.display="block")},300))}else n(a.message||"Failed to remove card from wallet")}catch(a){n("Failed to delete walletcard: "+a.message),k.error("Failed to delete walletcard: "+a.message),$(this).prop("disabled",!1).html('<i class="fas fa-trash-alt"></i> Delete')}})}]})})}function Ot(e,t){const n=`${window.location.origin}/card/${e}`;navigator.share?navigator.share({title:`${t}'s Digital Card`,text:`Check out ${t}'s digital business card`,url:n}).then(()=>{}).catch(e=>{"AbortError"===e.name||Mt(n)}):Mt(n)}function Mt(e){const n=document.createElement("textarea");n.value=e,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select();try{document.execCommand("copy"),t("Link copied to clipboard!"),k.show("Link copied to clipboard!")}catch(a){k.show("Failed to copy")}document.body.removeChild(n)}$(document).on("click",".wallet-contact-icon-btn",function(e){return __async(this,null,function*(){$(this).attr("href");const t=$(this).parents(".digital-wallet-card").attr("data-cardid"),n=$(this).attr("data-card-action"),a=$(this).attr("data-card-actionType"),i=$(this).attr("data-analytics-info");yield At(t,n,a,i),e.preventDefault()})}),$(document).on("click",".wallet-action-btn",function(e){return __async(this,null,function*(){$(this).attr("href");const t=$(this).parents(".digital-wallet-card").attr("data-cardid"),n=$(this).attr("data-card-action"),a=$(this).attr("data-card-actionType"),i=$(this).attr("data-analytics-info");yield At(t,n,a,i),e.preventDefault()})}),"undefined"!=typeof window&&(window.walletAPI=Tt,window.loadWalletCards=_t,window.removeFromWallet=Rt,window.shareWalletCard=Ot,window.handlePendingWalletCard=function(){return __async(this,null,function*(){const e=sessionStorage.getItem("pendingWalletCard"),a=sessionStorage.getItem("redirectToWallet");if(e&&a){sessionStorage.removeItem("pendingWalletCard"),sessionStorage.removeItem("redirectToWallet");const a=yield Tt.addCard(e);a.success?(showPage("wallet"),t("Card added to your wallet successfully!"),k.show("Card added to your wallet successfully!")):n(a.message||"Failed to add card to wallet")}})},window.initializeWalletButton=function(){const e=document.getElementById("walletBtn"),t=document.getElementById("walletBtnMobile");e&&e.addEventListener("click",()=>__async(this,null,function*(){showPage("wallet"),yield _t()})),t&&t.addEventListener("click",()=>__async(this,null,function*(){showPage("wallet"),yield _t()}))},window.attachWalletCardListeners=Bt);class Ut{constructor(){this.initialized=!1,this.categoryHeaders=[]}init(){this.initialized||(this.setupEventListeners(),this.setInitialState(),this.initialized=!0)}isAvailable(){return null!==document.querySelector(".social-links-profile")}setupEventListeners(){this.categoryHeaders=document.querySelectorAll(".social-category-header"),0!==this.categoryHeaders.length&&this.categoryHeaders.forEach(e=>{e._clickHandler=t=>{t.preventDefault(),this.toggleCategory(e)},e._keydownHandler=t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),this.toggleCategory(e))},e.addEventListener("click",e._clickHandler),e.addEventListener("keydown",e._keydownHandler)})}setInitialState(){this.categoryHeaders.forEach(e=>{const t=e.dataset.category,n=e.nextElementSibling;n&&(e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-expanded","true"),e.setAttribute("aria-controls",`category-content-${t}`),n.setAttribute("id",`category-content-${t}`),n.setAttribute("role","region"),n.setAttribute("aria-labelledby",`category-header-${t}`),e.setAttribute("id",`category-header-${t}`))})}toggleCategory(e){const t=e.nextElementSibling,n=e.querySelector(".category-chevron i"),a="true"===e.getAttribute("aria-expanded");t&&n&&(a?this.collapseCategory(e,t,n):this.expandCategory(e,t,n))}collapseCategory(e,t,n){e.classList.add("collapsed"),e.setAttribute("aria-expanded","false"),t.classList.add("collapsing"),setTimeout(()=>{t.classList.add("collapsed"),n.style.transform="rotate(-90deg)"},10),setTimeout(()=>{t.classList.remove("collapsing")},300),this.fireCustomEvent("categoryCollapsed",{category:e.dataset.category,header:e,content:t})}expandCategory(e,t,n){e.classList.remove("collapsed"),e.setAttribute("aria-expanded","true"),t.classList.add("expanding"),setTimeout(()=>{t.classList.remove("collapsed"),n.style.transform="rotate(0deg)"},10),setTimeout(()=>{t.classList.remove("expanding")},300),this.fireCustomEvent("categoryExpanded",{category:e.dataset.category,header:e,content:t})}collapseAll(){this.categoryHeaders.forEach(e=>{"true"===e.getAttribute("aria-expanded")&&this.toggleCategory(e)})}expandAll(){this.categoryHeaders.forEach(e=>{"true"===e.getAttribute("aria-expanded")||this.toggleCategory(e)})}getCategoriesState(){const e={};return this.categoryHeaders.forEach(t=>{const n=t.dataset.category,a="true"===t.getAttribute("aria-expanded");e[n]={expanded:a,category:n}}),e}setCategoriesState(e){Object.keys(e).forEach(t=>{const n=document.querySelector(`[data-category="${t}"]`);if(n){"true"===n.getAttribute("aria-expanded")!==e[t].expanded&&this.toggleCategory(n)}})}saveState(){try{const e=this.getCategoriesState();localStorage.setItem("socialCategoriesState",JSON.stringify(e))}catch(e){}}loadState(){const e=localStorage.getItem("socialCategoriesState");if(e)try{const t=JSON.parse(e);return this.setCategoriesState(t),!0}catch(t){}return!1}fireCustomEvent(e,t){const n=new CustomEvent(e,{detail:t,bubbles:!0,cancelable:!0});document.dispatchEvent(n)}onCategoryExpanded(e){return document.addEventListener("categoryExpanded",e),this}onCategoryCollapsed(e){return document.addEventListener("categoryCollapsed",e),this}getStats(){const e=this.categoryHeaders.length;let t=0,n=0;return this.categoryHeaders.forEach(e=>{"true"===e.getAttribute("aria-expanded")?t++:n++}),{total:e,expanded:t,collapsed:n,initialized:this.initialized}}destroy(){this.categoryHeaders.forEach(e=>{e._clickHandler&&(e.removeEventListener("click",e._clickHandler),delete e._clickHandler),e._keydownHandler&&(e.removeEventListener("keydown",e._keydownHandler),delete e._keydownHandler)}),this.categoryHeaders=[],this.initialized=!1}reinitialize(){this.initialized&&this.destroy(),this.init()}}const Nt={socialCategoryManager:null};function Ft(){return __async(this,null,function*(){try{!function(){try{Nt.socialCategoryManager=new Ut,Nt.socialCategoryManager.isAvailable()&&(Nt.socialCategoryManager.init(),Nt.socialCategoryManager.onCategoryExpanded(()=>{Nt.socialCategoryManager.saveState()}).onCategoryCollapsed(()=>{Nt.socialCategoryManager.saveState()}),Nt.socialCategoryManager.loadState())}catch(e){Nt.socialCategoryManager=null}}()}catch(e){}})}function Qt(){function e(){$("#hamburgerMenu").removeClass("active"),$("#mobileMenu").removeClass("active"),$("body").removeClass("menu-open")}window._eventHandlersInitialized||(window._eventHandlersInitialized=!0,$("#signupWithGoogle-btn").on("click",ye),$("#singup-cta-button").on("click",()=>Re("signup")),$("#singup-cta-button-uc").on("click",()=>Re("signup")),$("#signupBtn").on("click",()=>Re("signup")),$("#faqBtn").on("click",()=>Re("faq")),$("#usecaseBtn").on("click",()=>Re("usecase")),$("#homepage-signup").on("click",()=>Re("signup")),$(".signupbutton").on("click",()=>Re("signup")),$(".homebutton").off("click").on("click",()=>Re("home")),$(".profilebutton").off("click").on("click",()=>Re("home")),$("#loginBtn").on("click",()=>Re("login")),$("#displayBtn").off("click").on("click",()=>Re("display")),$("#profileBtn").off("click").on("click",()=>Re("profile")),$("#logoutBtn").on("click",ge),$("#googlesignin-button").on("click",he),$("#qr-upload-div").on("click",()=>document.getElementById("qrUpload").click()),$("#downloadVCard-btn").on("click",ee),$("#shareCard-btn").on("click",x),$("#addToWallet-btn").on("click",ot),$("#downloadQRCode-btn").on("click",ie),$(document).on("click","#downloadQRCode-btn-dynamic",ie),$(document).on("click","#downloadonlyQRCode-btn-dynamic",ne),$(document).on("click","#downloadVCard-btn-dynamic",ee),$(document).on("click",".copy-url-btn",x),$(".save-btn").on("click",function(e){e.preventDefault(),ft()?function(){__async(this,null,function*(){var e,a,i,s,o,r,l,c;try{S("Saving profile and generating QR codes...");const n=document.getElementById("profileForm");if(!n)throw new Error("Profile form not found");const d={};["instagram","facebook","twitter","linkedin","calendly","zoom","snapchat","tiktok","youtube","whatsapp","telegram","reddit","pinterest"].forEach(e=>{const t=document.getElementById(e);if(t){const n=t.getAttribute("data-final-url");n&&n.trim()&&(d[e]=n)}});const u=new FormData(n),p=window.locationAutocomplete?window.locationAutocomplete.getSelectedLocation():null,m={name:u.get("name"),title:u.get("title"),organization:u.get("organization"),phone:u.get("phone"),mobile:u.get("mobile"),email:u.get("email"),website:u.get("website"),address:u.get("address"),notes:u.get("notes"),showPhoneNumber:$("#showPhoneNumber").is(":checked"),country:{name:(null==(e=null==p?void 0:p.country)?void 0:e.name)||u.get("country")||"",code:u.get("countryCode")||(null==(a=null==p?void 0:p.country)?void 0:a.code)||""},state:{name:(null==(i=null==p?void 0:p.state)?void 0:i.name)||u.get("state")||"",id:u.get("stateId")||(null==(s=null==p?void 0:p.state)?void 0:s.id)||"",code:u.get("stateCode")||(null==(o=null==p?void 0:p.state)?void 0:o.code)||""},city:{name:(null==(r=null==p?void 0:p.city)?void 0:r.name)||u.get("city")||"",id:u.get("cityId")||(null==(l=null==p?void 0:p.city)?void 0:l.id)||""},socialMedia:d,isPublic:$("#isPublic").is(":checked")},h=yield g.saveProfile(m);if(!h.success)throw new Error(h.message||"Save failed");{ue(h.profile);let e="Profile saved successfully!";h.qrGenerated&&(e+=" Generated "+(null==(c=h.qrCodes)?void 0:c.length)||"0 QR codes."),k.success(e),t(e),X(),$(".profile-photo-section").show(),setTimeout(()=>{Me("display"),Re("display"),Ue("display")},1e3)}}catch(d){n("Failed to save profile: "+d.message)}finally{E()}})}():(o(),n("Please fix the errors before saving"))}),$("#hamburgerMenu").on("click",function(){$(this).toggleClass("active"),$("#mobileMenu").toggleClass("active"),$("body").toggleClass("menu-open")}),$(document).on("click",function(e){$(e.target).closest(".mobile-menu, .hamburger-menu").length||($("#hamburgerMenu").removeClass("active"),$("#mobileMenu").removeClass("active"),$("body").removeClass("menu-open"))}),$(".mobile-menu-btn.homebutton").on("click",function(){$(".homebutton").first().click(),e()}),$("#loginBtnMobile").on("click",()=>{$("#loginBtn").click(),e()}),$("#signupBtnMobile").on("click",()=>{$("#signupBtn").click(),e()}),$("#profileBtnMobile").on("click",()=>{$("#profileBtn").click(),e()}),$("#displayBtnMobile").on("click",()=>{$("#displayBtn").click(),e()}),$("#walletBtnMobile").on("click",()=>{$("#walletBtn").click(),e()}),$("#usecaseBtnMobile").on("click",()=>{$("#usecaseBtn").click(),e()}),$("#faqBtnMobile").on("click",()=>{$("#faqBtn").click(),e()}),$("#logoutBtnMobile").on("click",()=>{$("#logoutBtn").click(),e()}))}function zt(){return __async(this,null,function*(){const e=new URLSearchParams(window.location.search),a=e.get("page");if(yield Ft(),["home","faq","usecase","scenario","resetPassword","forgotPassword","verifyEmail"].includes(a))return yield Oe(),fe(),void ve();"function"==typeof initializeWalletButton&&initializeWalletButton();try{const e=yield g.getUserWithProfile();let n=null;if(e.success&&e.authenticated){n=e.user,de(n),ue(e.profile);const a=new URLSearchParams(window.location.search),i=a.get("page");i?(Re(i),Ue(i)):e.profile?(ue(e.profile),function(e){const t=document.getElementById("email");t&&(t.value=e,t.setAttribute("readonly",!0),t.style.backgroundColor="#f8f9fa",t.style.cursor="not-allowed",t.style.color="#6c757d")}(e.profile.email),$("#navbarAvatar").show(),$("#navbarAvatarDesktop").show(),$("#footer-cta").addClass("display-none-cta-button"),$("#singup-cta-button-div-uc").addClass("display-none-cta-button"),"function"==typeof handlePendingWalletCard&&(yield handlePendingWalletCard()),Re("display"),Ue("display"),Me("display")):(Re("profile"),Ue("profile"),Me("profile"));yield Oe();fe(),ve(),T(),"success"===a.get("auth")&&(t("Successfully logged in!"),window.history.replaceState({},document.title,window.location.pathname))}else n=null,userProfile=null,fe(),Re("home")}catch(i){de(null),Oe(),$("#footer-cta").removeClass("display-none-cta-button"),$("#singup-cta-button-div-uc").removeClass("display-none-cta-button")}fe(),ve(),"success"===e.get("auth")?(t("Successfully logged in!"),setTimeout(()=>__async(this,null,function*(){"function"==typeof handlePendingWalletCard&&(yield handlePendingWalletCard());const e=yield g.getProfile();e.success&&e.profile?Re("display"):Re("profile")}),1e3),window.history.replaceState({},document.title,window.location.pathname)):e.get("error")&&(n("Login failed. Please try again."),Oe(),$("#footer-cta").removeClass("display-none-cta-button"),$("#singup-cta-button-div-uc").removeClass("display-none-cta-button"))})}!function(){const e=new URLSearchParams(window.location.search).get("page");e&&"home"!==e||qt.init()}(),function(){window.addEventListener("unhandledrejection",e=>__async(this,null,function*(){yield Ve(e.reason,{}),e.preventDefault()})),window.addEventListener("error",e=>__async(this,null,function*(){e.error&&(yield Ve(e.error,{}))}))}(),document.addEventListener("DOMContentLoaded",function(){return __async(this,null,function*(){$("#navbarAvatar").hide(),$("#navbarAvatarDesktop").hide(),Qt(),Et(),function(){const e=document.getElementById("suggestions-form");e&&(e.addEventListener("submit",xt),e.addEventListener("input",e=>{if("INPUT"===e.target.tagName||"TEXTAREA"===e.target.tagName){e.target.style.borderColor="";const t=e.target.parentNode.querySelector(".form-error");t&&t.remove()}}))}(),function(){const e=document.getElementById("contact-form");e&&(e.addEventListener("submit",kt),e.addEventListener("input",e=>{"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"SELECT"!==e.target.tagName||(e.target.style.borderColor="")}));const t=document.getElementById("contact-modal"),n=null==t?void 0:t.querySelector(".close");n&&n.addEventListener("click",function(){t.style.display="none",document.body.style.overflow="auto";const e=document.getElementById("contact-success");e&&(e.style.display="none")}),t&&t.addEventListener("click",function(e){if(e.target===t){t.style.display="none",document.body.style.overflow="auto";const e=document.getElementById("contact-success");e&&(e.style.display="none")}})}(),O(),bt(),yield zt(),Ht(),window.addEventListener("resize",Ht),$(window).on("popstate",Oe),$(window).on("hashchange",Oe),function(){const e=new URLSearchParams(window.location.search).get("page");if(["home","faq","usecase","scenario","resetPassword","forgotPassword","verifyEmail"].includes(e))return void function(){__async(this,null,function*(){yield Oe(),fe(),ve()})}();oe.init(),re.init(),V.init();Ht()}()})});let jt="";function Ht(){const e=$(".navbar"),t=$(".container");(/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)?window.screen.width:window.innerWidth)<330?(e.hide(),t.hide(),function(){if($("#resolution-message").length)return;const e=`\n    <div id="resolution-message" style="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 9999;\n    ">\n      <div style="background: white; padding: 2rem; border-radius: 20px; text-align: center; max-width: 90%;">\n        <div style="font-size: 3rem; margin-bottom: 1rem;">üì±</div>\n        <h2 style="color: #333; margin-bottom: 1rem;">Screen Too Small</h2>\n        <p style="color: #666; line-height: 1.5;">\n          This application requires a minimum screen width of 400px.\n        </p>\n        <p style="color: #999; font-size: 0.9rem;">\n          Current width: ${$(window).width()}px | Required: 400px minimum\n        </p>\n      </div>\n    </div>\n  `;$("body").append(e)}()):(e.show(),t.show(),$("#resolution-message").remove())}$(document).ready(function(){$(".select-account-type").on("click",function(){jt=$(this).data("type"),$(".account-type-card").removeClass("selected"),$(this).closest(".account-type-card").addClass("selected"),0===$("#accountType").length&&$("#signupForm").append('<input type="hidden" id="accountType" name="accountType">'),$("#accountType").val(jt);const e=$("#corporateFields");"corporate"===jt?(e.show(),$("#companyName").prop("required",!0)):(e.hide(),$("#companyName").prop("required",!1)),$(".account-type-selection").hide(),$("#signupForm").show()}),$("#backToAccountType").on("click",function(){$(".account-type-selection").show(),$("#signupForm").hide(),jt="",$("#accountType").val(""),$(".account-type-card").removeClass("selected")}),$("#signupForm").on("submit",function(e){return __async(this,null,function*(){e.preventDefault();const a=new FormData(this),i={name:a.get("name"),email:a.get("email"),password:a.get("password"),accountType:a.get("accountType")};"corporate"===i.accountType&&(i.companyName=a.get("companyName"),i.companyDomain=a.get("companyDomain"),i.companySize=a.get("companySize"),i.industry=a.get("industry"));try{const e=yield fetch("/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),a=yield e.json();a.success?(t("Account created! Please verify your email."),setTimeout(()=>{Re("emailVerification")},1500)):n(a.message)}catch(s){n("An error occurred. Please try again.")}})}),$("#googleSignupBtn, #signupWithGoogle-btn").on("click",function(e){return __async(this,null,function*(){if(e.preventDefault(),!jt)return void n("Please select an account type first");const t={};"corporate"===jt&&(t.companyName=$('[name="companyName"]').val()||"",t.companyDomain=$('[name="companyDomain"]').val()||"",t.companySize=$('[name="companySize"]').val()||"",t.industry=$('[name="industry"]').val()||"");try{yield fetch("/auth/google/init",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(__spreadValues({accountType:jt},t))}),window.location.href="/auth/google"}catch(a){n("Error initiating Google signup")}})})}),$(document).on("click",function(e){const t=$(".user-menu"),n=$("#userDropdown");n.length&&t.length&&!t.is(e.target)&&0===t.has(e.target).length&&n.hide()}),$(window).on("resize",Ht),$(document).ready(function(){}),"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",oe.init()),window.showPage=Re,window.trackSocialClick=t=>e(()=>Promise.resolve().then(()=>se)).then(e=>e.trackSocialClick(t))}();
